# ğŸ“ ì•„í‚¤í…ì²˜ ì„¤ê³„ì„œ

## ë¬¸ì„œ ì •ë³´

| í•­ëª© | ë‚´ìš© |
|------|------|
| ë¬¸ì„œëª… | ì½˜ì„œíŠ¸ í‹°ì¼“íŒ… ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ì„¤ê³„ì„œ |
| ë²„ì „ | 1.0.0 |
| ì‘ì„±ì¼ | 2026-01-11 |
| ìµœì¢… ìˆ˜ì •ì¼ | 2026-01-11 |
| ìƒíƒœ | Draft |

### ë¬¸ì„œ ê°œì • ì´ë ¥

| ë²„ì „ | ë‚ ì§œ | ì‘ì„±ì | ë³€ê²½ ë‚´ìš© |
|------|------|--------|----------|
| 1.0.0 | 2026-01-11 | ê°œë°œíŒ€ | ì´ˆì•ˆ ì‘ì„± |

---

## ëª©ì°¨

1. [ë¬¸ì„œ ê°œìš”](#1-ë¬¸ì„œ-ê°œìš”)
2. [ì‹œìŠ¤í…œ ê°œìš”](#2-ì‹œìŠ¤í…œ-ê°œìš”)
3. [ì•„í‚¤í…ì²˜ íŒ¨í„´ ë° ì„¤ê³„ ì›ì¹™](#3-ì•„í‚¤í…ì²˜-íŒ¨í„´-ë°-ì„¤ê³„-ì›ì¹™)
4. [ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì„±](#4-ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤-êµ¬ì„±)
5. [ì¸í”„ë¼ ì•„í‚¤í…ì²˜](#5-ì¸í”„ë¼-ì•„í‚¤í…ì²˜)
6. [ë°ì´í„° ì•„í‚¤í…ì²˜](#6-ë°ì´í„°-ì•„í‚¤í…ì²˜)
7. [ë©”ì‹œì§• ì•„í‚¤í…ì²˜](#7-ë©”ì‹œì§•-ì•„í‚¤í…ì²˜)
8. [API ì„¤ê³„](#8-api-ì„¤ê³„)
9. [ë³´ì•ˆ ì•„í‚¤í…ì²˜](#9-ë³´ì•ˆ-ì•„í‚¤í…ì²˜)
10. [ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œ ì„¤ê³„](#10-ëŒ€ê¸°ì—´-ì‹œìŠ¤í…œ-ì„¤ê³„)
11. [ì¢Œì„ ì˜ˆë§¤ ì‹œìŠ¤í…œ ì„¤ê³„](#11-ì¢Œì„-ì˜ˆë§¤-ì‹œìŠ¤í…œ-ì„¤ê³„)
12. [ê²°ì œ ì‹œìŠ¤í…œ ì„¤ê³„](#12-ê²°ì œ-ì‹œìŠ¤í…œ-ì„¤ê³„)
13. [ë°°í¬ ë° CI/CD](#13-ë°°í¬-ë°-cicd)
14. [ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…](#14-ëª¨ë‹ˆí„°ë§-ë°-ë¡œê¹…)
15. [ì„±ëŠ¥ ìµœì í™” ì „ëµ](#15-ì„±ëŠ¥-ìµœì í™”-ì „ëµ)
16. [í…ŒìŠ¤íŠ¸ ì „ëµ](#16-í…ŒìŠ¤íŠ¸-ì „ëµ)
17. [ìš´ì˜ ê³„íš](#17-ìš´ì˜-ê³„íš)
18. [ê¸°ìˆ  ë¶€ì±„ ë° ê°œì„  ì‚¬í•­](#18-ê¸°ìˆ -ë¶€ì±„-ë°-ê°œì„ -ì‚¬í•­)
19. [ë¶€ë¡](#19-ë¶€ë¡)

---

## 1. ë¬¸ì„œ ê°œìš”

### 1.1 ë¬¸ì„œ ëª©ì 

ë³¸ ë¬¸ì„œëŠ” **ì½˜ì„œíŠ¸/ê³µì—° í‹°ì¼“íŒ… ì‹œìŠ¤í…œ**ì˜ ì•„í‚¤í…ì²˜ ì„¤ê³„ë¥¼ ì •ì˜í•˜ê³ , ì‹œìŠ¤í…œì˜ êµ¬ì¡°, ì»´í¬ë„ŒíŠ¸ ê°„ ìƒí˜¸ì‘ìš©, ê¸°ìˆ  ìŠ¤íƒ, ê·¸ë¦¬ê³  ì„¤ê³„ ê²°ì • ì‚¬í•­ì„ ë¬¸ì„œí™”í•©ë‹ˆë‹¤.

**ì£¼ìš” ëª©ì :**
- ê°œë°œíŒ€ì´ ì‹œìŠ¤í…œ êµ¬ì¡°ë¥¼ ëª…í™•íˆ ì´í•´í•˜ê³  ì¼ê´€ëœ ë°©í–¥ìœ¼ë¡œ ê°œë°œí•  ìˆ˜ ìˆë„ë¡ ì§€ì¹¨ ì œê³µ
- ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ê°„ ì±…ì„ê³¼ ê²½ê³„ë¥¼ ëª…í™•íˆ ì •ì˜í•˜ì—¬ ê°œë°œ ì¶©ëŒ ìµœì†Œí™”
- ê¸°ìˆ ì  ì˜ì‚¬ê²°ì •ì˜ ê·¼ê±°ë¥¼ ë¬¸ì„œí™”í•˜ì—¬ í–¥í›„ ìœ ì§€ë³´ìˆ˜ ë° í™•ì¥ ìš©ì´ì„± í™•ë³´
- ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ([REQUIREMENTS.md](./REQUIREMENTS.md))ì˜ 111ê°œ ìš”êµ¬ì‚¬í•­ì„ ì•„í‚¤í…ì²˜ë¡œ êµ¬í˜„í•˜ëŠ” ë°©ë²• ì œì‹œ

### 1.2 ëŒ€ìƒ ë…ì

- **ê°œë°œì (Aê°œë°œì, Bê°œë°œì)**: ì‹¤ì œ êµ¬í˜„ì„ ë‹´ë‹¹í•˜ëŠ” ë°±ì—”ë“œ/í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì
- **ì•„í‚¤í…íŠ¸**: ì‹œìŠ¤í…œ ì„¤ê³„ ë° ê¸°ìˆ  ì˜ì‚¬ê²°ì • ë‹´ë‹¹ì
- **í”„ë¡œì íŠ¸ ë§¤ë‹ˆì €**: í”„ë¡œì íŠ¸ ë²”ìœ„ ë° ì¼ì • ê´€ë¦¬ ë‹´ë‹¹ì
- **DevOps ì—”ì§€ë‹ˆì–´**: ì¸í”„ë¼ êµ¬ì¶• ë° ë°°í¬ íŒŒì´í”„ë¼ì¸ êµ¬ì„± ë‹´ë‹¹ì

### 1.3 ë¬¸ì„œ ë²”ìœ„

ë³¸ ë¬¸ì„œëŠ” ë‹¤ìŒì„ í¬í•¨í•©ë‹ˆë‹¤:
- MSA(Microservices Architecture) ê¸°ë°˜ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜
- 6ê°œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì˜ êµ¬ì„± ë° ìƒí˜¸ì‘ìš©
- AWS í´ë¼ìš°ë“œ ì¸í”„ë¼ êµ¬ì„± (ë¬´ë£Œí‹°ì–´ ìµœì í™”)
- LocalStack ê¸°ë°˜ ë¡œì»¬ ê°œë°œ í™˜ê²½
- ë°ì´í„°ë² ì´ìŠ¤, ìºì‹œ, ë©”ì‹œì§• ì‹œìŠ¤í…œ ì„¤ê³„
- ë³´ì•ˆ, ì„±ëŠ¥, ëª¨ë‹ˆí„°ë§ ì „ëµ

ë³¸ ë¬¸ì„œëŠ” ë‹¤ìŒì„ í¬í•¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤:
- í”„ë¡ íŠ¸ì—”ë“œ ìƒì„¸ ì„¤ê³„ (Next.js êµ¬ì¡°ëŠ” ê°œìš”ë§Œ í¬í•¨)
- ìƒì„¸ API ìŠ¤í™ (Swagger/OpenAPI ë¬¸ì„œë¡œ ë³„ë„ ê´€ë¦¬)
- ê°œë°œ ì½”ë”© ì»¨ë²¤ì…˜ (ë³„ë„ ë¬¸ì„œë¡œ ê´€ë¦¬)

### 1.4 ì•„í‚¤í…ì²˜ ì„¤ê³„ ì›ì¹™

1. **í™•ì¥ì„± (Scalability)**
   - ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ë¡œ ì„œë¹„ìŠ¤ë³„ ë…ë¦½ì  í™•ì¥ ê°€ëŠ¥
   - Redis ê¸°ë°˜ ëŒ€ê¸°ì—´ë¡œ ëŒ€ê·œëª¨ ë™ì‹œ ì ‘ì† ì²˜ë¦¬ (50,000ëª…)

2. **ê°€ìš©ì„± (Availability)**
   - Circuit Breaker íŒ¨í„´ìœ¼ë¡œ ì¥ì•  ì „íŒŒ ë°©ì§€
   - Redis/RDB ì´ì¤‘í™” ë° ìë™ ë°±ì—…
   - ëª©í‘œ: 99.9% ê°€ìš©ì„±

3. **ì„±ëŠ¥ (Performance)**
   - Redis ìºì‹±ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ ìµœì í™”
   - P95 ì‘ë‹µ ì‹œê°„ ëª©í‘œ (ëŒ€ê¸°ì—´ ì§„ì… < 100ms, ì¡°íšŒ < 50ms)
   - ë¹„ë™ê¸° ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ë¡œ ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•

4. **ë³´ì•ˆ (Security)**
   - JWT ê¸°ë°˜ ì¸ì¦/ì¸ê°€
   - reCAPTCHAë¡œ ë´‡/ë§¤í¬ë¡œ ì°¨ë‹¨
   - AES-256 ì•”í˜¸í™”ë¡œ ê°œì¸ì •ë³´ ë³´í˜¸
   - ë³¸ì¸ì¸ì¦(CI/DI)ìœ¼ë¡œ 1ì¸ 1ê³„ì • ê°•ì œ

5. **ë°ì´í„° ì¼ê´€ì„± (Data Consistency)**
   - SAGA íŒ¨í„´ìœ¼ë¡œ ë¶„ì‚° íŠ¸ëœì­ì…˜ ê´€ë¦¬
   - Transactional Outbox íŒ¨í„´ìœ¼ë¡œ ì´ë²¤íŠ¸ ë°œí–‰ ì‹ ë¢°ì„± ë³´ì¥
   - Redisson ë¶„ì‚° ë½ìœ¼ë¡œ ì¢Œì„ ì„ ì  ë™ì‹œì„± ì œì–´

6. **ë¹„ìš© íš¨ìœ¨ì„± (Cost Efficiency)**
   - AWS ë¬´ë£Œí‹°ì–´ ìµœëŒ€ í™œìš©
   - ë‹¨ì¼ PostgreSQL ì¸ìŠ¤í„´ìŠ¤ì— ìŠ¤í‚¤ë§ˆ ë¶„ë¦¬ (ë…¼ë¦¬ì  DB per Service)
   - LocalStackìœ¼ë¡œ ë¡œì»¬ ê°œë°œ ë¹„ìš© ì œë¡œ
   - CloudWatch ë¬´ë£Œ í•œë„ ë‚´ ëª¨ë‹ˆí„°ë§

7. **ê°œë°œ ìƒì‚°ì„± (Developer Productivity)**
   - Docker Composeë¡œ ë¡œì»¬ í™˜ê²½ í†µí•© ê´€ë¦¬
   - GitHub Actionsë¡œ CI/CD ìë™í™”
   - ëª…í™•í•œ ì„œë¹„ìŠ¤ ê²½ê³„ë¡œ ê°œë°œ ì¶©ëŒ ìµœì†Œí™”

### 1.5 ê¸°ìˆ  ìŠ¤íƒ ê°œìš”

| ê³„ì¸µ | ê¸°ìˆ  | ìš©ë„ |
|------|------|------|
| **Frontend** | Next.js 15+ | React ê¸°ë°˜ SSR/CSR |
|  | Vercel | í”„ë¡ íŠ¸ì—”ë“œ ë°°í¬ í”Œë«í¼ |
| **API Gateway** | Spring Cloud Gateway | í†µí•© ì§„ì…ì , ë¼ìš°íŒ…, ì¸ì¦ |
| **Backend** | Spring Boot 3.x | ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í”„ë ˆì„ì›Œí¬ |
|  | Java 21+ | ë°±ì—”ë“œ ì–¸ì–´ |
| **Database** | PostgreSQL 18 | RDB (ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤, ìŠ¤í‚¤ë§ˆ ë¶„ë¦¬) |
|  | Redis 7.x | ìºì‹œ, ëŒ€ê¸°ì—´, ë¶„ì‚° ë½ |
| **Messaging** | Apache Kafka 3.x | ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë° |
| **Security** | Spring Security | ì¸ì¦/ì¸ê°€ í”„ë ˆì„ì›Œí¬ |
|  | JWT | í† í° ê¸°ë°˜ ì¸ì¦ |
|  | reCAPTCHA | ë´‡ ì°¨ë‹¨ |
| **Resilience** | Resilience4j | Circuit Breaker, Rate Limiter |
| **Infrastructure** | AWS (RDS, ElastiCache, EC2, ALB) | í´ë¼ìš°ë“œ ì¸í”„ë¼ |
|  | LocalStack | ë¡œì»¬ AWS ì—ë®¬ë ˆì´ì…˜ |
|  | Docker / Docker Compose | ì»¨í…Œì´ë„ˆ |
| **CI/CD** | GitHub Actions | ë¹Œë“œ, í…ŒìŠ¤íŠ¸, ë°°í¬ ìë™í™” |
| **Monitoring** | AWS CloudWatch | ë¡œê·¸, ë©”íŠ¸ë¦­, ì•ŒëŒ |
|  | Spring Cloud Sleuth | ë¶„ì‚° ì¶”ì  |

---

## 2. ì‹œìŠ¤í…œ ê°œìš”

### 2.1 ë¹„ì¦ˆë‹ˆìŠ¤ ëª©ì  ë° ë°°ê²½

**ë¹„ì¦ˆë‹ˆìŠ¤ ëª©ì :**
ëŒ€ê·œëª¨ ë™ì‹œ ì ‘ì†ì´ ë°œìƒí•˜ëŠ” ì½˜ì„œíŠ¸/ê³µì—° í‹°ì¼“ ì˜ˆë§¤ ì‹œìŠ¤í…œì„ ì•ˆì •ì ìœ¼ë¡œ ìš´ì˜í•˜ë©°, ê³µì •í•œ ì˜ˆë§¤ ê¸°íšŒë¥¼ ì œê³µí•˜ê³  ë¶€ì • ì˜ˆë§¤(ë§¤í¬ë¡œ, ì¤‘ë³µ ê°€ì… ë“±)ë¥¼ ì°¨ë‹¨í•©ë‹ˆë‹¤.

**í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ê°€ì¹˜:**
- **ê³µì •ì„±**: ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œìœ¼ë¡œ ì„ ì°©ìˆœ ê³µì •ì„± í™•ë³´
- **ë³´ì•ˆì„±**: ë³¸ì¸ì¸ì¦(CI/DI), CAPTCHAë¡œ 1ì¸ 1ê³„ì • ê°•ì œ ë° ë´‡ ì°¨ë‹¨
- **ì•ˆì •ì„±**: ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ëŒ€ì‘ (ê³µì—°ë‹¹ 50,000ëª… ëŒ€ê¸°ì—´, 36,000ëª…/ì‹œê°„ ì²˜ë¦¬)
- **ì‹ ë¢°ì„±**: SAGA íŒ¨í„´ìœ¼ë¡œ ê²°ì œ-ì˜ˆë§¤ ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

**ë°°ê²½:**
- ê¸°ì¡´ í‹°ì¼“íŒ… ì‹œìŠ¤í…œì˜ ê³¼ë¶€í•˜ ë° ë¶ˆê³µì • ì˜ˆë§¤ ë¬¸ì œ í•´ê²° í•„ìš”
- MSA ì•„í‚¤í…ì²˜ë¡œ ì„œë¹„ìŠ¤ë³„ ë…ë¦½ í™•ì¥ ë° ì¥ì•  ê²©ë¦¬
- ì´ë²¤íŠ¸ ê¸°ë°˜ ì•„í‚¤í…ì²˜ë¡œ ëŠìŠ¨í•œ ê²°í•© ë° í™•ì¥ì„± í™•ë³´

### 2.2 ì£¼ìš” ê¸°ëŠ¥ ìš”ì•½

#### 2.2.1 ì¸ì¦ ë° íšŒì› ê´€ë¦¬ (User Service)
- **íšŒì›ê°€ì…**: ì•½ê´€ë™ì˜ â†’ CAPTCHA â†’ ë³¸ì¸ì¸ì¦(CI/DI) â†’ ì •ë³´ì…ë ¥
- **ë¡œê·¸ì¸**: ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ + CAPTCHA, JWT í† í° ë°œê¸‰
- **ì†Œì…œ ë¡œê·¸ì¸**: ì¹´ì¹´ì˜¤, ë„¤ì´ë²„, êµ¬ê¸€ OAuth2 ì§€ì› (ì„ íƒ)
- **í”„ë¡œí•„ ê´€ë¦¬**: ì¡°íšŒ, ìˆ˜ì •, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½, íšŒì› íƒˆí‡´

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-AUTH-001 ~ REQ-AUTH-021 (21ê°œ)

#### 2.2.2 ê³µì—° ê´€ë¦¬ (Event Service)
- **ê³µì—° CRUD**: ìƒì„±, ìˆ˜ì •, ì‚­ì œ (ê´€ë¦¬ì)
- **ê³µì—° ì¡°íšŒ**: ëª©ë¡ ì¡°íšŒ (í˜ì´ì§•, í•„í„°ë§, ê²€ìƒ‰), ìƒì„¸ ì¡°íšŒ
- **ì¢Œì„ ì •ë³´ ì¡°íšŒ**: ë“±ê¸‰ë³„(VIP/S/A/B) ì¢Œì„ ê·¸ë£¹í•‘ ë° ê°€ê²© ì¡°íšŒ
- **ê³µì—°ì¥/í™€ ê´€ë¦¬**: ê³µì—°ì¥ ë° í™€ ì •ë³´ CRUD
- **ì¢Œì„ ìƒíƒœ ê´€ë¦¬**: Kafka ì´ë²¤íŠ¸ ìˆ˜ì‹ í•˜ì—¬ ì¢Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-EVT-001 ~ REQ-EVT-031 (24ê°œ)

#### 2.2.3 ëŒ€ê¸°ì—´ (Queue Service)
- **ëŒ€ê¸°ì—´ ì§„ì…**: Redis Sorted Set ê¸°ë°˜, ê³µì—°ë³„ ìµœëŒ€ 50,000ëª…
- **ëŒ€ê¸°ì—´ ìƒíƒœ ì¡°íšŒ**: REST í´ë§(5ì´ˆ ê¶Œì¥), í˜„ì¬ ìˆœì„œ ë° ì˜ˆìƒ ëŒ€ê¸° ì‹œê°„
- **ë°°ì¹˜ ìŠ¹ì¸**: 1ì´ˆë§ˆë‹¤ 10ëª…ì”© ìŠ¹ì¸ (Lua ìŠ¤í¬ë¦½íŠ¸ ì›ìì„± ë³´ì¥)
- **Queue Token ë°œê¸‰**: Reservation Token (qr_xxx), Payment Token (qp_xxx)
- **ëŒ€ê¸°ì—´ ë§Œë£Œ**: Token TTL 10ë¶„, ìë™ ì œê±°

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-QUEUE-001 ~ REQ-QUEUE-021 (10ê°œ)

#### 2.2.4 ì˜ˆë§¤ (Reservation Service)
- **ì¢Œì„ ì„ ì **: Redisson ë¶„ì‚° ë½, Redis 5ë¶„ TTL
- **ì¢Œì„ ë³€ê²½**: ê¸°ì¡´ ë½ í•´ì œ â†’ ì‹ ê·œ ë½ íšë“
- **ì˜ˆë§¤ í™•ì •**: ê²°ì œ ì„±ê³µ ì´ë²¤íŠ¸ ìˆ˜ì‹  ì‹œ PENDING â†’ CONFIRMED
- **ì˜ˆë§¤ ì·¨ì†Œ**: ì‚¬ìš©ì ì·¨ì†Œ (ê³µì—° ë‹¹ì¼ ë¶ˆê°€), ë³´ìƒ íŠ¸ëœì­ì…˜ (ê²°ì œ ì‹¤íŒ¨ ì‹œ)
- **ë‚˜ì˜ ì˜ˆë§¤ ë‚´ì—­**: ì‚¬ìš©ìë³„ ì˜ˆë§¤ ëª©ë¡ ì¡°íšŒ

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-RSV-001 ~ REQ-RSV-013 (12ê°œ)

#### 2.2.5 ê²°ì œ (Payment Service)
- **ê²°ì œ í”„ë¡œì„¸ìŠ¤**: PortOne ì—°ë™, ì‹ ìš©ì¹´ë“œ ê²°ì œ
- **ê²°ì œ ìƒíƒœ ê´€ë¦¬**: PENDING / SUCCESS / FAILED / REFUNDED
- **ë©±ë“±ì„± ë³´ì¥**: paymentKey ê¸°ë°˜ ì¤‘ë³µ ë°©ì§€
- **SAGA íŒ¨í„´**: ê²°ì œ ì„±ê³µ â†’ ì˜ˆë§¤ í™•ì •, ê²°ì œ ì‹¤íŒ¨ â†’ ì˜ˆë§¤ ì·¨ì†Œ (ë³´ìƒ íŠ¸ëœì­ì…˜)
- **Kafka ì´ë²¤íŠ¸ ë°œí–‰**: payment.success, payment.failed

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-PAY-001 ~ REQ-PAY-015 (15ê°œ)

#### 2.2.6 API Gateway
- **ë™ì  ë¼ìš°íŒ…**: Path ê¸°ë°˜ 5ê°œ ì„œë¹„ìŠ¤ ë¼ìš°íŒ…
- **JWT í† í° ê²€ì¦**: ë§Œë£Œ/ë³€ì¡° í™•ì¸, ì‚¬ìš©ì ì •ë³´ ì „ë‹¬
- **Rate Limiting**: IP ê¸°ë°˜, ì‚¬ìš©ì ê¸°ë°˜ ì œí•œ
- **Circuit Breaker**: ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ ì„œë¹„ìŠ¤ ì¥ì•  ê²©ë¦¬
- **CORS, ë³´ì•ˆ í—¤ë”**: í”„ë¡ íŠ¸ì—”ë“œ í†µì‹  ì§€ì›

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-GW-001 ~ REQ-GW-026 (26ê°œ)

### 2.3 ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ ìš”ì•½

#### 2.3.1 ì„±ëŠ¥ ìš”êµ¬ì‚¬í•­
| í•­ëª© | ëª©í‘œ | ê´€ë ¨ ìš”êµ¬ì‚¬í•­ |
|------|------|---------------|
| ëŒ€ê¸°ì—´ ì§„ì… | P95 < 100ms | REQ-QUEUE-015 |
| ëŒ€ê¸°ì—´ ì¡°íšŒ | P95 < 50ms | REQ-QUEUE-015 |
| ê³µì—° ëª©ë¡ ì¡°íšŒ | P95 < 200ms | REQ-EVT-004 |
| ê³µì—° ìƒì„¸ ì¡°íšŒ | P95 < 100ms | REQ-EVT-005 |
| ì¢Œì„ ì •ë³´ ì¡°íšŒ | P95 < 300ms | REQ-EVT-006 |
| ëŒ€ê¸°ì—´ ì²˜ë¦¬ëŸ‰ | 36,000ëª…/ì‹œê°„ (10ëª…/ì´ˆ) | REQ-QUEUE-005 |
| ëŒ€ê¸°ì—´ ìš©ëŸ‰ | ê³µì—°ë‹¹ ìµœëŒ€ 50,000ëª… | REQ-QUEUE-010 |

#### 2.3.2 ë³´ì•ˆ ìš”êµ¬ì‚¬í•­
- **ì¸ì¦**: JWT Access/Refresh Token (1ì‹œê°„/7ì¼)
- **ì•”í˜¸í™”**: ë¹„ë°€ë²ˆí˜¸ BCrypt, ê°œì¸ì •ë³´ AES-256 (ì„ íƒ)
- **ë³¸ì¸ì¸ì¦**: PortOne CI/DIë¡œ 1ì¸ 1ê³„ì • ê°•ì œ
- **ë´‡ ì°¨ë‹¨**: reCAPTCHA (íšŒì›ê°€ì…, ë¡œê·¸ì¸)
- **í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸**: Redis ê¸°ë°˜, TTL ê´€ë¦¬

#### 2.3.3 ê°€ìš©ì„± ìš”êµ¬ì‚¬í•­
- **Redis ê°€ìš©ì„±**: 99.9%
- **Circuit Breaker**: ì‹¤íŒ¨ìœ¨ ì„ê³„ê°’ ì´ˆê³¼ ì‹œ Circuit Open
- **Timeout**: API Gateway ê¸°ë³¸ 30ì´ˆ, Payment 60ì´ˆ
- **Retry**: GET/PUT/DELETEë§Œ ìµœëŒ€ 2íšŒ ì¬ì‹œë„

#### 2.3.4 í™•ì¥ì„± ìš”êµ¬ì‚¬í•­
- **Auto Scaling**: ìµœì†Œ 1, ìµœëŒ€ 3 ì¸ìŠ¤í„´ìŠ¤
- **ì„œë¹„ìŠ¤ë³„ ë…ë¦½ í™•ì¥**: MSA ì•„í‚¤í…ì²˜
- **Redis Cluster**: í–¥í›„ í™•ì¥ ê³ ë ¤ (ì´ˆê¸° ë‹¨ì¼ ë…¸ë“œ)

### 2.4 ì‹œìŠ¤í…œ ì œì•½ì‚¬í•­ ë° ê°€ì •ì‚¬í•­

#### 2.4.1 ì œì•½ì‚¬í•­
1. **ë¹„ìš© ì œì•½**: AWS ë¬´ë£Œí‹°ì–´ ìµœëŒ€ í™œìš©, ì›” ì˜ˆì‚° ìµœì†Œí™”
   - RDS: db.t3.micro (ë¬´ë£Œí‹°ì–´ 750ì‹œê°„/ì›”)
   - ElastiCache: cache.t2.micro (ë¬´ë£Œí‹°ì–´)
   - EC2: t2.micro (ë¬´ë£Œí‹°ì–´ 750ì‹œê°„/ì›”)
   - CloudWatch: ë¬´ë£Œí‹°ì–´ í•œë„ (ë¡œê·¸ 5GB, ë©”íŠ¸ë¦­ 10ê°œ, ì•ŒëŒ 10ê°œ)

2. **ê°œë°œ ë¦¬ì†ŒìŠ¤**: Aê°œë°œì (Gateway/Event/Queue), Bê°œë°œì (User/Reservation/Payment)

3. **ì™¸ë¶€ ì„œë¹„ìŠ¤ ì˜ì¡´ì„±**:
   - PortOne í…ŒìŠ¤íŠ¸ ëª¨ë“œ (ê²°ì œ)
   - Google reCAPTCHA v2 (ë´‡ ì°¨ë‹¨)
   - OAuth2 Provider (ì¹´ì¹´ì˜¤, ë„¤ì´ë²„, êµ¬ê¸€)

4. **ë°ì´í„°ë² ì´ìŠ¤**: ë‹¨ì¼ PostgreSQL ì¸ìŠ¤í„´ìŠ¤, ìŠ¤í‚¤ë§ˆ ë¶„ë¦¬ (ë¹„ìš© ì ˆê°)

5. **Kafka**: EC2 ìì²´ êµ¬ì¶• (MSK ê³ ë¹„ìš©), ì´ˆê¸° ë‹¨ì¼ ë¸Œë¡œì»¤

#### 2.4.2 ê°€ì •ì‚¬í•­
1. **íŠ¸ë˜í”½ íŒ¨í„´**:
   - í‰ìƒì‹œ: ì €íŠ¸ë˜í”½
   - í‹°ì¼“ ì˜¤í”ˆ ì‹œ: ìˆœê°„ 50,000ëª… ë™ì‹œ ì ‘ì† (ê³µì—°ë‹¹)
   - ëŒ€ê¸°ì—´ ì²˜ë¦¬: 36,000ëª…/ì‹œê°„ (10ëª…/ì´ˆ)

2. **ê³µì—° ê·œëª¨**:
   - ë™ì‹œ ì§„í–‰ ê³µì—°: ìµœëŒ€ 10ê°œ
   - ê³µì—°ë‹¹ ì¢Œì„: í‰ê·  3,000ì„
   - ê³µì—°ë‹¹ ëŒ€ê¸°ì—´: ìµœëŒ€ 50,000ëª…

3. **ì‚¬ìš©ì í–‰ë™**:
   - ëŒ€ê¸°ì—´ ìƒíƒœ í´ë§: 5ì´ˆ ê°„ê²©
   - ì¢Œì„ ì„ ì  í›„ ê²°ì œ: 5ë¶„ ì´ë‚´
   - 1íšŒ ì˜ˆë§¤: ìµœëŒ€ 4ì¥

4. **ë°°í¬ í™˜ê²½**:
   - ë¡œì»¬ ê°œë°œ: LocalStack + Docker Compose
   - ìš´ì˜ í™˜ê²½: AWS (ë‹¨ì¼ ë¦¬ì „, ì´ˆê¸° Single-AZ)
   - í”„ë¡ íŠ¸ì—”ë“œ: Vercel

---

## 3. ì•„í‚¤í…ì²˜ íŒ¨í„´ ë° ì„¤ê³„ ì›ì¹™

### 3.1 MSA (Microservices Architecture) ì±„íƒ ì´ìœ 

#### 3.1.1 ì±„íƒ ë°°ê²½
1. **ë…ë¦½ì  í™•ì¥ì„±**:
   - ëŒ€ê¸°ì—´ ì„œë¹„ìŠ¤ëŠ” íŠ¸ë˜í”½ í­ì¦ ì‹œ ë…ë¦½ì ìœ¼ë¡œ ìŠ¤ì¼€ì¼ ì•„ì›ƒ
   - ê²°ì œ ì„œë¹„ìŠ¤ëŠ” PG ì—°ë™ ë¶€í•˜ì— ë”°ë¼ ë³„ë„ í™•ì¥

2. **ì¥ì•  ê²©ë¦¬**:
   - ê²°ì œ ì„œë¹„ìŠ¤ ì¥ì•  ì‹œ ì˜ˆë§¤ ì¡°íšŒëŠ” ì •ìƒ ì‘ë™
   - Circuit Breakerë¡œ ì¥ì•  ì „íŒŒ ë°©ì§€

3. **ê¸°ìˆ  ìŠ¤íƒ ìœ ì—°ì„±**:
   - ì„œë¹„ìŠ¤ë³„ ìµœì  ê¸°ìˆ  ì„ íƒ ê°€ëŠ¥ (í–¥í›„ í™•ì¥ ê³ ë ¤)
   - Redis ê¸°ë°˜ ëŒ€ê¸°ì—´, RDB ê¸°ë°˜ ì˜ˆë§¤/ê²°ì œ

4. **ê°œë°œ ìƒì‚°ì„±**:
   - Aê°œë°œì (Gateway/Event/Queue), Bê°œë°œì (User/Reservation/Payment) ë³‘ë ¬ ê°œë°œ
   - ëª…í™•í•œ ì„œë¹„ìŠ¤ ê²½ê³„ë¡œ ì¶©ëŒ ìµœì†Œí™”

#### 3.1.2 íŠ¸ë ˆì´ë“œì˜¤í”„
- **ë³µì¡ì„± ì¦ê°€**: ë¶„ì‚° íŠ¸ëœì­ì…˜, ì„œë¹„ìŠ¤ ê°„ í†µì‹  ì˜¤ë²„í—¤ë“œ
  - **ëŒ€ì‘**: SAGA íŒ¨í„´, Transactional Outbox íŒ¨í„´ìœ¼ë¡œ ê´€ë¦¬
- **ìš´ì˜ ë¶€ë‹´**: 6ê°œ ì„œë¹„ìŠ¤ ë…ë¦½ ë°°í¬, ëª¨ë‹ˆí„°ë§
  - **ëŒ€ì‘**: Docker Compose, GitHub Actionsë¡œ ìë™í™”

### 3.2 ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„ (DDD) ì ìš©

#### 3.2.1 Bounded Context ì •ì˜
ê° ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ëŠ” í•˜ë‚˜ì˜ Bounded Contextë¡œ ì„¤ê³„:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Context                                           â”‚
â”‚  - íšŒì›, ì¸ì¦, í”„ë¡œí•„                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Event Context                                          â”‚
â”‚  - ê³µì—°, ê³µì—°ì¥, í™€, ì¢Œì„                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Queue Context                                          â”‚
â”‚  - ëŒ€ê¸°ì—´, í† í°                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Reservation Context                                    â”‚
â”‚  - ì˜ˆë§¤, ì¢Œì„ ì„ ì                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Payment Context                                        â”‚
â”‚  - ê²°ì œ, í™˜ë¶ˆ                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.2.2 Aggregate ì„¤ê³„ ì›ì¹™
- ê° ì„œë¹„ìŠ¤ ë‚´ íŠ¸ëœì­ì…˜ ê²½ê³„ëŠ” Aggregate Rootë¡œ ê´€ë¦¬
- ì„œë¹„ìŠ¤ ê°„ ì°¸ì¡°ëŠ” ID ê¸°ë°˜ (Foreign Key ì—†ìŒ)
- ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ ìœ¼ë¡œ ëŠìŠ¨í•œ ê²°í•© ìœ ì§€

### 3.3 Event-Driven Architecture (EDA) íŒ¨í„´

#### 3.3.1 ì ìš© ë°°ê²½
- **ë¹„ë™ê¸° ì²˜ë¦¬**: ê²°ì œ ì„±ê³µ í›„ ì˜ˆë§¤ í™•ì •, ì¢Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬
- **ëŠìŠ¨í•œ ê²°í•©**: ì„œë¹„ìŠ¤ ê°„ ì§ì ‘ í˜¸ì¶œ ìµœì†Œí™”, Kafka ì´ë²¤íŠ¸ë¡œ í†µì‹ 
- **í™•ì¥ì„±**: ì´ë²¤íŠ¸ ë°œí–‰/êµ¬ë… ëª¨ë¸ë¡œ ì‹ ê·œ Consumer ì¶”ê°€ ìš©ì´

#### 3.3.2 ì´ë²¤íŠ¸ í”Œë¡œìš° ì˜ˆì‹œ

**ì˜ˆë§¤ â†’ ê²°ì œ â†’ í™•ì • í”Œë¡œìš°:**
```
1. Reservation Service: ì¢Œì„ ì„ ì  ë° ì˜ˆë§¤ ìƒì„± (PENDING)
2. User â†’ Payment Service: ê²°ì œ ìš”ì²­ (ê²°ì œí•˜ê¸° ë²„íŠ¼ í´ë¦­)
3. Payment Service â†’ PortOne: ê²°ì œ ìŠ¹ì¸
4. Payment Service â†’ Kafka: payment.success ë°œí–‰
5. Reservation Service (Consumer): ì˜ˆë§¤ í™•ì • (CONFIRMED)
6. Event Service (Consumer): ì¢Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ (SOLD)
```

**ê²°ì œ ì‹¤íŒ¨ â†’ ë³´ìƒ íŠ¸ëœì­ì…˜:**
```
1. User â†’ Payment Service: ê²°ì œ ìš”ì²­
2. Payment Service â†’ PortOne: ê²°ì œ ìŠ¹ì¸ ì‹œë„
3. PortOne â†’ Payment Service: ê²°ì œ ì‹¤íŒ¨
4. Payment Service â†’ Kafka: payment.failed ë°œí–‰
5. Reservation Service (Consumer): ì˜ˆë§¤ ì·¨ì†Œ (CANCELLED)
6. Event Service (Consumer): ì¢Œì„ ì„ ì  í•´ì œ (AVAILABLE)
```

### 3.4 SAGA íŒ¨í„´ (ë¶„ì‚° íŠ¸ëœì­ì…˜)

#### 3.4.1 ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ê¸°ë°˜ SAGA
- **Orchestrator**: Payment Serviceê°€ SAGA ì§„í–‰ ê´€ë¦¬
- **ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤**:
  1. ê²°ì œ ìš”ì²­ â†’ PortOne ê²°ì œ ì„±ê³µ
  2. Kafka ì´ë²¤íŠ¸ ë°œí–‰ (`payment.success`)
  3. Reservation Service: ì˜ˆë§¤ í™•ì •
  4. Event Service: ì¢Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸

- **ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ (ë³´ìƒ íŠ¸ëœì­ì…˜)**:
  1. ê²°ì œ ìš”ì²­ â†’ PortOne ê²°ì œ ì‹¤íŒ¨
  2. Kafka ì´ë²¤íŠ¸ ë°œí–‰ (`payment.failed`)
  3. Reservation Service: ì˜ˆë§¤ ì·¨ì†Œ
  4. Event Service: ì¢Œì„ ì„ ì  í•´ì œ

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-PAY-011 (SAGA íŒ¨í„´), REQ-PAY-012 (ë³´ìƒ íŠ¸ëœì­ì…˜)

#### 3.4.2 SAGA vs 2PC ì„ íƒ ì´ìœ 
- **2PC (Two-Phase Commit)**: ë™ê¸°ì‹, ë¸”ë¡œí‚¹, ê°€ìš©ì„± ì €í•˜
- **SAGA**: ë¹„ë™ê¸°ì‹, ë³´ìƒ íŠ¸ëœì­ì…˜, ê°€ìš©ì„± ìš°ì„ 
- **ì„ íƒ ê·¼ê±°**: í‹°ì¼“íŒ… ì‹œìŠ¤í…œì€ ì„±ëŠ¥/ê°€ìš©ì„±ì´ ì¤‘ìš”í•˜ë¯€ë¡œ SAGA ì„ íƒ

### 3.5 Transactional Outbox íŒ¨í„´

#### 3.5.1 ì ìš© ë°°ê²½
- **ë¬¸ì œì **: ì„œë¹„ìŠ¤ ìƒíƒœ ë³€ê²½ í›„ Kafka ë°œí–‰ ì „ ì¥ì•  ë°œìƒ ì‹œ ì´ë²¤íŠ¸ ìœ ì‹¤
- **í•´ê²°ì±…**: DB íŠ¸ëœì­ì…˜ ë‚´ Outbox í…Œì´ë¸”ì— ì´ë²¤íŠ¸ ì €ì¥ â†’ Poller/CDCë¡œ Kafka ë°œí–‰

#### 3.5.2 êµ¬í˜„ ë°©ì•ˆ
1. **Outbox í…Œì´ë¸” ì„¤ê³„** (`common.outbox_events`):
   ```sql
   CREATE TABLE outbox_events (
     id UUID PRIMARY KEY,
     aggregate_type VARCHAR(255),  -- 'Reservation', 'Payment' ë“±
     aggregate_id UUID,
     event_type VARCHAR(255),       -- 'ReservationConfirmed', 'PaymentSuccess' ë“±
     payload JSONB,
     created_at TIMESTAMP,
     published BOOLEAN DEFAULT FALSE,
     published_at TIMESTAMP
   );
   ```

2. **ì´ë²¤íŠ¸ ë°œí–‰ í”„ë¡œì„¸ìŠ¤**:
   - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì‹¤í–‰ + Outbox INSERT (ë™ì¼ íŠ¸ëœì­ì…˜)
   - Poller (Spring @Scheduled) ë˜ëŠ” CDC (Debezium)ê°€ ì£¼ê¸°ì ìœ¼ë¡œ Outbox ì½ì–´ Kafka ë°œí–‰
   - ë°œí–‰ ì„±ê³µ ì‹œ `published = TRUE` ì—…ë°ì´íŠ¸

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-RSV-012 (Transactional Outbox Pattern), REQ-PAY-013 (Kafka ì´ë²¤íŠ¸ ë°œí–‰)

### 3.6 Circuit Breaker íŒ¨í„´

#### 3.6.1 ì ìš© ìœ„ì¹˜
- **API Gateway**: ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ ì„œë¹„ìŠ¤ í˜¸ì¶œ ì‹œ
- **Payment Service**: PortOne API í˜¸ì¶œ ì‹œ
- **Reservation Service**: Feign í´ë¼ì´ì–¸íŠ¸ë¡œ Queue Service í˜¸ì¶œ ì‹œ

#### 3.6.2 Resilience4j ì„¤ì • ì˜ˆì‹œ
```yaml
resilience4j.circuitbreaker:
  configs:
    default:
      slidingWindowSize: 100           # ìµœê·¼ 100ê°œ ìš”ì²­ ê¸°ì¤€
      failureRateThreshold: 50         # 50% ì´ìƒ ì‹¤íŒ¨ ì‹œ Circuit Open
      waitDurationInOpenState: 60s     # Open ìƒíƒœ 60ì´ˆ ìœ ì§€
      permittedNumberOfCallsInHalfOpenState: 10
  instances:
    paymentService:
      baseConfig: default
      waitDurationInOpenState: 60s     # PaymentëŠ” ëŒ€ê¸° ì‹œê°„ 60ì´ˆ
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-GW-007 (Circuit Breaker í†µí•©), REQ-PAY-009 (Circuit Breaker)

### 3.7 API Gateway íŒ¨í„´

#### 3.7.1 ì±…ì„
- **ë¼ìš°íŒ…**: Path ê¸°ë°˜ìœ¼ë¡œ 5ê°œ ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…
- **ì¸ì¦**: JWT í† í° ê²€ì¦
- **Rate Limiting**: IP/ì‚¬ìš©ì ê¸°ë°˜ ì œí•œ
- **ë³´ì•ˆ í—¤ë”**: CORS, XSS ë°©ì§€, HSTS
- **Circuit Breaker**: ë‹¤ìš´ìŠ¤íŠ¸ë¦¼ ì¥ì•  ê²©ë¦¬

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-GW-001 ~ REQ-GW-026 (26ê°œ)

### 3.8 CQRS íŒ¨í„´ ì ìš© ì—¬ë¶€ ê²€í† 

#### 3.8.1 í˜„ì¬ ì„¤ê³„
- **Event Service**: Redis ìºì‹±ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ ìµœì í™” (CQRS ìœ ì‚¬)
  - ì“°ê¸°: RDB (PostgreSQL)
  - ì½ê¸°: Redis Cache + RDB Fallback

#### 3.8.2 í–¥í›„ ê²€í†  ì‚¬í•­
- **ëŒ€ê¸°ì—´ ì¡°íšŒ**: Redis Sorted Set (ì´ë¯¸ CQRS íŒ¨í„´ê³¼ ìœ ì‚¬)
- **ì˜ˆë§¤ ë‚´ì—­ ì¡°íšŒ**: íŠ¸ë˜í”½ ì¦ê°€ ì‹œ Read Replica ë˜ëŠ” ElasticSearch ê²€í† 
- **í˜„ì¬ íŒë‹¨**: ì´ˆê¸° ë‹¨ê³„ì—ì„œëŠ” Redis ìºì‹±ìœ¼ë¡œ ì¶©ë¶„, íŠ¸ë˜í”½ ì¦ê°€ ì‹œ CQRS ì „ë©´ ì ìš© ê²€í† 

---

## 4. ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ êµ¬ì„±

### 4.1 ì„œë¹„ìŠ¤ ë§µ ë‹¤ì´ì–´ê·¸ë¨

```mermaid
graph TB
    Client[Next.js Frontend<br/>Vercel]
    Gateway[API Gateway<br/>Spring Cloud Gateway]

    User[User Service<br/>ì¸ì¦/íšŒì›]
    Event[Event Service<br/>ê³µì—°/ê³µì—°ì¥/ì¢Œì„]
    Queue[Queue Service<br/>ëŒ€ê¸°ì—´]
    Reservation[Reservation Service<br/>ì˜ˆë§¤]
    Payment[Payment Service<br/>ê²°ì œ]

    PostgreSQL[(PostgreSQL<br/>ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤)]
    Redis[(Redis<br/>ìºì‹œ/ëŒ€ê¸°ì—´/ë¶„ì‚°ë½)]
    Kafka[Kafka<br/>ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°]

    PortOne[PortOne<br/>PG]
    reCAPTCHA[reCAPTCHA<br/>ë´‡ ì°¨ë‹¨]
    OAuth2[OAuth2 Provider<br/>ì†Œì…œ ë¡œê·¸ì¸]

    Client -->|HTTPS| Gateway
    Gateway -->|JWT ê²€ì¦ í›„| User
    Gateway -->|JWT ê²€ì¦ í›„| Event
    Gateway -->|JWT ê²€ì¦ í›„| Queue
    Gateway -->|JWT ê²€ì¦ í›„| Reservation
    Gateway -->|JWT ê²€ì¦ í›„| Payment

    User -->|ìŠ¤í‚¤ë§ˆ: user_service| PostgreSQL
    Event -->|ìŠ¤í‚¤ë§ˆ: event_service| PostgreSQL
    Reservation -->|ìŠ¤í‚¤ë§ˆ: reservation_service| PostgreSQL
    Payment -->|ìŠ¤í‚¤ë§ˆ: payment_service| PostgreSQL

    User -->|Token Blacklist| Redis
    Event -->|ìºì‹œ| Redis
    Queue -->|Sorted Set| Redis
    Reservation -->|ë¶„ì‚° ë½| Redis

    Reservation -->|ì´ë²¤íŠ¸ ë°œí–‰| Kafka
    Payment -->|ì´ë²¤íŠ¸ ë°œí–‰| Kafka
    Event -->|ì´ë²¤íŠ¸ êµ¬ë…| Kafka
    Reservation -->|ì´ë²¤íŠ¸ êµ¬ë…| Kafka

    Payment -->|ê²°ì œ ìš”ì²­| PortOne
    User -->|ë´‡ ê²€ì¦| reCAPTCHA
    User -->|ì†Œì…œ ë¡œê·¸ì¸| OAuth2
```

### 4.2 ì„œë¹„ìŠ¤ë³„ ì±…ì„ê³¼ ê²½ê³„

#### 4.2.1 API Gateway Service (ë‹´ë‹¹: Aê°œë°œì)

**ì±…ì„:**
- ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì˜ ë‹¨ì¼ ì§„ì…ì 
- Path ê¸°ë°˜ ë¼ìš°íŒ…ìœ¼ë¡œ ê° ì„œë¹„ìŠ¤ë¡œ ìš”ì²­ ì „ë‹¬
- JWT í† í° ê²€ì¦ ë° ì‚¬ìš©ì ì •ë³´ ì „ë‹¬
- Rate Limiting (IP, ì‚¬ìš©ì ê¸°ë°˜)
- Circuit Breakerë¡œ ì¥ì•  ê²©ë¦¬
- CORS ë° ë³´ì•ˆ í—¤ë” ê´€ë¦¬

**ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸:**
- `/auth/**` â†’ User Service
- `/users/**` â†’ User Service
- `/events/**` â†’ Event Service
- `/venues/**` â†’ Event Service
- `/queue/**` â†’ Queue Service
- `/reservations/**` â†’ Reservation Service
- `/payments/**` â†’ Payment Service

**ê¸°ìˆ  ìŠ¤íƒ:**
- Spring Cloud Gateway 4.x
- Resilience4j (Circuit Breaker, Rate Limiter)
- Spring Security (JWT ê²€ì¦)

**ë°ì´í„° ì €ì¥ì†Œ:**
- ì—†ìŒ (Stateless)

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-GW-001 ~ REQ-GW-026 (26ê°œ)

---

#### 4.2.2 User Service (ë‹´ë‹¹: Bê°œë°œì)

**ì±…ì„:**
- íšŒì› ê°€ì…/ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ
- JWT Access/Refresh Token ë°œê¸‰ ë° ê°±ì‹ 
- ë³¸ì¸ì¸ì¦ (PortOne CI/DI)
- reCAPTCHA ê²€ì¦
- ì†Œì…œ ë¡œê·¸ì¸ (OAuth2)
- í”„ë¡œí•„ ê´€ë¦¬ (ì¡°íšŒ, ìˆ˜ì •, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½, íšŒì› íƒˆí‡´)
- í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬ (Redis)

**ì£¼ìš” API:**
- `POST /auth/register` - íšŒì›ê°€ì…
- `POST /auth/login` - ë¡œê·¸ì¸
- `POST /auth/logout` - ë¡œê·¸ì•„ì›ƒ
- `POST /auth/refresh` - í† í° ê°±ì‹ 
- `GET /users/me` - í”„ë¡œí•„ ì¡°íšŒ
- `PUT /users/me` - í”„ë¡œí•„ ìˆ˜ì •

**ë°ì´í„° ëª¨ë¸:**
- `users`: íšŒì› ì •ë³´ (ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ, CI, ê°€ì…ì¼ ë“±)
- `auth_tokens`: Refresh Token ì €ì¥
- `login_history`: ë¡œê·¸ì¸ ì´ë ¥ (ì„ íƒ)

**ì™¸ë¶€ ì—°ë™:**
- PortOne (ë³¸ì¸ì¸ì¦)
- reCAPTCHA (ë´‡ ì°¨ë‹¨)
- OAuth2 Provider (ì¹´ì¹´ì˜¤, ë„¤ì´ë²„, êµ¬ê¸€)

**ë°ì´í„° ì €ì¥ì†Œ:**
- PostgreSQL ìŠ¤í‚¤ë§ˆ: `user_service`
- Redis: í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ (`token:blacklist:{token}`)

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-AUTH-001 ~ REQ-AUTH-021 (21ê°œ)

---

#### 4.2.3 Event Service (ë‹´ë‹¹: Aê°œë°œì)

**ì±…ì„:**
- ê³µì—° CRUD (ê´€ë¦¬ì)
- ê³µì—° ëª©ë¡ ì¡°íšŒ (í˜ì´ì§•, í•„í„°ë§, ê²€ìƒ‰)
- ê³µì—° ìƒì„¸ ì¡°íšŒ
- ì¢Œì„ ì •ë³´ ì¡°íšŒ (ë“±ê¸‰ë³„ ê·¸ë£¹í•‘)
- ê³µì—°ì¥/í™€ ê´€ë¦¬
- ì¢Œì„ ì´ˆê¸°í™” (ê³µì—° ìƒì„± ì‹œ)
- Kafka ì´ë²¤íŠ¸ êµ¬ë…í•˜ì—¬ ì¢Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ (SOLD)
- Redis ìºì‹±ìœ¼ë¡œ ì¡°íšŒ ì„±ëŠ¥ ìµœì í™”

**ì£¼ìš” API:**
- `POST /events` - ê³µì—° ìƒì„± (ê´€ë¦¬ì)
- `GET /events` - ê³µì—° ëª©ë¡ ì¡°íšŒ
- `GET /events/{id}` - ê³µì—° ìƒì„¸ ì¡°íšŒ
- `GET /events/{id}/seats` - ì¢Œì„ ì •ë³´ ì¡°íšŒ
- `POST /venues` - ê³µì—°ì¥ ìƒì„± (ê´€ë¦¬ì)
- `POST /venues/{venueId}/halls` - í™€ ìƒì„± (ê´€ë¦¬ì)

**ë‚´ë¶€ API (ì„œë¹„ìŠ¤ ê°„ í†µì‹  ì „ìš©):**
- `GET /internal/seats/status/{eventId}` - SOLD ì¢Œì„ ID ëª©ë¡ ì¡°íšŒ (Reservation Serviceìš©)

**ë‚´ë¶€ API ìƒì„¸:**

`GET /internal/seats/status/{eventId}`
- **ëª©ì **: Reservation Serviceê°€ ì¢Œì„ ìƒíƒœ ì¡°íšŒ ì‹œ SOLD ì¢Œì„ í™•ì¸ìš©
- **ì¸ì¦**: ì„œë¹„ìŠ¤ ê°„ ë‚´ë¶€ í˜¸ì¶œ (API Key ë˜ëŠ” ì„œë¹„ìŠ¤ í† í°)
- **ì‘ë‹µ ì˜ˆì‹œ**:
  ```json
  {
    "eventId": "evt_123",
    "soldSeatIds": ["seat_001", "seat_042", "seat_103"]
  }
  ```
- **ì¿¼ë¦¬**: `SELECT id FROM seats WHERE event_id = ? AND status = 'SOLD'`
- **Rate Limiting**: ë¶ˆí•„ìš” (ë‚´ë¶€ í†µì‹ )

**ë°ì´í„° ëª¨ë¸:**
- `events`: ê³µì—° ì •ë³´
- `venues`: ê³µì—°ì¥ ì •ë³´
- `halls`: í™€ ì •ë³´ (ì¢Œì„ í…œí”Œë¦¿ í¬í•¨)
- `seats`: ì¢Œì„ ì •ë³´ (eventId, seatNumber, grade, price, status)

**Kafka Consumer:**
- `reservation.events`: ì˜ˆë§¤ ì´ë²¤íŠ¸ ìˆ˜ì‹ í•˜ì—¬ ì¢Œì„ ìƒíƒœ SOLD ì—…ë°ì´íŠ¸
- `payment.events`: ê²°ì œ ì‹¤íŒ¨ ì‹œ ì¢Œì„ ìƒíƒœ ë³µêµ¬

**ë°ì´í„° ì €ì¥ì†Œ:**
- PostgreSQL ìŠ¤í‚¤ë§ˆ: `event_service`
- Redis ìºì‹œ:
  - `cache:event:list` - ê³µì—° ëª©ë¡ (TTL: 5ë¶„)
  - `cache:event:{eventId}` - ê³µì—° ìƒì„¸ (TTL: 5ë¶„)
  - `cache:seats:{eventId}` - ì¢Œì„ ì •ë³´ (TTL: 5ë¶„)

**ì„±ëŠ¥ ëª©í‘œ:**
- ê³µì—° ëª©ë¡ ì¡°íšŒ: P95 < 200ms (REQ-EVT-004)
- ê³µì—° ìƒì„¸ ì¡°íšŒ: P95 < 100ms (REQ-EVT-005)
- ì¢Œì„ ì •ë³´ ì¡°íšŒ: P95 < 300ms (REQ-EVT-006)

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-EVT-001 ~ REQ-EVT-031 (24ê°œ)

---

#### 4.2.4 Queue Service (ë‹´ë‹¹: Aê°œë°œì)

**ì±…ì„:**
- ëŒ€ê¸°ì—´ ì§„ì… (Redis Sorted Set, ZADD NX)
- ëŒ€ê¸°ì—´ ìƒíƒœ ì¡°íšŒ (REST í´ë§, 5ì´ˆ ê¶Œì¥)
- ë°°ì¹˜ ìŠ¹ì¸ (1ì´ˆë§ˆë‹¤ 10ëª…, Lua ìŠ¤í¬ë¦½íŠ¸)
- Queue Token ë°œê¸‰ (Reservation Token, Payment Token)
- ëŒ€ê¸°ì—´ ìš©ëŸ‰ ì œí•œ (ê³µì—°ë‹¹ 50,000ëª…)
- ì‚¬ìš©ìë‹¹ ë™ì‹œ ëŒ€ê¸° 1ê°œ ê³µì—° ì œí•œ
- Token ë§Œë£Œ ì²˜ë¦¬ (TTL 10ë¶„)

**ì£¼ìš” API:**
- `POST /queue/enter` - ëŒ€ê¸°ì—´ ì§„ì…
- `GET /queue/status` - ëŒ€ê¸°ì—´ ìƒíƒœ ì¡°íšŒ (Rate Limit: 60íšŒ/ë¶„)
- `DELETE /queue/leave` - ëŒ€ê¸°ì—´ ì´íƒˆ (ì„ íƒ)
- `GET /queue/admin/stats` - ëŒ€ê¸°ì—´ í†µê³„ (ê´€ë¦¬ì, ì„ íƒ)

**ë°ì´í„° ëª¨ë¸ (Redis):**
- `queue:{eventId}`: Sorted Set (score: timestamp, member: userId)
- `queue:token:{token}`: String (userId, eventId, type) - TTL 10ë¶„
- `queue:active:{userId}`: String (eventId) - ì¤‘ë³µ ëŒ€ê¸° ë°©ì§€

**Lua ìŠ¤í¬ë¦½íŠ¸ (ë°°ì¹˜ ìŠ¹ì¸):**
```lua
-- 1ì´ˆë§ˆë‹¤ 10ëª… ìŠ¹ì¸
local eventId = KEYS[1]
local count = tonumber(ARGV[1]) or 10
local members = redis.call('ZRANGE', 'queue:' .. eventId, 0, count - 1)
if #members > 0 then
  redis.call('ZREM', 'queue:' .. eventId, unpack(members))
  -- Token ë°œê¸‰ ë¡œì§
end
return members
```

**ë°ì´í„° ì €ì¥ì†Œ:**
- Redis Sorted Set: ëŒ€ê¸°ì—´
- Redis String: Token, ì¤‘ë³µ ë°©ì§€

**ì„±ëŠ¥ ëª©í‘œ:**
- ì§„ì…: P95 < 100ms (REQ-QUEUE-015)
- ì¡°íšŒ: P95 < 50ms (REQ-QUEUE-015)
- ì²˜ë¦¬ëŸ‰: 36,000ëª…/ì‹œê°„ (10ëª…/ì´ˆ)

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-QUEUE-001 ~ REQ-QUEUE-021 (10ê°œ)

---

#### 4.2.5 Reservation Service (ë‹´ë‹¹: Bê°œë°œì)

**ì±…ì„:**
- ì¢Œì„ ì„ ì  (Redisson ë¶„ì‚° ë½, Redis 5ë¶„ TTL)
- ì¢Œì„ ë³€ê²½ (ê¸°ì¡´ ë½ í•´ì œ â†’ ì‹ ê·œ ë½ íšë“)
- ì¢Œì„ ìƒíƒœ ì¡°íšŒ (Redis HOLD + Event Service Feign í˜¸ì¶œë¡œ SOLD ì¡°íšŒ)
- ì˜ˆë§¤ í™•ì • (ê²°ì œ ì„±ê³µ ì´ë²¤íŠ¸ ìˆ˜ì‹ )
- ì˜ˆë§¤ ì·¨ì†Œ (ì‚¬ìš©ì ìš”ì²­, ë³´ìƒ íŠ¸ëœì­ì…˜)
- ì˜ˆë§¤ ë‚´ì—­ ì¡°íšŒ
- 1íšŒ ì˜ˆë§¤ ìµœëŒ€ 4ì¥ ì œí•œ
- Queue Token ê²€ì¦ (Reservation Token)

**ì£¼ìš” API:**
- `GET /reservations/seats/{eventId}` - ì¢Œì„ ìƒíƒœ ì¡°íšŒ
- `POST /reservations/hold` - ì¢Œì„ ì„ ì 
- `PUT /reservations/hold/{reservationId}` - ì¢Œì„ ë³€ê²½
- `DELETE /reservations/hold/{reservationId}` - ì„ ì  í•´ì œ
- `GET /reservations` - ë‚˜ì˜ ì˜ˆë§¤ ë‚´ì—­
- `DELETE /reservations/{id}` - ì˜ˆë§¤ ì·¨ì†Œ

**ë°ì´í„° ëª¨ë¸:**
- `reservations`: ì˜ˆë§¤ ì •ë³´ (userId, eventId, seatIds, status, createdAt)
  - status: PENDING / CONFIRMED / CANCELLED

**Kafka Producer:**
- `reservation.events`: ì˜ˆë§¤ ì·¨ì†Œ ì‹œ ì´ë²¤íŠ¸ ë°œí–‰

**Kafka Consumer:**
- `payment.events`: ê²°ì œ ì„±ê³µ ì‹œ ì˜ˆë§¤ í™•ì •, ê²°ì œ ì‹¤íŒ¨ ì‹œ ì˜ˆë§¤ ì·¨ì†Œ

**ë°ì´í„° ì €ì¥ì†Œ:**
- PostgreSQL ìŠ¤í‚¤ë§ˆ: `reservation_service`
- Redis ë¶„ì‚° ë½: `seat:hold:{eventId}:{seatId}` (TTL: 5ë¶„)
- Outbox: `common.outbox_events` (ì„ íƒ)

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-RSV-001 ~ REQ-RSV-013 (12ê°œ)

---

#### 4.2.6 Payment Service (ë‹´ë‹¹: Bê°œë°œì)

**ì±…ì„:**
- ê²°ì œ ìš”ì²­ (PortOne ì—°ë™)
- PortOne ì‚¬ì „ ê²€ì¦ (Prepare API)
- ê²°ì œ ìŠ¹ì¸ ë° í™•ì¸
- ê²°ì œ ìƒíƒœ ê´€ë¦¬ (PENDING/SUCCESS/FAILED/REFUNDED)
- ë©±ë“±ì„± ë³´ì¥ (paymentKey)
- SAGA ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ (ê²°ì œ ì„±ê³µ/ì‹¤íŒ¨ ë¶„ê¸°)
- ë³´ìƒ íŠ¸ëœì­ì…˜ (ê²°ì œ ì‹¤íŒ¨ ì‹œ ì˜ˆë§¤ ì·¨ì†Œ ì´ë²¤íŠ¸ ë°œí–‰)
- Queue Token ê²€ì¦ (Payment Token)
- Circuit Breaker (PortOne API ì¥ì•  ëŒ€ì‘)

**ì£¼ìš” API:**
- `POST /payments` - ê²°ì œ ìš”ì²­
- `POST /payments/confirm` - ê²°ì œ í™•ì¸
- `GET /payments/{id}` - ê²°ì œ ì¡°íšŒ
- `GET /payments` - ê²°ì œ ë‚´ì—­ ì¡°íšŒ (ì„ íƒ)

**ë°ì´í„° ëª¨ë¸:**
- `payments`: ê²°ì œ ì •ë³´ (reservationId, amount, paymentKey, status, portone_transaction_id)
  - status: PENDING / SUCCESS / FAILED / REFUNDED

**Kafka Producer:**
- `payment.events`: ê²°ì œ ì„±ê³µ/ì‹¤íŒ¨ ì´ë²¤íŠ¸ ë°œí–‰

**ì™¸ë¶€ ì—°ë™:**
- PortOne API (Prepare, Confirm)

**Resilience4j ì„¤ì •:**
- Timeout: 10ì´ˆ (REQ-PAY-008)
- Circuit Breaker: ì‹¤íŒ¨ìœ¨ 50% ì´ˆê³¼ ì‹œ Open, ëŒ€ê¸° 60ì´ˆ (REQ-PAY-009)

**ë°ì´í„° ì €ì¥ì†Œ:**
- PostgreSQL ìŠ¤í‚¤ë§ˆ: `payment_service`
- Outbox: `common.outbox_events` (í•„ìˆ˜)

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-PAY-001 ~ REQ-PAY-015 (15ê°œ)

---

### 4.3 ì„œë¹„ìŠ¤ ê°„ ì˜ì¡´ì„± ë° í†µì‹  ë°©ì‹

#### 4.3.1 ë™ê¸° í†µì‹  (REST/Feign)

| í˜¸ì¶œì | í”¼í˜¸ì¶œì | ëª©ì  | ë¹„ê³  |
|--------|----------|------|------|
| Gateway | All Services | ë¼ìš°íŒ… | JWT ê²€ì¦ í›„ ì „ë‹¬ |
| Reservation | Queue | Token ê²€ì¦ | Feign, Optional |
| Reservation | Event | SOLD ì¢Œì„ ì¡°íšŒ | Feign, ë‚´ë¶€ API |
| Payment | Queue | Token ê²€ì¦ | Feign, Optional |

#### 4.3.2 ë¹„ë™ê¸° í†µì‹  (Kafka)

| Producer | Topic | Consumer | Event Type |
|----------|-------|----------|------------|
| Reservation | reservation.events | Event | ì˜ˆë§¤ ì·¨ì†Œ â†’ ì¢Œì„ ë³µêµ¬ |
| Payment | payment.events | Reservation | ê²°ì œ ì„±ê³µ â†’ ì˜ˆë§¤ í™•ì • |
| Payment | payment.events | Reservation | ê²°ì œ ì‹¤íŒ¨ â†’ ì˜ˆë§¤ ì·¨ì†Œ |
| Payment | payment.events | Event | ê²°ì œ ì„±ê³µ â†’ ì¢Œì„ SOLD |

#### 4.3.3 ì˜ì¡´ì„± ê·¸ë˜í”„

```mermaid
graph LR
    Gateway --> User
    Gateway --> Event
    Gateway --> Queue
    Gateway --> Reservation
    Gateway --> Payment

    Reservation -.Feign.-> Queue
    Reservation -.Feign.-> Event
    Payment -.Feign.-> Queue

    Reservation -->|Kafka| Event
    Payment -->|Kafka| Reservation
    Payment -->|Kafka| Event
```

#### 4.3.4 Feign Client ì„¤ì •

**Reservation Serviceì˜ Event Service Client:**

```java
@FeignClient(name = "event-service", url = "${event.service.url:http://event-service:8082}")
public interface EventServiceClient {

    @GetMapping("/internal/seats/status/{eventId}")
    SoldSeatsResponse getSoldSeats(@PathVariable String eventId);

    @GetMapping("/events/{id}/seats")
    List<Seat> getEventSeats(@PathVariable String id);
}
```

**DTO ì •ì˜:**

```java
public class SoldSeatsResponse {
    private String eventId;
    private List<String> soldSeatIds;
}
```

**Timeout ì„¤ì •:**
- Connection Timeout: 2ì´ˆ
- Read Timeout: 3ì´ˆ
- Retry: 1íšŒ (GET ìš”ì²­ë§Œ)

**ë‚´ë¶€ API ë¼ìš°íŒ… ì •ì±…:**
- `/internal/**` ê²½ë¡œëŠ” API Gatewayë¥¼ í†µí•˜ì§€ ì•ŠìŒ
- ì„œë¹„ìŠ¤ ê°„ ì§ì ‘ í˜¸ì¶œ (ì„œë¹„ìŠ¤ ë””ìŠ¤ì»¤ë²„ë¦¬ ë˜ëŠ” ì§ì ‘ URL)
- ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥

---

### 4.4 ì„œë¹„ìŠ¤ë³„ ë‹´ë‹¹ì ë§¤í•‘

| ì„œë¹„ìŠ¤ | ë‹´ë‹¹ì | ì£¼ìš” ì±…ì„ |
|--------|--------|----------|
| API Gateway | Aê°œë°œì | ë¼ìš°íŒ…, ì¸ì¦, Rate Limiting |
| Event Service | Aê°œë°œì | ê³µì—°/ê³µì—°ì¥/ì¢Œì„ ê´€ë¦¬ |
| Queue Service | Aê°œë°œì | ëŒ€ê¸°ì—´ ê´€ë¦¬ |
| User Service | Bê°œë°œì | íšŒì›/ì¸ì¦ |
| Reservation Service | Bê°œë°œì | ì˜ˆë§¤ ê´€ë¦¬ |
| Payment Service | Bê°œë°œì | ê²°ì œ ì²˜ë¦¬ |

---

## 5. ì¸í”„ë¼ ì•„í‚¤í…ì²˜

### 5.1 ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨

```mermaid
graph TB
    subgraph "Client Layer"
        User[ì‚¬ìš©ì<br/>ë¸Œë¼ìš°ì €/ëª¨ë°”ì¼]
    end

    subgraph "CDN & Frontend (Vercel)"
        NextJS[Next.js 15+<br/>SSR/CSR]
    end

    subgraph "AWS Cloud (ap-northeast-2)"
        subgraph "Public Subnet"
            ALB[Application<br/>Load Balancer]
        end

        subgraph "Private Subnet"
            Gateway[API Gateway<br/>Spring Cloud Gateway<br/>ECS/EC2]

            subgraph "Microservices"
                User_Svc[User Service<br/>ECS/EC2]
                Event_Svc[Event Service<br/>ECS/EC2]
                Queue_Svc[Queue Service<br/>ECS/EC2]
                Reservation_Svc[Reservation Service<br/>ECS/EC2]
                Payment_Svc[Payment Service<br/>ECS/EC2]
            end

            Kafka[Kafka Broker<br/>EC2 t3.small]

            subgraph "Data Layer"
                RDS[(PostgreSQL 18<br/>RDS db.t3.micro<br/>ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤)]
                Redis[(ElastiCache Redis<br/>cache.t2.micro)]
            end
        end
    end

    subgraph "External Services"
        PortOne[PortOne<br/>ê²°ì œ PG]
        reCAPTCHA[Google reCAPTCHA]
        OAuth2[OAuth2 Provider<br/>ì¹´ì¹´ì˜¤/ë„¤ì´ë²„/êµ¬ê¸€]
    end

    subgraph "Monitoring & Logging"
        CloudWatch[AWS CloudWatch<br/>ë¡œê·¸/ë©”íŠ¸ë¦­/ì•ŒëŒ]
    end

    User -->|HTTPS| NextJS
    NextJS -->|API Request| ALB
    ALB -->|HTTP| Gateway
    Gateway --> User_Svc
    Gateway --> Event_Svc
    Gateway --> Queue_Svc
    Gateway --> Reservation_Svc
    Gateway --> Payment_Svc

    User_Svc --> RDS
    Event_Svc --> RDS
    Reservation_Svc --> RDS
    Payment_Svc --> RDS

    User_Svc --> Redis
    Event_Svc --> Redis
    Queue_Svc --> Redis
    Reservation_Svc --> Redis

    Reservation_Svc --> Kafka
    Payment_Svc --> Kafka
    Event_Svc --> Kafka

    User_Svc -.ì™¸ë¶€ API.-> reCAPTCHA
    User_Svc -.ì™¸ë¶€ API.-> OAuth2
    Payment_Svc -.ì™¸ë¶€ API.-> PortOne

    Gateway -.ë¡œê·¸/ë©”íŠ¸ë¦­.-> CloudWatch
    User_Svc -.ë¡œê·¸/ë©”íŠ¸ë¦­.-> CloudWatch
    Event_Svc -.ë¡œê·¸/ë©”íŠ¸ë¦­.-> CloudWatch
    Queue_Svc -.ë¡œê·¸/ë©”íŠ¸ë¦­.-> CloudWatch
    Reservation_Svc -.ë¡œê·¸/ë©”íŠ¸ë¦­.-> CloudWatch
    Payment_Svc -.ë¡œê·¸/ë©”íŠ¸ë¦­.-> CloudWatch
```

### 5.2 ë¡œì»¬ ê°œë°œ í™˜ê²½ (LocalStack ê¸°ë°˜)

#### 5.2.1 ê°œìš”
ë¡œì»¬ ê°œë°œ í™˜ê²½ì€ **LocalStack**ì„ ì‚¬ìš©í•˜ì—¬ AWS ì„œë¹„ìŠ¤ë¥¼ ì—ë®¬ë ˆì´ì…˜í•˜ê³ , **Docker Compose**ë¡œ ì „ì²´ ìŠ¤íƒì„ í†µí•© ê´€ë¦¬í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ ê°œë°œ ë¹„ìš©ì„ ì œë¡œë¡œ ìœ ì§€í•˜ë©´ì„œ AWSì™€ ë™ì¼í•œ í™˜ê²½ì—ì„œ ê°œë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### 5.2.2 Docker Compose êµ¬ì„±

**`docker-compose.yml` êµ¬ì¡°:**
```yaml
version: '3.8'

services:
  # LocalStack (AWS ì—ë®¬ë ˆì´ì…˜)
  localstack:
    image: localstack/localstack:latest
    ports:
      - "4566:4566"  # AWS API Endpoint
    environment:
      - SERVICES=s3,sqs,sns,secretsmanager
      - DEBUG=1
      - DATA_DIR=/tmp/localstack/data
    volumes:
      - "./localstack-data:/tmp/localstack/data"
      - "/var/run/docker.sock:/var/run/docker.sock"

  # PostgreSQL
  postgres:
    image: postgres:18-alpine
    ports:
      - "5432:5432"
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: ticketing
    volumes:
      - postgres-data:/var/lib/postgresql/data
      - ./init-db.sql:/docker-entrypoint-initdb.d/init-db.sql

  # Redis
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes
    volumes:
      - redis-data:/data

  # Kafka (Zookeeper + Broker)
  zookeeper:
    image: confluentinc/cp-zookeeper:7.5.0
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
    ports:
      - "2181:2181"

  kafka:
    image: confluentinc/cp-kafka:7.5.0
    depends_on:
      - zookeeper
    ports:
      - "9092:9092"
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1

  # API Gateway (ê°œë°œ ì‹œ ì‹¤í–‰)
  gateway:
    build: ./gateway
    ports:
      - "8080:8080"
    environment:
      SPRING_PROFILES_ACTIVE: local
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/ticketing
      SPRING_REDIS_HOST: redis
      SPRING_KAFKA_BOOTSTRAP_SERVERS: kafka:9092
    depends_on:
      - postgres
      - redis
      - kafka

  # User Service (ê°œë°œ ì‹œ ì‹¤í–‰)
  user-service:
    build: ./user-service
    ports:
      - "8081:8081"
    environment:
      SPRING_PROFILES_ACTIVE: local
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/ticketing
      SPRING_REDIS_HOST: redis
    depends_on:
      - postgres
      - redis

  # ... ê¸°íƒ€ ì„œë¹„ìŠ¤ (Event, Queue, Reservation, Payment)

volumes:
  postgres-data:
  redis-data:
```

#### 5.2.3 ì´ˆê¸° DB ìŠ¤í‚¤ë§ˆ ìƒì„±

**`init-db.sql`:**
```sql
-- ì„œë¹„ìŠ¤ë³„ ìŠ¤í‚¤ë§ˆ ìƒì„±
CREATE SCHEMA IF NOT EXISTS user_service;
CREATE SCHEMA IF NOT EXISTS event_service;
CREATE SCHEMA IF NOT EXISTS reservation_service;
CREATE SCHEMA IF NOT EXISTS payment_service;
CREATE SCHEMA IF NOT EXISTS common;

-- ì„œë¹„ìŠ¤ë³„ ì „ìš© ì‚¬ìš©ì ìƒì„± ë° ê¶Œí•œ ë¶€ì—¬
CREATE USER user_svc_user WITH PASSWORD 'user_password';
GRANT ALL PRIVILEGES ON SCHEMA user_service TO user_svc_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA user_service TO user_svc_user;

CREATE USER event_svc_user WITH PASSWORD 'event_password';
GRANT ALL PRIVILEGES ON SCHEMA event_service TO event_svc_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA event_service TO event_svc_user;

CREATE USER reservation_svc_user WITH PASSWORD 'reservation_password';
GRANT ALL PRIVILEGES ON SCHEMA reservation_service TO reservation_svc_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA reservation_service TO reservation_svc_user;

CREATE USER payment_svc_user WITH PASSWORD 'payment_password';
GRANT ALL PRIVILEGES ON SCHEMA payment_service TO payment_svc_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA payment_service TO payment_svc_user;

-- ê³µí†µ Outbox í…Œì´ë¸”
CREATE TABLE IF NOT EXISTS common.outbox_events (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  aggregate_type VARCHAR(255) NOT NULL,
  aggregate_id UUID NOT NULL,
  event_type VARCHAR(255) NOT NULL,
  payload JSONB NOT NULL,
  created_at TIMESTAMP NOT NULL DEFAULT NOW(),
  published BOOLEAN NOT NULL DEFAULT FALSE,
  published_at TIMESTAMP
);

CREATE INDEX idx_outbox_published ON common.outbox_events(published, created_at);
```

#### 5.2.4 ë¡œì»¬ â†’ AWS ì „í™˜ ì „ëµ

**ì „í™˜ ìµœì†Œí™” ë°©ì•ˆ:**
1. **í™˜ê²½ ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •**:
   - `application-local.yml` (ë¡œì»¬)
   - `application-prod.yml` (AWS)
   - ì—”ë“œí¬ì¸íŠ¸ë§Œ í™˜ê²½ë³€ìˆ˜ë¡œ ë³€ê²½ (S3, SQS, SNS ë“±)

2. **AWS SDK Profile í™œìš©**:
   ```java
   // LocalStack: http://localhost:4566
   // AWS: ê¸°ë³¸ ì—”ë“œí¬ì¸íŠ¸ (í™˜ê²½ë³€ìˆ˜ë¡œ ì œì–´)
   AmazonS3 s3Client = AmazonS3ClientBuilder.standard()
       .withEndpointConfiguration(new AwsClientBuilder.EndpointConfiguration(
           System.getenv("AWS_ENDPOINT_URL"),  // LocalStack: http://localhost:4566
           "ap-northeast-2"
       ))
       .build();
   ```

3. **Testcontainers í™œìš©** (í†µí•© í…ŒìŠ¤íŠ¸):
   ```java
   @Testcontainers
   class IntegrationTest {
       @Container
       static PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:18-alpine");

       @Container
       static GenericContainer<?> redis = new GenericContainer<>("redis:7-alpine")
           .withExposedPorts(6379);
   }
   ```

### 5.3 í”„ë¡ íŠ¸ì—”ë“œ ì¸í”„ë¼

#### 5.3.1 Next.js ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì¡°

**ê¸°ìˆ  ìŠ¤íƒ:**
- Next.js 15+ (App Router)
- React 19+
- TypeScript
- Tailwind CSS
- Zustand (ìƒíƒœ ê´€ë¦¬)

**í”„ë¡œì íŠ¸ êµ¬ì¡°:**
```
ticket-queue-frontend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (auth)/
â”‚   â”‚   â”œâ”€â”€ login/page.tsx
â”‚   â”‚   â”œâ”€â”€ register/page.tsx
â”‚   â”œâ”€â”€ (events)/
â”‚   â”‚   â”œâ”€â”€ events/page.tsx
â”‚   â”‚   â”œâ”€â”€ events/[id]/page.tsx
â”‚   â”œâ”€â”€ (queue)/
â”‚   â”‚   â”œâ”€â”€ queue/[eventId]/page.tsx
â”‚   â”œâ”€â”€ (reservation)/
â”‚   â”‚   â”œâ”€â”€ reservations/page.tsx
â”‚   â”‚   â”œâ”€â”€ reservations/[id]/page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ auth/
â”‚   â”œâ”€â”€ events/
â”‚   â”œâ”€â”€ queue/
â”‚   â”œâ”€â”€ reservation/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”œâ”€â”€ events.ts
â”‚   â”‚   â”œâ”€â”€ queue.ts
â”‚   â”‚   â”œâ”€â”€ reservations.ts
â”‚   â”œâ”€â”€ store/
â”‚   â”œâ”€â”€ utils/
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â”œâ”€â”€ package.json
```

#### 5.3.2 Vercel ë°°í¬ ì„¤ì •

**`vercel.json`:**
```json
{
  "buildCommand": "npm run build",
  "outputDirectory": ".next",
  "framework": "nextjs",
  "regions": ["icn1"],
  "env": {
    "NEXT_PUBLIC_API_URL": "https://api.ticketing.example.com"
  }
}
```

**í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬:**
| í™˜ê²½ | API Gateway URL | ë¹„ê³  |
|------|-----------------|------|
| Local | `http://localhost:8080` | Docker Compose |
| Staging | `https://api-staging.ticketing.example.com` | ì„ íƒ ì‚¬í•­ |
| Production | `https://api.ticketing.example.com` | ALB ì—”ë“œí¬ì¸íŠ¸ |

**Vercel ë°°í¬ í”„ë¡œì„¸ìŠ¤:**
1. GitHub ì €ì¥ì†Œ ì—°ë™
2. main ë¸Œëœì¹˜ push ì‹œ ìë™ ë°°í¬
3. Preview ë°°í¬: PR ìƒì„± ì‹œ ìë™ í”„ë¦¬ë·° í™˜ê²½ ìƒì„±
4. í™˜ê²½ ë³€ìˆ˜ëŠ” Vercel ëŒ€ì‹œë³´ë“œì—ì„œ ê´€ë¦¬

#### 5.3.3 API Gateway ì—°ë™ ì„¤ì •

**API Client ì„¤ì • (`lib/api/client.ts`):**
```typescript
import axios from 'axios';

const apiClient = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// JWT í† í° ìë™ ì¶”ê°€
apiClient.interceptors.request.use((config) => {
  const token = localStorage.getItem('accessToken');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// 401 ì‘ë‹µ ì‹œ í† í° ê°±ì‹ 
apiClient.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      // Token refresh ë¡œì§
      const refreshToken = localStorage.getItem('refreshToken');
      if (refreshToken) {
        const { data } = await axios.post(`${process.env.NEXT_PUBLIC_API_URL}/auth/refresh`, {
          refreshToken,
        });
        localStorage.setItem('accessToken', data.accessToken);
        // ì›ë˜ ìš”ì²­ ì¬ì‹œë„
        return apiClient.request(error.config);
      }
    }
    return Promise.reject(error);
  }
);

export default apiClient;
```

### 5.4 AWS í´ë¼ìš°ë“œ ì¸í”„ë¼ êµ¬ì„± (ë¬´ë£Œí‹°ì–´/ì €ë¹„ìš© ìµœì í™”)

#### 5.4.1 ë¦¬ì „ ë° ê°€ìš© ì˜ì—­
- **ë¦¬ì „**: `ap-northeast-2` (ì„œìš¸)
- **ê°€ìš© ì˜ì—­**: ì´ˆê¸° Single-AZ (`ap-northeast-2a`), í–¥í›„ Multi-AZ ì „í™˜

#### 5.4.2 ì»´í“¨íŠ¸ (Compute)

**ì˜µì…˜ 1: ECS Fargate (ê¶Œì¥)**
- **ì¥ì **: ì„œë²„ë¦¬ìŠ¤, ì˜¤í† ìŠ¤ì¼€ì¼ë§ ê°„í¸, ìš´ì˜ ë¶€ë‹´ ë‚®ìŒ
- **ë‹¨ì **: ë¬´ë£Œí‹°ì–´ ì—†ìŒ (ì›” ì•½ $30-50)
- **ìŠ¤í™**: 0.5 vCPU, 1GB RAM per task

**ì˜µì…˜ 2: EC2 (ë¹„ìš© ìµœì í™”)**
- **ì¸ìŠ¤í„´ìŠ¤ íƒ€ì…**: `t2.micro` (ë¬´ë£Œí‹°ì–´ 750ì‹œê°„/ì›”) ë˜ëŠ” `t3.micro`
- **ì¥ì **: ë¬´ë£Œí‹°ì–´ í™œìš© ê°€ëŠ¥, ë¹„ìš© ì €ë ´
- **ë‹¨ì **: ì„œë²„ ê´€ë¦¬ í•„ìš”, ì˜¤í† ìŠ¤ì¼€ì¼ë§ ë³µì¡
- **ë°°í¬ ë°©ì•ˆ**: ë‹¨ì¼ EC2ì— ëª¨ë“  ì„œë¹„ìŠ¤ ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (Docker Compose) ë˜ëŠ” ì„œë¹„ìŠ¤ë³„ EC2 ë¶„ë¦¬

**ì„ íƒ ê¸°ì¤€:**
- ì´ˆê¸°: EC2 t2.microë¡œ ì‹œì‘ (ë¬´ë£Œí‹°ì–´)
- íŠ¸ë˜í”½ ì¦ê°€ ì‹œ: ECS Fargateë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜

#### 5.4.3 ë¡œë“œ ë°¸ëŸ°ì„œ

**Application Load Balancer (ALB)**
- **ë¬´ë£Œí‹°ì–´**: ì—†ìŒ (ì‹œê°„ë‹¹ $0.0225 + LCU ê¸°ì¤€ ê³¼ê¸ˆ)
- **ì›” ì˜ˆìƒ ë¹„ìš©**: $16-20
- **ëŒ€ì•ˆ**: ALB ì—†ì´ Route 53 â†’ EC2 ì§ì ‘ ì—°ê²° (SSL ì¸ì¦ì„œëŠ” Let's Encrypt)
- **ê¶Œì¥**: ì´ˆê¸°ì—ëŠ” ALB ì‚¬ìš© (HTTPS, í—¬ìŠ¤ì²´í¬, Path ë¼ìš°íŒ…)

#### 5.4.4 ë°ì´í„°ë² ì´ìŠ¤

**Amazon RDS PostgreSQL**
- **ì¸ìŠ¤í„´ìŠ¤**: `db.t3.micro` (ë¬´ë£Œí‹°ì–´ 750ì‹œê°„/ì›”, 20GB ìŠ¤í† ë¦¬ì§€)
- **ë²„ì „**: PostgreSQL 18
- **Multi-AZ**: ì´ˆê¸° Single-AZ (ë¬´ë£Œí‹°ì–´), í–¥í›„ Multi-AZ ì „í™˜ ($$$)
- **ë°±ì—…**: ìë™ ë°±ì—… 1ì¼ ë³´ê´€ (ë¬´ë£Œ), 7ì¼ ë³´ê´€ ì‹œ ì¶”ê°€ ë¹„ìš©
- **ëª¨ë‹ˆí„°ë§**: Enhanced Monitoring ë¹„í™œì„±í™” (ë¹„ìš© ì ˆê°)
- **ìŠ¤í† ë¦¬ì§€**: ë²”ìš© SSD (gp3), 20GB (ë¬´ë£Œí‹°ì–´)

**ë¹„ìš© ìµœì í™”:**
- Single-AZ ë°°í¬
- ë°±ì—… ë³´ê´€ ê¸°ê°„ ìµœì†Œí™” (1ì¼)
- Read Replica ì œì™¸ (ì´ˆê¸°)
- Connection Pooling (ì„œë¹„ìŠ¤ë³„ HikariCP ì„¤ì •)

#### 5.4.5 ìºì‹œ ë° ë©”ëª¨ë¦¬ ìŠ¤í† ì–´

**Amazon ElastiCache Redis**
- **ë…¸ë“œ íƒ€ì…**: `cache.t2.micro` (ë¬´ë£Œí‹°ì–´ 750ì‹œê°„/ì›”) ë˜ëŠ” `cache.t3.micro`
- **ë²„ì „**: Redis 7.x
- **í´ëŸ¬ìŠ¤í„° ëª¨ë“œ**: ë¹„í™œì„±í™” (ë‹¨ì¼ ë…¸ë“œ)
- **Multi-AZ**: ë¹„í™œì„±í™” (ì´ˆê¸°)
- **ë°±ì—…**: ìë™ ë°±ì—… ë¹„í™œì„±í™” (ë¹„ìš© ì ˆê°)

**ë¹„ìš© ìµœì í™”:**
- ë‹¨ì¼ ë…¸ë“œ êµ¬ì„±
- ë°±ì—… ë¹„í™œì„±í™” (Redis ë°ì´í„°ëŠ” íœ˜ë°œì„±ìœ¼ë¡œ ê°„ì£¼)
- Replication ì œì™¸ (ì´ˆê¸°)

#### 5.4.6 ë©”ì‹œì§•

**Kafka on EC2 (ìì²´ êµ¬ì¶•)**
- **ì´ìœ **: Amazon MSKëŠ” ê³ ë¹„ìš© (ìµœì†Œ ì›” $200+)
- **ì¸ìŠ¤í„´ìŠ¤**: `t3.small` 1ëŒ€ (ì´ˆê¸°), í–¥í›„ 3ëŒ€ í´ëŸ¬ìŠ¤í„° í™•ì¥
- **ì›” ì˜ˆìƒ ë¹„ìš©**: $15-20 (t3.small 1ëŒ€ ê¸°ì¤€)
- **ìŠ¤í† ë¦¬ì§€**: EBS gp3 100GB

**ëŒ€ì•ˆ: Amazon SNS/SQS**
- **ì¥ì **: ì™„ì „ ê´€ë¦¬í˜•, ë¬´ë£Œí‹°ì–´ (SNS: 100ë§Œ ìš”ì²­, SQS: 100ë§Œ ìš”ì²­)
- **ë‹¨ì **: Kafkaì˜ ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ ë¶€ì¡±, ë©”ì‹œì§€ ìˆœì„œ ë³´ì¥ ì–´ë ¤ì›€
- **ê²°ë¡ **: Kafka ìœ ì§€ ê¶Œì¥ (ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë° í•„ìˆ˜)

#### 5.4.7 ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

**AWS CloudWatch**
- **ë¬´ë£Œí‹°ì–´**:
  - ë¡œê·¸ ìˆ˜ì§‘: 5GB/ì›”
  - ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­: 10ê°œ
  - ì•ŒëŒ: 10ê°œ
  - API ìš”ì²­: 100ë§Œ ê±´/ì›”
- **ì „ëµ**: ë¬´ë£Œí‹°ì–´ í•œë„ ë‚´ ìš´ì˜ (ì„¹ì…˜ 14ì—ì„œ ìƒì„¸ ì„¤ëª…)

**ë¹„ìš© ì´ˆê³¼ ë°©ì§€:**
- ë¡œê·¸ ë³´ê´€ ê¸°ê°„: 1ì¼
- í•µì‹¬ ë©”íŠ¸ë¦­ë§Œ ì„ ë³„ ìˆ˜ì§‘ (10ê°œ ì´ë‚´)
- ì•ŒëŒ ìµœì†Œí™” (10ê°œ ì´ë‚´)

#### 5.4.8 ë„ë©”ì¸ ë° DNS

**Amazon Route 53**
- **í˜¸ìŠ¤íŒ… ì˜ì—­**: $0.50/ì›” (1ê°œ)
- **DNS ì¿¼ë¦¬**: 100ë§Œ ê±´ë‹¹ $0.40
- **í—¬ìŠ¤ ì²´í¬**: $0.50/ê°œ (ì„ íƒ ì‚¬í•­)

**ë¹„ìš© ìµœì í™”:**
- ë‹¨ì¼ í˜¸ìŠ¤íŒ… ì˜ì—­
- í—¬ìŠ¤ ì²´í¬ ìµœì†Œí™” ë˜ëŠ” ì œì™¸

#### 5.4.9 ê¸°íƒ€ ì„œë¹„ìŠ¤

**Amazon ECR (ì»¨í…Œì´ë„ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬)**
- **ë¬´ë£Œí‹°ì–´**: 500MB ìŠ¤í† ë¦¬ì§€/ì›”
- **ì „ëµ**: ì´ë¯¸ì§€ ìµœì í™” (ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œ), ë¶ˆí•„ìš”í•œ ì´ë¯¸ì§€ ì‚­ì œ

**AWS Secrets Manager vs Parameter Store**
- **Secrets Manager**: $0.40/ì‹œí¬ë¦¿/ì›” (ë¹„ìš© ë°œìƒ)
- **Parameter Store**: ë¬´ë£Œ (Standard tier)
- **ì„ íƒ**: Parameter Store ì‚¬ìš© (DB ë¹„ë°€ë²ˆí˜¸, API í‚¤ ë“±)

### 5.5 ë¹„ìš© ìµœì í™” ì „ëµ

#### 5.5.1 ë¬´ë£Œí‹°ì–´ í™œìš© ì²´í¬ë¦¬ìŠ¤íŠ¸

| ì„œë¹„ìŠ¤ | ë¬´ë£Œí‹°ì–´ í•œë„ | ì´ˆê³¼ ì‹œ ë¹„ìš© | ëŒ€ì‘ ì „ëµ |
|--------|--------------|-------------|----------|
| EC2 | t2.micro 750ì‹œê°„/ì›” | $0.0116/ì‹œê°„ | ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ ìœ ì§€ |
| RDS | db.t3.micro 750ì‹œê°„/ì›”, 20GB | $0.017/ì‹œê°„, $0.115/GB | Single-AZ, ë°±ì—… ìµœì†Œí™” |
| ElastiCache | cache.t2.micro 750ì‹œê°„/ì›” | $0.017/ì‹œê°„ | ë‹¨ì¼ ë…¸ë“œ |
| ALB | ì—†ìŒ | $16-20/ì›” | í•„ìˆ˜ ì‚¬ìš© |
| CloudWatch | ë¡œê·¸ 5GB, ë©”íŠ¸ë¦­ 10ê°œ, ì•ŒëŒ 10ê°œ | $0.50/GB, $0.30/ë©”íŠ¸ë¦­, $0.10/ì•ŒëŒ | í•œë„ ì¤€ìˆ˜ |
| ECR | 500MB | $0.10/GB | ì´ë¯¸ì§€ ìµœì í™” |
| Route 53 | ì—†ìŒ | $0.50/ì›” | ë‹¨ì¼ í˜¸ìŠ¤íŒ… ì˜ì—­ |

**ì›” ì˜ˆìƒ ë¹„ìš© (ë¬´ë£Œí‹°ì–´ ìµœëŒ€ í™œìš©):**
- EC2 (Kafka): $15-20
- ALB: $16-20
- Route 53: $0.50
- CloudWatch (ì´ˆê³¼ ì‹œ): $0-5
- **í•©ê³„**: $30-45/ì›”

#### 5.5.2 ë¦¬ì†ŒìŠ¤ ìš°ì„ ìˆœìœ„

**í•„ìˆ˜ ë¦¬ì†ŒìŠ¤ (ë¹„ìš© ë°œìƒ ë¶ˆê°€í”¼):**
- ALB (HTTPS, Path ë¼ìš°íŒ…)
- Kafka EC2 (ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°)
- Route 53 (ë„ë©”ì¸)

**ë¬´ë£Œí‹°ì–´ í™œìš© ê°€ëŠ¥:**
- EC2 t2.micro (ë°±ì—”ë“œ ì„œë¹„ìŠ¤)
- RDS db.t3.micro (ë°ì´í„°ë² ì´ìŠ¤)
- ElastiCache cache.t2.micro (Redis)
- CloudWatch (í•œë„ ë‚´)

**ì„ íƒ ì‚¬í•­ (ì œì™¸ ë˜ëŠ” ìµœì†Œí™”):**
- Multi-AZ ë°°í¬
- Read Replica
- Enhanced Monitoring
- Auto Scaling (ìˆ˜ë™ ìŠ¤ì¼€ì¼ë§)
- Staging í™˜ê²½

#### 5.5.3 Auto Scaling ì „ëµ

**ì´ˆê¸° ì„¤ì •:**
- ìµœì†Œ ì¸ìŠ¤í„´ìŠ¤: 1ê°œ
- ìµœëŒ€ ì¸ìŠ¤í„´ìŠ¤: 3ê°œ
- Target Tracking: CPU 70%

**ë¹„ìš© ì ˆê°:**
- í‰ìƒì‹œ: 1ê°œ ì¸ìŠ¤í„´ìŠ¤ë¡œ ìš´ì˜
- í‹°ì¼“ ì˜¤í”ˆ ì‹œ: ìˆ˜ë™ ìŠ¤ì¼€ì¼ ì•„ì›ƒ (3ê°œ)
- ì™„ì „ ìë™í™” ì‹œ: CloudWatch ì•ŒëŒ ê¸°ë°˜ ìŠ¤ì¼€ì¼ë§ (ë¹„ìš© ì£¼ì˜)

#### 5.5.4 ê°œë°œ/ìŠ¤í…Œì´ì§• í™˜ê²½

**ì˜µì…˜ 1: Staging í™˜ê²½ ì œì™¸**
- Production í™˜ê²½ë§Œ ìš´ì˜
- ë¡œì»¬ ê°œë°œ í™˜ê²½ì—ì„œ ì¶©ë¶„í•œ í…ŒìŠ¤íŠ¸ ì§„í–‰

**ì˜µì…˜ 2: Production ê³µìœ **
- ë³„ë„ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë˜ëŠ” ì„œë¸Œë„ë©”ì¸ ì‚¬ìš©
- ë™ì¼ ì¸í”„ë¼ì—ì„œ Staging í™˜ê²½ êµ¬ì„±

**ì˜µì…˜ 3: ì£¼ë§ ìë™ ì¢…ë£Œ**
- AWS Lambdaë¡œ ì£¼ë§/ì•¼ê°„ Staging í™˜ê²½ ìë™ ì¢…ë£Œ
- ì›” ë¹„ìš© 30% ì ˆê° ê°€ëŠ¥

**ê¶Œì¥**: ì˜µì…˜ 1 (Staging ì œì™¸), í•„ìš” ì‹œ ì˜µì…˜ 2

#### 5.5.5 CloudWatch ë¡œê·¸ ìµœì í™”

**ë¡œê·¸ ë³´ê´€ ì „ëµ:**
- ì¼ë°˜ ë¡œê·¸: 1ì¼ ë³´ê´€
- ì¤‘ìš” ë¡œê·¸ (ì—ëŸ¬, ë³´ì•ˆ): 7ì¼ ë³´ê´€
- ë¡œê·¸ ê·¸ë£¹ë³„ í•„í„°: DEBUG ë¡œê·¸ ì œì™¸

**ë¬´ë£Œ í•œë„ ì¤€ìˆ˜:**
- ëª©í‘œ: 5GB/ì›” ì´ë‚´
- ëª¨ë‹ˆí„°ë§: CloudWatch Metricsë¡œ ì‚¬ìš©ëŸ‰ ì¶”ì 
- ì•ŒëŒ: 4GB ë„ë‹¬ ì‹œ ì•Œë¦¼

#### 5.5.6 S3 ìŠ¤í† ë¦¬ì§€ (ì„ íƒ ì‚¬í•­)

**ì‚¬ìš© ìš©ë„:**
- ì´ë¯¸ì§€ ì—…ë¡œë“œ (ê³µì—° í¬ìŠ¤í„° ë“±)
- ë¡œê·¸ ì•„ì¹´ì´ë¹™ (CloudWatch â†’ S3)

**ë¹„ìš© ìµœì í™”:**
- ë¬´ë£Œí‹°ì–´: 5GB Standard, 20,000 GET, 2,000 PUT
- Lifecycle Policy: 30ì¼ í›„ Glacier ì´ê´€
- CloudFront ì—°ë™ ì‹œ ì¶”ê°€ ë¹„ìš© ë°œìƒ (ì„ íƒ ì‚¬í•­)

### 5.6 ë„¤íŠ¸ì›Œí¬ êµ¬ì„± (ë¹„ìš© ì ˆê°)

#### 5.6.1 VPC ì„¤ê³„

**VPC êµ¬ì„±:**
```
VPC: 10.0.0.0/16 (ticket-queue-vpc)
â”œâ”€â”€ Public Subnet (10.0.1.0/24) - ap-northeast-2a
â”‚   â”œâ”€â”€ ALB
â”‚   â””â”€â”€ NAT Gateway (ì œì™¸ - ë¹„ìš© ì ˆê°)
â”œâ”€â”€ Private Subnet (10.0.10.0/24) - ap-northeast-2a
â”‚   â”œâ”€â”€ ECS/EC2 (ë°±ì—”ë“œ ì„œë¹„ìŠ¤)
â”‚   â”œâ”€â”€ RDS
â”‚   â”œâ”€â”€ ElastiCache
â”‚   â””â”€â”€ Kafka
```

**ë¹„ìš© ì ˆê° í¬ì¸íŠ¸:**
- **NAT Gateway ì œì™¸**: $0.045/ì‹œê°„ + ë°ì´í„° ì „ì†¡ ë¹„ìš© (ì›” $32+)
  - **ëŒ€ì•ˆ**: Private Subnet ë¦¬ì†ŒìŠ¤ëŠ” VPC Endpoint ë˜ëŠ” Public Subnet ë°°ì¹˜
- **Single-AZ**: Multi-AZ ë°ì´í„° ì „ì†¡ ë¹„ìš© ì œê±° ($0.01/GB)
- **VPC Peering ìµœì†Œí™”**: í•„ìš” ì‹œë§Œ êµ¬ì„±

#### 5.6.2 Security Group ê·œì¹™

**ALB Security Group (alb-sg):**
```
Inbound:
  - 80 (HTTP) from 0.0.0.0/0
  - 443 (HTTPS) from 0.0.0.0/0
Outbound:
  - 8080 to backend-sg (Gateway)
```

**Backend Services Security Group (backend-sg):**
```
Inbound:
  - 8080-8085 from alb-sg
Outbound:
  - 5432 to db-sg (PostgreSQL)
  - 6379 to redis-sg (Redis)
  - 9092 to kafka-sg (Kafka)
  - 443 to 0.0.0.0/0 (ì™¸ë¶€ API: PortOne, reCAPTCHA)
```

**Database Security Group (db-sg):**
```
Inbound:
  - 5432 from backend-sg
Outbound:
  - ëª¨ë‘ ì°¨ë‹¨
```

**Redis Security Group (redis-sg):**
```
Inbound:
  - 6379 from backend-sg
Outbound:
  - ëª¨ë‘ ì°¨ë‹¨
```

**Kafka Security Group (kafka-sg):**
```
Inbound:
  - 9092 from backend-sg
  - 2181 from backend-sg (Zookeeper)
Outbound:
  - ëª¨ë‘ í—ˆìš© (í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ í†µì‹ )
```

#### 5.6.3 ë°ì´í„° ì „ì†¡ ë¹„ìš© ìµœì†Œí™”

**ë™ì¼ AZ ë‚´ ë°°ì¹˜:**
- ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ `ap-northeast-2a` ë‹¨ì¼ AZì— ë°°ì¹˜
- AZ ê°„ ë°ì´í„° ì „ì†¡ ë¹„ìš© ì œê±° ($0.01/GB)

**ì™¸ë¶€ API í˜¸ì¶œ ìµœì†Œí™”:**
- PortOne, reCAPTCHA í˜¸ì¶œ íšŸìˆ˜ ìµœì†Œí™”
- API ì‘ë‹µ ìºì‹± (ê°€ëŠ¥í•œ ê²½ìš°)
- ë°ì´í„° ì „ì†¡ëŸ‰ ì••ì¶•

**CloudFront ì œì™¸ (ì´ˆê¸°):**
- Vercel CDNìœ¼ë¡œ ì •ì  ë¦¬ì†ŒìŠ¤ ì œê³µ
- APIëŠ” ALB ì§ì ‘ ì—°ê²°
- í•„ìš” ì‹œ CloudFront ì¶”ê°€ ($0.085/GB)

### 5.7 ê³ ê°€ìš©ì„± ë° í™•ì¥ì„± ì „ëµ (ë‹¨ê³„ì  ì ìš©)

#### 5.7.1 ì´ˆê¸° ì•„í‚¤í…ì²˜ (Single-AZ)

**ëª©í‘œ:** ë¹„ìš© ìµœì†Œí™”, ê¸°ë³¸ ê°€ìš©ì„± í™•ë³´

**êµ¬ì„±:**
- EC2/ECS: Single-AZ, 1-2 ì¸ìŠ¤í„´ìŠ¤
- RDS: Single-AZ, ìë™ ë°±ì—… 1ì¼
- ElastiCache: ë‹¨ì¼ ë…¸ë“œ
- Kafka: ë‹¨ì¼ ë¸Œë¡œì»¤

**ì˜ˆìƒ ê°€ìš©ì„±:** 99.5% (AWS SLA ê¸°ì¤€)

**ì œì•½ì‚¬í•­:**
- AZ ì¥ì•  ì‹œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨
- RDS ì¥ì•  ì‹œ ë³µêµ¬ ì‹œê°„ ë°œìƒ (Snapshot ê¸°ë°˜)
- Redis ì¥ì•  ì‹œ ìºì‹œ ì†ì‹¤ (ì„œë¹„ìŠ¤ ì§€ì† ê°€ëŠ¥)

#### 5.7.2 ì„±ì¥ ë‹¨ê³„ (Multi-AZ)

**ì „í™˜ ì‹œì :**
- ì›”ê°„ í™œì„± ì‚¬ìš©ì 10,000ëª… ì´ìƒ
- í‹°ì¼“ ì˜¤í”ˆ ì‹œ ë™ì‹œ ì ‘ì† 100,000ëª… ì´ìƒ
- ë¹„ìš© ì—¬ìœ  ë°œìƒ (ì›” $100+ ê°€ëŠ¥)

**êµ¬ì„±:**
```
VPC: 10.0.0.0/16
â”œâ”€â”€ Public Subnet A (10.0.1.0/24) - ap-northeast-2a
â”‚   â””â”€â”€ ALB (Multi-AZ)
â”œâ”€â”€ Public Subnet B (10.0.2.0/24) - ap-northeast-2b
â”‚   â””â”€â”€ ALB (Multi-AZ)
â”œâ”€â”€ Private Subnet A (10.0.10.0/24) - ap-northeast-2a
â”‚   â”œâ”€â”€ ECS/EC2 (ë°±ì—”ë“œ)
â”‚   â”œâ”€â”€ RDS Primary
â”‚   â”œâ”€â”€ ElastiCache Primary
â”‚   â””â”€â”€ Kafka Broker 1
â”œâ”€â”€ Private Subnet B (10.0.20.0/24) - ap-northeast-2b
â”‚   â”œâ”€â”€ ECS/EC2 (ë°±ì—”ë“œ)
â”‚   â”œâ”€â”€ RDS Standby
â”‚   â”œâ”€â”€ ElastiCache Replica
â”‚   â””â”€â”€ Kafka Broker 2
```

**ê°œì„  ì‚¬í•­:**
- RDS Multi-AZ: ìë™ í˜ì¼ì˜¤ë²„ (1-2ë¶„)
- ElastiCache Replication: ì½ê¸° ì„±ëŠ¥ í–¥ìƒ, ì¥ì•  ëŒ€ì‘
- Kafka 3 ë¸Œë¡œì»¤: Replication Factor 2-3
- ECS/EC2 Auto Scaling: ìµœì†Œ 2, ìµœëŒ€ 10

**ì˜ˆìƒ ê°€ìš©ì„±:** 99.95%

**ì¶”ê°€ ë¹„ìš©:**
- RDS Multi-AZ: +100% ($34/ì›”)
- ElastiCache Replica: +100% ($24/ì›”)
- Kafka 2ëŒ€ ì¶”ê°€: +$30/ì›”
- NAT Gateway (ì˜µì…˜): +$32/ì›”
- **í•©ê³„**: +$120-150/ì›”

#### 5.7.3 Auto Scaling ì •ì±…

**Target Tracking Scaling:**
```yaml
Target:
  - CPU Utilization: 70%
  - Memory Utilization: 80%
  - ALB Request Count: 1000 req/min per instance

Scale Out:
  - Cooldown: 60ì´ˆ
  - Increment: +1 ì¸ìŠ¤í„´ìŠ¤

Scale In:
  - Cooldown: 300ì´ˆ
  - Decrement: -1 ì¸ìŠ¤í„´ìŠ¤
```

**Step Scaling (ì„ íƒ ì‚¬í•­):**
```yaml
CPU > 80%:
  - +2 ì¸ìŠ¤í„´ìŠ¤ (ì¦‰ì‹œ)
CPU > 90%:
  - +3 ì¸ìŠ¤í„´ìŠ¤ (ì¦‰ì‹œ)
CPU < 40%:
  - -1 ì¸ìŠ¤í„´ìŠ¤ (5ë¶„ í›„)
```

#### 5.7.4 ì¥ì•  ë³µêµ¬ (Disaster Recovery) ê³„íš

**ë°±ì—… ì „ëµ:**
- **RDS**: ìë™ ë°±ì—… 1ì¼ ë³´ê´€ (ë¬´ë£Œ), ìˆ˜ë™ ìŠ¤ëƒ…ìƒ· 7ì¼ ë³´ê´€
- **Redis**: ë°ì´í„° íœ˜ë°œì„±, ë°±ì—… ì œì™¸
- **Kafka**: ë©”ì‹œì§€ ë³´ê´€ ê¸°ê°„ 3ì¼ (ë””ìŠ¤í¬ ìš©ëŸ‰ì— ë”°ë¼ ì¡°ì •)

**ë³µêµ¬ ì‹œë‚˜ë¦¬ì˜¤:**

| ì¥ì•  ìœ í˜• | RTO (ë³µêµ¬ ì‹œê°„) | RPO (ë°ì´í„° ì†ì‹¤) | ë³µêµ¬ ì ˆì°¨ |
|----------|----------------|------------------|----------|
| EC2 ì¸ìŠ¤í„´ìŠ¤ ë‹¤ìš´ | 5-10ë¶„ | ì—†ìŒ | Auto Scaling ë˜ëŠ” ìˆ˜ë™ ì¬ì‹œì‘ |
| RDS Single-AZ ì¥ì•  | 30-60ë¶„ | ìµœëŒ€ 5ë¶„ | Snapshotì—ì„œ ë³µêµ¬ |
| RDS Multi-AZ ì¥ì•  | 1-2ë¶„ | ì—†ìŒ | ìë™ í˜ì¼ì˜¤ë²„ |
| Redis ì¥ì•  | 5ë¶„ | ìºì‹œ ì†ì‹¤ | ì¬ì‹œì‘, ìºì‹œ ì¬êµ¬ì¶• |
| Kafka ë¸Œë¡œì»¤ ë‹¤ìš´ | 1ë¶„ | ì—†ìŒ (Replication) | ìë™ Leader ì¬ì„ ì¶œ |
| AZ ì „ì²´ ì¥ì•  | 60-120ë¶„ | ìµœëŒ€ 5ë¶„ | Multi-AZ ì „í™˜ í›„ ìë™ ë³µêµ¬ |

**ì´ˆê¸° ë‹¨ê³„ (Single-AZ) ì£¼ì˜ì‚¬í•­:**
- AZ ì¥ì•  ì‹œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨ ë¶ˆê°€í”¼
- ë°±ì—…ì—ì„œ ë³µêµ¬ ì‹œ ë‹¤ìš´íƒ€ì„ ë°œìƒ
- **ëŒ€ì‘**: CloudWatch ì•ŒëŒìœ¼ë¡œ ì¦‰ì‹œ ê°ì§€, ìˆ˜ë™ ë³µêµ¬

#### 5.7.5 í™•ì¥ì„± ë¡œë“œë§µ

**Phase 1 (í˜„ì¬): ë¹„ìš© ìµœì†Œí™”**
- Single-AZ, ìµœì†Œ ë¦¬ì†ŒìŠ¤
- ìˆ˜ë™ ìŠ¤ì¼€ì¼ë§
- ëª©í‘œ TPS: 100-500

**Phase 2 (6ê°œì›”): ê¸°ë³¸ ê³ ê°€ìš©ì„±**
- Multi-AZ ì „í™˜
- Auto Scaling í™œì„±í™”
- ëª©í‘œ TPS: 500-2000

**Phase 3 (1ë…„): ì„±ëŠ¥ ìµœì í™”**
- Redis Cluster ëª¨ë“œ
- Kafka í´ëŸ¬ìŠ¤í„° í™•ì¥ (5 ë¸Œë¡œì»¤)
- Read Replica ì¶”ê°€
- ëª©í‘œ TPS: 2000-10000

**Phase 4 (2ë…„): ì—”í„°í”„ë¼ì´ì¦ˆ**
- Multi-Region ë°°í¬
- CDN ìµœì í™”
- Serverless ì „í™˜ ê²€í† 
- ëª©í‘œ TPS: 10000+

---

## 6. ë°ì´í„° ì•„í‚¤í…ì²˜

### 6.1 ë°ì´í„°ë² ì´ìŠ¤ ì „ëµ

#### 6.1.1 PostgreSQL 18 - ë…¼ë¦¬ì  DB per Service + ë¬¼ë¦¬ì  í†µí•©

**ì„ íƒ ì´ìœ :**
- **ë¹„ìš© íš¨ìœ¨ì„±**: ë‹¨ì¼ RDS ì¸ìŠ¤í„´ìŠ¤ë¡œ ëª¨ë“  ì„œë¹„ìŠ¤ ì§€ì› (ë¬´ë£Œí‹°ì–´ í™œìš©)
- **MSA ì›ì¹™ ì¤€ìˆ˜**: ìŠ¤í‚¤ë§ˆ ë¶„ë¦¬ë¡œ ì„œë¹„ìŠ¤ë³„ ë°ì´í„° ê²©ë¦¬
- **í™•ì¥ ê°€ëŠ¥ì„±**: í–¥í›„ íŠ¸ë˜í”½ ì¦ê°€ ì‹œ ë¬¼ë¦¬ì  ë¶„ë¦¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ìš©ì´
- **PostgreSQL 18 ì¥ì **: ì„±ëŠ¥ ê°œì„ , JSON ì²˜ë¦¬ ìµœì í™”, íŒŒí‹°ì…”ë‹ ê°•í™”

**ì•„í‚¤í…ì²˜ ì›ì¹™:**
```
ë‹¨ì¼ PostgreSQL ì¸ìŠ¤í„´ìŠ¤
â”œâ”€â”€ user_service ìŠ¤í‚¤ë§ˆ (User Service ì „ìš©)
â”œâ”€â”€ event_service ìŠ¤í‚¤ë§ˆ (Event Service ì „ìš©)
â”œâ”€â”€ reservation_service ìŠ¤í‚¤ë§ˆ (Reservation Service ì „ìš©)
â”œâ”€â”€ payment_service ìŠ¤í‚¤ë§ˆ (Payment Service ì „ìš©)
â””â”€â”€ common ìŠ¤í‚¤ë§ˆ (ê³µí†µ: outbox_events)
```

**ì„œë¹„ìŠ¤ ê°„ ë°ì´í„° ì ‘ê·¼ ì œí•œ:**
- ê° ì„œë¹„ìŠ¤ëŠ” ìì‹ ì˜ ìŠ¤í‚¤ë§ˆë§Œ ì ‘ê·¼ ê°€ëŠ¥ (DB ì‚¬ìš©ì ê¶Œí•œ ë¶„ë¦¬)
- ì„œë¹„ìŠ¤ ê°„ ë°ì´í„° í•„ìš” ì‹œ REST API ë˜ëŠ” Kafka ì´ë²¤íŠ¸ë¡œë§Œ í†µì‹ 
- **ê¸ˆì§€**: ì„œë¹„ìŠ¤ Aê°€ ì„œë¹„ìŠ¤ Bì˜ ìŠ¤í‚¤ë§ˆì— ì§ì ‘ ì¿¼ë¦¬

#### 6.1.2 ìŠ¤í‚¤ë§ˆë³„ DB ì‚¬ìš©ì ë° ê¶Œí•œ

**ì‚¬ìš©ì ìƒì„± ë° ê¶Œí•œ ë¶€ì—¬:**
```sql
-- User Service ì „ìš© ì‚¬ìš©ì
CREATE USER user_svc_user WITH PASSWORD 'user_strong_password_here';
GRANT USAGE ON SCHEMA user_service TO user_svc_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA user_service TO user_svc_user;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA user_service TO user_svc_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA user_service GRANT ALL ON TABLES TO user_svc_user;

-- Event Service ì „ìš© ì‚¬ìš©ì
CREATE USER event_svc_user WITH PASSWORD 'event_strong_password_here';
GRANT USAGE ON SCHEMA event_service TO event_svc_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA event_service TO event_svc_user;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA event_service TO event_svc_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA event_service GRANT ALL ON TABLES TO event_svc_user;

-- Reservation Service ì „ìš© ì‚¬ìš©ì
CREATE USER reservation_svc_user WITH PASSWORD 'reservation_strong_password_here';
GRANT USAGE ON SCHEMA reservation_service TO reservation_svc_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA reservation_service TO reservation_svc_user;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA reservation_service TO reservation_svc_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA reservation_service GRANT ALL ON TABLES TO reservation_svc_user;

-- Payment Service ì „ìš© ì‚¬ìš©ì
CREATE USER payment_svc_user WITH PASSWORD 'payment_strong_password_here';
GRANT USAGE ON SCHEMA payment_service TO payment_svc_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA payment_service TO payment_svc_user;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA payment_service TO payment_svc_user;
ALTER DEFAULT PRIVILEGES IN SCHEMA payment_service GRANT ALL ON TABLES TO payment_svc_user;

-- ëª¨ë“  ì„œë¹„ìŠ¤ê°€ common ìŠ¤í‚¤ë§ˆ ì ‘ê·¼ (Outbox)
GRANT USAGE ON SCHEMA common TO user_svc_user, event_svc_user, reservation_svc_user, payment_svc_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA common TO user_svc_user, event_svc_user, reservation_svc_user, payment_svc_user;
```

**Spring Boot application.yml ì„¤ì • ì˜ˆì‹œ:**
```yaml
# User Service
spring:
  datasource:
    url: jdbc:postgresql://ticketing-db.xxx.ap-northeast-2.rds.amazonaws.com:5432/ticketing
    username: user_svc_user
    password: ${DB_PASSWORD}  # AWS Secrets Manager ë˜ëŠ” í™˜ê²½ë³€ìˆ˜
    schema: user_service  # ê¸°ë³¸ ìŠ¤í‚¤ë§ˆ ì„¤ì •
  jpa:
    properties:
      hibernate:
        default_schema: user_service
```

#### 6.1.3 í–¥í›„ ë¬¼ë¦¬ì  ë¶„ë¦¬ ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš

**ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì :**
- ì›”ê°„ í™œì„± ì‚¬ìš©ì 50,000ëª… ì´ìƒ
- DB CPU ì‚¬ìš©ë¥  ì§€ì†ì ìœ¼ë¡œ 70% ì´ìƒ
- ì»¤ë„¥ì…˜ í’€ ê³ ê°ˆ ë¹ˆë²ˆ

**ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ:**
1. **Read Replica ì¶”ê°€** (ë‹¨ê³„ 1):
   - ì¡°íšŒ íŠ¸ë˜í”½ì´ ë§ì€ Event Serviceë¥¼ Read Replicaë¡œ ë¶„ë¦¬
   - ì“°ê¸°: Primary, ì½ê¸°: Replica

2. **ì„œë¹„ìŠ¤ë³„ DB ë¶„ë¦¬** (ë‹¨ê³„ 2):
   - User/Event/Reservation/Payment Service ê°ê° ë…ë¦½ RDS ì¸ìŠ¤í„´ìŠ¤
   - AWS DMS (Database Migration Service)ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
   - Zero-Downtime ë§ˆì´ê·¸ë ˆì´ì…˜ (Dual Write â†’ Cutover)

### 6.2 ERD (Entity Relationship Diagram)

#### 6.2.1 User Service ìŠ¤í‚¤ë§ˆ ERD

**ìŠ¤í‚¤ë§ˆ: `user_service`**

```mermaid
erDiagram
    users ||--o{ auth_tokens : has
    users ||--o{ login_history : has
    users ||--o{ terms_agreements : has

    users {
        uuid id PK
        varchar email UK "ì•”í˜¸í™”"
        varchar password_hash "BCrypt"
        varchar name "ì•”í˜¸í™”"
        varchar phone "ì•”í˜¸í™”"
        varchar ci UK "ë³¸ì¸ì¸ì¦ CI"
        varchar di "ë³¸ì¸ì¸ì¦ DI"
        varchar role "USER/ADMIN"
        varchar status "ACTIVE/INACTIVE/DORMANT/DELETED"
        timestamp created_at
        timestamp updated_at
        timestamp last_login_at
        timestamp deleted_at
    }

    auth_tokens {
        uuid id PK
        uuid user_id FK
        varchar refresh_token UK
        timestamp expires_at
        timestamp created_at
    }

    login_history {
        uuid id PK
        uuid user_id FK
        varchar ip_address
        varchar user_agent
        varchar login_method "EMAIL/KAKAO/NAVER/GOOGLE"
        boolean success
        varchar failure_reason
        timestamp created_at
    }

    terms_agreements {
        uuid id PK
        uuid user_id FK
        varchar terms_type "SERVICE/PRIVACY/MARKETING"
        boolean agreed
        varchar terms_version
        timestamp agreed_at
    }
```

**ì£¼ìš” í…Œì´ë¸” ì„¤ëª…:**

**`users` í…Œì´ë¸”:**
- **id**: UUID Primary Key
- **email**: ì´ë©”ì¼ (Unique, AES-256 ì•”í˜¸í™” - ì„ íƒ)
- **password_hash**: BCrypt í•´ì‹œ
- **name, phone**: ê°œì¸ì •ë³´ (AES-256 ì•”í˜¸í™” - ì„ íƒ)
- **ci, di**: ë³¸ì¸ì¸ì¦ CI/DI (Unique, CIëŠ” 1ì¸ 1ê³„ì • ê°•ì œ)
- **role**: USER / ADMIN
- **status**: ACTIVE / INACTIVE / DORMANT (1ë…„ ë¯¸ì ‘ì†) / DELETED (Soft Delete)
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-AUTH-001, REQ-AUTH-014, REQ-AUTH-017, REQ-AUTH-019

**`auth_tokens` í…Œì´ë¸”:**
- Refresh Token ì €ì¥ (Access Tokenì€ JWT ìì²´ë¡œ ê²€ì¦)
- TTL: 7ì¼
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-AUTH-009 (í† í° ê°±ì‹ )

**`login_history` í…Œì´ë¸”:**
- ë¡œê·¸ì¸ ì´ë ¥ ì¶”ì  (ì„ íƒ)
- ì˜ì‹¬ ì ‘ì† íƒì§€ìš©
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-AUTH-020

**`terms_agreements` í…Œì´ë¸”:**
- ì•½ê´€ ë™ì˜ ì´ë ¥
- ì•½ê´€ ë²„ì „ ê´€ë¦¬
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-AUTH-002

#### 6.2.2 Event Service ìŠ¤í‚¤ë§ˆ ERD

**ìŠ¤í‚¤ë§ˆ: `event_service`**

```mermaid
erDiagram
    venues ||--o{ halls : has
    halls ||--o{ events : hosts
    events ||--o{ seats : contains

    venues {
        uuid id PK
        varchar name
        varchar address
        varchar city
        timestamp created_at
        timestamp updated_at
    }

    halls {
        uuid id PK
        uuid venue_id FK
        varchar name
        int capacity
        jsonb seat_template "ì¢Œì„ ë°°ì¹˜ í…œí”Œë¦¿"
        timestamp created_at
        timestamp updated_at
    }

    events {
        uuid id PK
        varchar title
        varchar artist
        text description
        uuid venue_id FK
        uuid hall_id FK
        timestamp event_start_at
        timestamp event_end_at
        timestamp sale_start_at
        timestamp sale_end_at
        varchar status "UPCOMING/ONGOING/ENDED/CANCELLED"
        timestamp created_at
        timestamp updated_at
    }

    seats {
        uuid id PK
        uuid event_id FK
        varchar seat_number "A-1, B-10 ë“±"
        varchar grade "VIP/S/A/B"
        decimal price
        varchar status "AVAILABLE/SOLD"
        timestamp created_at
        timestamp updated_at
    }
```

**ì£¼ìš” í…Œì´ë¸” ì„¤ëª…:**

**`venues` í…Œì´ë¸”:**
- ê³µì—°ì¥ ì •ë³´
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-EVT-010

**`halls` í…Œì´ë¸”:**
- ê³µì—°ì¥ ë‚´ í™€ ì •ë³´
- **seat_template (JSONB)**: ì¢Œì„ ë°°ì¹˜ í…œí”Œë¦¿ (í–‰/ì—´, ë“±ê¸‰ ë§¤í•‘)
  ```json
  {
    "rows": ["A", "B", "C"],
    "seatsPerRow": 20,
    "gradeMapping": {
      "A": "VIP",
      "B": "S",
      "C": "A"
    }
  }
  ```
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-EVT-013

**`events` í…Œì´ë¸”:**
- ê³µì—° ì •ë³´
- **status**: UPCOMING (íŒë§¤ ì „) / ONGOING (íŒë§¤ ì¤‘) / ENDED (ì¢…ë£Œ) / CANCELLED (ì·¨ì†Œ)
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-EVT-001, REQ-EVT-007

**`seats` í…Œì´ë¸”:**
- ê³µì—°ë³„ ì¢Œì„ ì •ë³´
- **status**: AVAILABLE / SOLD (HOLDëŠ” Redisë¡œ ê´€ë¦¬)
- ê³µì—° ìƒì„± ì‹œ hallì˜ seat_template ê¸°ë°˜ìœ¼ë¡œ ìë™ ìƒì„±
- **ì¸ë±ìŠ¤**: `idx_seats_event_status (event_id, status)` - ì¢Œì„ ì¡°íšŒ ì„±ëŠ¥ ìµœì í™”
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-EVT-008, REQ-EVT-019

#### 6.2.3 Reservation Service ìŠ¤í‚¤ë§ˆ ERD

**ìŠ¤í‚¤ë§ˆ: `reservation_service`**

```mermaid
erDiagram
    reservations ||--o{ reservation_seats : contains

    reservations {
        uuid id PK
        uuid user_id "User Service ì°¸ì¡° (IDë§Œ)"
        uuid event_id "Event Service ì°¸ì¡° (IDë§Œ)"
        varchar status "PENDING/CONFIRMED/CANCELLED"
        decimal total_amount
        timestamp hold_expires_at "ì„ ì  ë§Œë£Œ ì‹œê°„ (5ë¶„)"
        timestamp created_at
        timestamp updated_at
    }

    reservation_seats {
        uuid id PK
        uuid reservation_id FK
        uuid seat_id "Event Service ì°¸ì¡° (IDë§Œ)"
        varchar seat_number
        varchar grade
        decimal price
    }
```

**ì£¼ìš” í…Œì´ë¸” ì„¤ëª…:**

**`reservations` í…Œì´ë¸”:**
- ì˜ˆë§¤ ì •ë³´
- **status**:
  - PENDING: ì¢Œì„ ì„ ì  ì™„ë£Œ, ê²°ì œ ëŒ€ê¸°
  - CONFIRMED: ê²°ì œ ì™„ë£Œ, ì˜ˆë§¤ í™•ì •
  - CANCELLED: ì˜ˆë§¤ ì·¨ì†Œ
- **hold_expires_at**: ì„ ì  ë§Œë£Œ ì‹œê°„ (í˜„ì¬ ì‹œê°„ + 5ë¶„)
- **user_id, event_id**: ë‹¤ë¥¸ ì„œë¹„ìŠ¤ì˜ IDë§Œ ì°¸ì¡° (FK ì—†ìŒ, MSA ì›ì¹™)
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-RSV-001, REQ-RSV-004, REQ-RSV-006

**`reservation_seats` í…Œì´ë¸”:**
- ì˜ˆë§¤ì— í¬í•¨ëœ ì¢Œì„ ëª©ë¡ (1íšŒ ìµœëŒ€ 4ì¥)
- ì¢Œì„ ì •ë³´ ìŠ¤ëƒ…ìƒ· (seat_number, grade, price) - ê³µì—° ì •ë³´ ë³€ê²½ì—ë„ ì˜ˆë§¤ ì •ë³´ ìœ ì§€
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-RSV-005

#### 6.2.4 Payment Service ìŠ¤í‚¤ë§ˆ ERD

**ìŠ¤í‚¤ë§ˆ: `payment_service`**

```mermaid
erDiagram
    payments {
        uuid id PK
        uuid reservation_id "Reservation Service ì°¸ì¡° (IDë§Œ)"
        uuid user_id "User Service ì°¸ì¡° (IDë§Œ)"
        varchar payment_key UK "ë©±ë“±ì„± í‚¤"
        decimal amount
        varchar payment_method "CARD"
        varchar status "PENDING/SUCCESS/FAILED/REFUNDED"
        varchar portone_transaction_id "PortOne ê±°ë˜ ID"
        text portone_response "PortOne ì‘ë‹µ (JSONB)"
        text failure_reason
        timestamp paid_at
        timestamp created_at
        timestamp updated_at
    }
```

**ì£¼ìš” í…Œì´ë¸” ì„¤ëª…:**

**`payments` í…Œì´ë¸”:**
- ê²°ì œ ì •ë³´
- **payment_key**: ë©±ë“±ì„± í‚¤ (í´ë¼ì´ì–¸íŠ¸ ìƒì„±, Unique)
- **status**:
  - PENDING: ê²°ì œ ìš”ì²­ ì¤‘
  - SUCCESS: ê²°ì œ ì„±ê³µ
  - FAILED: ê²°ì œ ì‹¤íŒ¨
  - REFUNDED: í™˜ë¶ˆ ì™„ë£Œ
- **portone_transaction_id**: PortOne ê±°ë˜ ID (ê²°ì œ ì¡°íšŒ/ì·¨ì†Œìš©)
- **portone_response**: PortOne API ì‘ë‹µ ì „ì²´ (JSONB, ë””ë²„ê¹…/ê°ì‚¬ìš©)
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-PAY-001, REQ-PAY-003, REQ-PAY-004, REQ-PAY-006

#### 6.2.5 ê³µí†µ ìŠ¤í‚¤ë§ˆ (Transactional Outbox)

**ìŠ¤í‚¤ë§ˆ: `common`**

```mermaid
erDiagram
    outbox_events {
        uuid id PK
        varchar aggregate_type "Reservation/Payment/Event"
        uuid aggregate_id
        varchar event_type "ReservationConfirmed/PaymentSuccess ë“±"
        jsonb payload "ì´ë²¤íŠ¸ ë°ì´í„°"
        timestamp created_at
        boolean published
        timestamp published_at
        int retry_count
    }
```

**ì£¼ìš” í…Œì´ë¸” ì„¤ëª…:**

**`outbox_events` í…Œì´ë¸”:**
- Transactional Outbox íŒ¨í„´ êµ¬í˜„
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ ë™ì¼ íŠ¸ëœì­ì…˜ ë‚´ INSERT
- Poller/CDCê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì½ì–´ Kafka ë°œí–‰
- **aggregate_type**: ì´ë²¤íŠ¸ ë°œí–‰ ì£¼ì²´ (Reservation, Payment, Event)
- **event_type**: ì´ë²¤íŠ¸ íƒ€ì… (ReservationConfirmed, PaymentSuccess, PaymentFailed ë“±)
- **payload (JSONB)**: ì´ë²¤íŠ¸ ë°ì´í„°
  ```json
  {
    "reservationId": "uuid",
    "userId": "uuid",
    "eventId": "uuid",
    "seatIds": ["uuid1", "uuid2"],
    "totalAmount": 100000,
    "confirmedAt": "2026-01-11T10:00:00Z"
  }
  ```
- **published**: Kafka ë°œí–‰ ì—¬ë¶€
- **retry_count**: ë°œí–‰ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ íšŸìˆ˜
- **ì¸ë±ìŠ¤**: `idx_outbox_published_created (published, created_at)` - Poller ì„±ëŠ¥ ìµœì í™”
- **ê´€ë ¨ ìš”êµ¬ì‚¬í•­**: REQ-RSV-012, REQ-PAY-013

### 6.3 Redis ì•„í‚¤í…ì²˜

#### 6.3.1 Redis ì¸ìŠ¤í„´ìŠ¤ êµ¬ì„±

**ë¡œì»¬ ê°œë°œ:**
- Docker Redis 7.x ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤
- í¬íŠ¸: 6379
- Persistence: AOF + RDB

**AWS ìš´ì˜:**
- ElastiCache Redis 7.x
- ë…¸ë“œ íƒ€ì…: `cache.t2.micro` (ë¬´ë£Œí‹°ì–´) ë˜ëŠ” `cache.t3.micro`
- í´ëŸ¬ìŠ¤í„° ëª¨ë“œ: ë¹„í™œì„±í™” (ë‹¨ì¼ ë…¸ë“œ)
- Multi-AZ: ë¹„í™œì„±í™” (ì´ˆê¸°), í–¥í›„ Replication ì „í™˜
- ë°±ì—…: ë¹„í™œì„±í™” (ë¹„ìš© ì ˆê°, ë°ì´í„° íœ˜ë°œì„±)

#### 6.3.2 Redis ë°ì´í„° ëª¨ë¸ ì„¤ê³„

**ë°ì´í„° íƒ€ì…ë³„ ìš©ë„:**

| Key Pattern | ë°ì´í„° íƒ€ì… | ìš©ë„ | TTL | ì„œë¹„ìŠ¤ |
|-------------|------------|------|-----|--------|
| `queue:{eventId}` | Sorted Set | ëŒ€ê¸°ì—´ (score: timestamp) | ì—†ìŒ | Queue |
| `queue:token:{token}` | String | Queue Token (qr_xxx, qp_xxx) | 10ë¶„ | Queue |
| `queue:active:{userId}` | String | ì‚¬ìš©ì í™œì„± ëŒ€ê¸°ì—´ (ì¤‘ë³µ ë°©ì§€) | 10ë¶„ | Queue |
| `seat:hold:{eventId}:{seatId}` | String | ì¢Œì„ ì„ ì  ë½ (userId) | 5ë¶„ | Reservation |
| `token:blacklist:{token}` | String | Access Token ë¸”ë™ë¦¬ìŠ¤íŠ¸ | 1ì‹œê°„ | User |
| `cache:event:list` | String (JSON) | ê³µì—° ëª©ë¡ ìºì‹œ | 5ë¶„ | Event |
| `cache:event:{eventId}` | Hash | ê³µì—° ìƒì„¸ ìºì‹œ | 5ë¶„ | Event |
| `cache:seats:{eventId}` | Hash | ì¢Œì„ ì •ë³´ ìºì‹œ | 5ë¶„ | Event |

#### 6.3.3 ëŒ€ê¸°ì—´ (Queue Service)

**1. Sorted Set - ëŒ€ê¸°ì—´**

**Key:** `queue:{eventId}`
**íƒ€ì…:** Sorted Set
**Score:** Unix Timestamp (ì§„ì… ì‹œê°)
**Member:** `userId`

```redis
ZADD queue:event-123 1736582400 user-abc
ZADD queue:event-123 1736582401 user-def

# ìˆœìœ„ ì¡°íšŒ (0-based)
ZRANK queue:event-123 user-abc  # ê²°ê³¼: 0 (1ë“±)

# ëŒ€ê¸°ì—´ í¬ê¸°
ZCARD queue:event-123

# ìƒìœ„ 10ëª… ì¡°íšŒ
ZRANGE queue:event-123 0 9 WITHSCORES

# ë°°ì¹˜ ìŠ¹ì¸ (Lua ìŠ¤í¬ë¦½íŠ¸)
EVAL "..." 1 queue:event-123 10
```

**2. String - Queue Token**

**Key:** `queue:token:{token}`
**Value:** JSON (userId, eventId, type, issuedAt)

```redis
SET queue:token:qr_abc123xyz '{"userId":"user-abc","eventId":"event-123","type":"RESERVATION","issuedAt":"2026-01-11T10:00:00Z"}' EX 600

# Token ê²€ì¦
GET queue:token:qr_abc123xyz
```

**3. String - ì¤‘ë³µ ëŒ€ê¸° ë°©ì§€**

**Key:** `queue:active:{userId}`
**Value:** `eventId`

```redis
SET queue:active:user-abc event-123 EX 600

# ì¤‘ë³µ ëŒ€ê¸° í™•ì¸
EXISTS queue:active:user-abc
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-QUEUE-001, REQ-QUEUE-003, REQ-QUEUE-004, REQ-QUEUE-021

#### 6.3.4 ì¢Œì„ ì„ ì  (Reservation Service)

**ë¶„ì‚° ë½ - Redisson**

**Key:** `seat:hold:{eventId}:{seatId}`
**Value:** `userId`
**TTL:** 5ë¶„

```java
// Redisson ë¶„ì‚° ë½
RLock lock = redissonClient.getLock("seat:hold:event-123:seat-456");
boolean acquired = lock.tryLock(3, 300, TimeUnit.SECONDS);  // waitTime: 3ì´ˆ, leaseTime: 300ì´ˆ

if (acquired) {
    try {
        // ì¢Œì„ ì„ ì  ë¡œì§
        // ì˜ˆë§¤ ì •ë³´ DB ì €ì¥ (PENDING)
    } finally {
        lock.unlock();
    }
} else {
    throw new SeatAlreadyHoldException();
}
```

**ìˆ˜ë™ ë½ ê´€ë¦¬ (ëŒ€ì•ˆ):**
```redis
# ë½ íšë“ (NX: Not Exists)
SET seat:hold:event-123:seat-456 user-abc NX EX 300

# ë½ í•´ì œ
DEL seat:hold:event-123:seat-456
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-RSV-001, REQ-RSV-007

#### 6.3.5 í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸ (User Service)

**Key:** `token:blacklist:{token}`
**Value:** `1` (ì¡´ì¬ ì—¬ë¶€ë§Œ í™•ì¸)
**TTL:** Access Token ë§Œë£Œ ì‹œê°„ (1ì‹œê°„)

```redis
# ë¡œê·¸ì•„ì›ƒ ì‹œ ë¸”ë™ë¦¬ìŠ¤íŠ¸ ë“±ë¡
SET token:blacklist:eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... 1 EX 3600

# í† í° ê²€ì¦ ì‹œ ë¸”ë™ë¦¬ìŠ¤íŠ¸ í™•ì¸
EXISTS token:blacklist:eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-AUTH-008, REQ-AUTH-010

#### 6.3.6 ìºì‹± (Event Service)

**1. ê³µì—° ëª©ë¡ ìºì‹œ**

**Key:** `cache:event:list:{page}:{size}:{filters}`
**íƒ€ì…:** String (JSON)
**TTL:** 5ë¶„ (í‹°ì¼“íŒ… ì˜¤í”ˆ ì‹œ 1ë¶„ìœ¼ë¡œ ë‹¨ì¶•)

```redis
SET cache:event:list:0:20:upcoming '[{"id":"event-123","title":"ì½˜ì„œíŠ¸ A",...}]' EX 300
```

**2. ê³µì—° ìƒì„¸ ìºì‹œ**

**Key:** `cache:event:{eventId}`
**íƒ€ì…:** Hash
**TTL:** 5ë¶„

```redis
HSET cache:event:event-123 title "ì½˜ì„œíŠ¸ A" artist "ì•„í‹°ìŠ¤íŠ¸ A" ...
EXPIRE cache:event:event-123 300

# ì¡°íšŒ
HGETALL cache:event:event-123
```

**3. ì¢Œì„ ì •ë³´ ìºì‹œ**

**Key:** `cache:seats:{eventId}`
**íƒ€ì…:** Hash (gradeë³„ ê·¸ë£¹í•‘)
**TTL:** 5ë¶„

```redis
HSET cache:seats:event-123 VIP '{"available":50,"price":150000}' S '{"available":100,"price":100000}'
EXPIRE cache:seats:event-123 300
```

**ìºì‹œ ë¬´íš¨í™” ì „ëµ:**
- ê³µì—°/ì¢Œì„ ì •ë³´ ë³€ê²½ ì‹œ Kafka ì´ë²¤íŠ¸ ë°œí–‰
- Event Service Consumerê°€ í•´ë‹¹ ìºì‹œ ì‚­ì œ (DEL)
- ë‹¤ìŒ ì¡°íšŒ ì‹œ DBì—ì„œ ì¬êµ¬ì¶• (Cache-Aside íŒ¨í„´)

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-EVT-017, REQ-EVT-020

#### 6.3.7 TTL ì „ëµ

| ë°ì´í„° | TTL | ê·¼ê±° | ê´€ë ¨ ìš”êµ¬ì‚¬í•­ |
|--------|-----|------|--------------|
| Queue Token | 10ë¶„ | ëŒ€ê¸°ì—´ ì§„ì… í›„ ì¶©ë¶„í•œ ëŒ€ê¸° ì‹œê°„ | REQ-QUEUE-003 |
| ì¢Œì„ ì„ ì (HOLD) | 5ë¶„ | ì„ ì  í›„ ê²°ì œê¹Œì§€ ì—¬ìœ  ì‹œê°„ | REQ-RSV-007 |
| Access Token ë¸”ë™ë¦¬ìŠ¤íŠ¸ | 1ì‹œê°„ | Access Token ë§Œë£Œ ì‹œê°„ê³¼ ë™ì¼ | REQ-AUTH-010 |
| ê³µì—° ëª©ë¡/ìƒì„¸ ìºì‹œ | 5ë¶„ | ì ì ˆí•œ ì‹ ì„ ë„, ì˜¤í”ˆ ì‹œ 1ë¶„ìœ¼ë¡œ ë‹¨ì¶• | REQ-EVT-031 |
| ì¢Œì„ ì •ë³´ ìºì‹œ | 5ë¶„ | ì‹¤ì‹œê°„ì„± ìš”êµ¬, ë³€ê²½ ë¹ˆë„ ê³ ë ¤ | REQ-EVT-017 |

#### 6.3.8 Persistence ì „ëµ

**AOF (Append-Only File):**
- **fsync everysec**: 1ì´ˆë§ˆë‹¤ ë””ìŠ¤í¬ ë™ê¸°í™”
- ì„±ëŠ¥ê³¼ ì•ˆì •ì„±ì˜ ê· í˜•
- ìµœì•…ì˜ ê²½ìš° 1ì´ˆ ë°ì´í„° ì†ì‹¤

**RDB (Snapshot):**
- 1ì‹œê°„ë§ˆë‹¤ ìŠ¤ëƒ…ìƒ· ìƒì„± (ë©”ëª¨ë¦¬ ì ˆì•½)
- ì¬ì‹œì‘ ì‹œ ë¹ ë¥¸ ë³µêµ¬

**ì„¤ì • ì˜ˆì‹œ (redis.conf):**
```
appendonly yes
appendfsync everysec
save 3600 1    # 1ì‹œê°„ë§ˆë‹¤ 1ê°œ ì´ìƒ í‚¤ ë³€ê²½ ì‹œ ì €ì¥
```

**ì£¼ì˜:** ElastiCacheëŠ” ë°±ì—… ë¹„í™œì„±í™” (ë¹„ìš© ì ˆê°), ë°ì´í„° ì†ì‹¤ ì‹œ ì„œë¹„ìŠ¤ ë¡œì§ìœ¼ë¡œ ë³µêµ¬

#### 6.3.9 Cache Stampede ë°©ì§€

**ë¬¸ì œ:** ìºì‹œ ë§Œë£Œ ì‹œ ë™ì‹œ ë‹¤ë°œì  DB ì¡°íšŒë¡œ DB ê³¼ë¶€í•˜

**í•´ê²°ì±…: Lua ìŠ¤í¬ë¦½íŠ¸ ë½ ê¸°ë°˜ ê°±ì‹ **

```lua
-- cache_get_or_set.lua
local key = KEYS[1]
local lock_key = key .. ":lock"
local ttl = tonumber(ARGV[1])

local value = redis.call('GET', key)
if value then
    return value
end

local lock = redis.call('SET', lock_key, '1', 'NX', 'EX', 10)
if lock then
    return nil  -- í˜¸ì¶œìê°€ DB ì¡°íšŒ í›„ ìºì‹œ ì„¤ì •
else
    -- ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì´ë¯¸ ê°±ì‹  ì¤‘, ì ì‹œ ëŒ€ê¸° í›„ ì¬ì‹œë„
    redis.call('SLEEP', 0.1)
    return redis.call('GET', key)
end
```

**ëŒ€ì•ˆ: Probabilistic Early Expiration**
- TTLì˜ 90% ì‹œì ì— í™•ë¥ ì ìœ¼ë¡œ ì¬ê°±ì‹  (Beta: 1)
- ë™ì‹œ ë§Œë£Œ íšŒí”¼

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-EVT-027

### 6.4 ë°ì´í„° ì¼ê´€ì„± ì „ëµ

#### 6.4.1 Eventually Consistent ëª¨ë¸

MSA í™˜ê²½ì—ì„œ ì„œë¹„ìŠ¤ ê°„ ë°ì´í„°ëŠ” **Eventually Consistent** (ìµœì¢… ì¼ê´€ì„±) ëª¨ë¸ì„ ë”°ë¦…ë‹ˆë‹¤.

**ì˜ˆì‹œ: ì˜ˆë§¤ â†’ ê²°ì œ â†’ í™•ì • í”Œë¡œìš°**

```
1. Reservation Service: ì˜ˆë§¤ ìƒì„± (PENDING)
2. Payment Service: ê²°ì œ ì„±ê³µ â†’ Kafka ì´ë²¤íŠ¸ ë°œí–‰ (payment.success)
3. Reservation Service (Consumer): ì˜ˆë§¤ í™•ì • (CONFIRMED) - ìˆ˜ ë°€ë¦¬ì´ˆ ~ ìˆ˜ ì´ˆ ì§€ì—°
4. Event Service (Consumer): ì¢Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ (SOLD) - ìˆ˜ ë°€ë¦¬ì´ˆ ~ ìˆ˜ ì´ˆ ì§€ì—°
```

**ì§€ì—° ì‹œê°„:** ì¼ë°˜ì ìœ¼ë¡œ ìˆ˜ì‹­ ms ~ ìˆ˜ë°± ms, Kafka ì¥ì•  ì‹œ ìˆ˜ ì´ˆ

**ì‚¬ìš©ì ê²½í—˜:**
- ê²°ì œ ì™„ë£Œ í›„ "ì˜ˆë§¤ ì²˜ë¦¬ ì¤‘..." ë©”ì‹œì§€ í‘œì‹œ
- ìµœì¢… í™•ì • í›„ "ì˜ˆë§¤ ì™„ë£Œ!" í‘œì‹œ
- ì¥ì‹œê°„ ë¯¸ì²˜ë¦¬ ì‹œ ì•Œë¦¼ ë˜ëŠ” ì¬ì‹œë„

#### 6.4.2 ë¶„ì‚° ë½ (Redisson)

**ëª©ì :** ì¢Œì„ ì„ ì  ì‹œ ë™ì‹œì„± ì œì–´

**Redisson RLock:**
- Redis ê¸°ë°˜ ë¶„ì‚° ë½
- Pub/Subë¡œ ë½ í•´ì œ ì•Œë¦¼ (ëŒ€ê¸° ì¤‘ì¸ ìŠ¤ë ˆë“œ ì¦‰ì‹œ ê¹¨ì›€)
- Watch Dogë¡œ ìë™ ê°±ì‹  (ë°ë“œë½ ë°©ì§€)

**Spring Boot ì„¤ì •:**
```java
@Configuration
public class RedissonConfig {
    @Bean
    public RedissonClient redissonClient() {
        Config config = new Config();
        config.useSingleServer()
            .setAddress("redis://localhost:6379")
            .setConnectionPoolSize(50)
            .setConnectionMinimumIdleSize(10);
        return Redisson.create(config);
    }
}
```

**ì‚¬ìš© ì˜ˆì‹œ:**
```java
@Service
public class ReservationService {
    @Autowired
    private RedissonClient redissonClient;

    public void holdSeats(UUID eventId, List<UUID> seatIds, UUID userId) {
        List<RLock> locks = new ArrayList<>();
        try {
            // ë‹¤ì¤‘ ì¢Œì„ ë½ íšë“
            for (UUID seatId : seatIds) {
                RLock lock = redissonClient.getLock("seat:hold:" + eventId + ":" + seatId);
                boolean acquired = lock.tryLock(3, 300, TimeUnit.SECONDS);
                if (!acquired) {
                    throw new SeatAlreadyHoldException(seatId);
                }
                locks.add(lock);
            }

            // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§: ì˜ˆë§¤ ì •ë³´ DB ì €ì¥ (PENDING)
            reservationRepository.save(reservation);

        } finally {
            // ëª¨ë“  ë½ í•´ì œ
            locks.forEach(RLock::unlock);
        }
    }
}
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-RSV-001, REQ-RSV-002

#### 6.4.3 ë°ì´í„° ë™ê¸°í™” ë©”ì»¤ë‹ˆì¦˜

**1. Kafka ì´ë²¤íŠ¸ ê¸°ë°˜ ë™ê¸°í™”**

```
[Payment Service]
ê²°ì œ ì„±ê³µ â†’ Outbox INSERT (ë™ì¼ íŠ¸ëœì­ì…˜)
â†“
[Outbox Poller]
ì£¼ê¸°ì  í´ë§ (1ì´ˆ) â†’ Kafka ë°œí–‰
â†“
[Kafka Topic: payment.events]
â†“
[Reservation Service Consumer]
ì˜ˆë§¤ í™•ì • (PENDING â†’ CONFIRMED)
â†“
[Event Service Consumer]
ì¢Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ (AVAILABLE â†’ SOLD)
```

**2. Outbox Poller êµ¬í˜„ ì˜ˆì‹œ**

```java
@Component
public class OutboxPoller {
    @Scheduled(fixedDelay = 1000)  // 1ì´ˆë§ˆë‹¤
    @Transactional
    public void pollAndPublish() {
        List<OutboxEvent> events = outboxRepository.findTop100ByPublishedFalseOrderByCreatedAtAsc();

        for (OutboxEvent event : events) {
            try {
                // Kafka ë°œí–‰
                kafkaTemplate.send(getTopic(event), event.getPayload());

                // ë°œí–‰ ì„±ê³µ í‘œì‹œ
                event.setPublished(true);
                event.setPublishedAt(Instant.now());
                outboxRepository.save(event);
            } catch (Exception e) {
                // ì¬ì‹œë„ ì¹´ìš´íŠ¸ ì¦ê°€
                event.setRetryCount(event.getRetryCount() + 1);
                outboxRepository.save(event);

                if (event.getRetryCount() > 3) {
                    // Dead Letter Queueë¡œ ì´ë™
                    dlqRepository.save(event);
                    outboxRepository.delete(event);
                }
            }
        }
    }
}
```

**3. ë©±ë“±ì„± ë³´ì¥**

Kafka ConsumerëŠ” ë™ì¼ ì´ë²¤íŠ¸ë¥¼ ì¤‘ë³µ ìˆ˜ì‹ í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë©±ë“±ì„± ë³´ì¥ í•„ìˆ˜:

```java
@KafkaListener(topics = "payment.events")
public void handlePaymentSuccess(PaymentSuccessEvent event) {
    // ë©±ë“±ì„± ì²´í¬: payment_keyë¡œ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
    if (paymentRepository.existsByPaymentKey(event.getPaymentKey())) {
        log.info("ì´ë¯¸ ì²˜ë¦¬ëœ ê²°ì œ ì´ë²¤íŠ¸: {}", event.getPaymentKey());
        return;
    }

    // ì˜ˆë§¤ í™•ì • ë¡œì§
    Reservation reservation = reservationRepository.findById(event.getReservationId())
        .orElseThrow();
    reservation.confirm();
    reservationRepository.save(reservation);
}
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-RSV-012, REQ-PAY-004, REQ-PAY-013

---

## 7. ë©”ì‹œì§• ì•„í‚¤í…ì²˜ (Kafka)

### 7.1 Kafka í´ëŸ¬ìŠ¤í„° êµ¬ì„±

#### 7.1.1 ë¡œì»¬ ê°œë°œ í™˜ê²½

**Docker Compose êµ¬ì„±:**
```yaml
services:
  zookeeper:
    image: confluentinc/cp-zookeeper:7.5.0
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
    ports:
      - "2181:2181"

  kafka:
    image: confluentinc/cp-kafka:7.5.0
    depends_on:
      - zookeeper
    ports:
      - "9092:9092"
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
      KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: 1
      KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: 1
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: 'false'
```

**íŠ¹ì§•:**
- ë‹¨ì¼ ë¸Œë¡œì»¤ êµ¬ì„±
- Replication Factor: 1
- ê°œë°œ í¸ì˜ë¥¼ ìœ„í•œ ìë™ í† í”½ ìƒì„± ë¹„í™œì„±í™” (ëª…ì‹œì  ìƒì„± ê¶Œì¥)

#### 7.1.2 AWS ìš´ì˜ í™˜ê²½

**ì˜µì…˜ ë¶„ì„:**

| ì˜µì…˜ | ì¥ì  | ë‹¨ì  | ì›” ë¹„ìš© |
|------|------|------|---------|
| Amazon MSK | ì™„ì „ ê´€ë¦¬í˜•, ê³ ê°€ìš©ì„±, ìë™ íŒ¨ì¹˜ | ê³ ë¹„ìš© (ìµœì†Œ $200+) | $200+ |
| EC2 ìì²´ Kafka | ë¹„ìš© íš¨ìœ¨ì , ì™„ì „ ì œì–´ | ìš´ì˜ ë¶€ë‹´, ëª¨ë‹ˆí„°ë§ ì§ì ‘ êµ¬ì¶• | $15-50 |
| Amazon SNS/SQS | ì™„ì „ ê´€ë¦¬í˜•, ë¬´ë£Œí‹°ì–´ | ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ ë¶€ì¡± | $0-10 |

**ì„ íƒ: EC2 ìì²´ Kafka í´ëŸ¬ìŠ¤í„°**

**ì´ˆê¸° êµ¬ì„± (ë¹„ìš© ìµœì†Œí™”):**
- ì¸ìŠ¤í„´ìŠ¤: `t3.small` 1ëŒ€ (ë‹¨ì¼ ë¸Œë¡œì»¤)
- EBS: gp3 100GB
- ê°€ìš© ì˜ì—­: ap-northeast-2a (Single-AZ)
- Replication Factor: 1 (ë‹¨ì¼ ë¸Œë¡œì»¤ì´ë¯€ë¡œ)
- **ì›” ë¹„ìš©**: $15-20

**ì„±ì¥ ë‹¨ê³„ êµ¬ì„± (ê³ ê°€ìš©ì„±):**
- ì¸ìŠ¤í„´ìŠ¤: `t3.small` 3ëŒ€ (3 ë¸Œë¡œì»¤ í´ëŸ¬ìŠ¤í„°)
- EBS: gp3 100GB per broker
- ê°€ìš© ì˜ì—­: ap-northeast-2a, 2b, 2c (Multi-AZ)
- Replication Factor: 2-3
- **ì›” ë¹„ìš©**: $45-60

**Kafka ì„¤ì¹˜ ë° ì„¤ì •:**
```bash
# EC2 ì¸ìŠ¤í„´ìŠ¤ì— Kafka ì„¤ì¹˜
wget https://archive.apache.org/dist/kafka/3.6.0/kafka_2.13-3.6.0.tgz
tar -xzf kafka_2.13-3.6.0.tgz
cd kafka_2.13-3.6.0

# server.properties ì„¤ì •
broker.id=1
listeners=PLAINTEXT://0.0.0.0:9092
advertised.listeners=PLAINTEXT://ec2-xx-xx-xx-xx.compute.amazonaws.com:9092
log.dirs=/data/kafka-logs
zookeeper.connect=localhost:2181
num.partitions=3
default.replication.factor=1  # ì´ˆê¸° ë‹¨ì¼ ë¸Œë¡œì»¤
log.retention.hours=72  # 3ì¼ ë³´ê´€
```

#### 7.1.3 Partition ì „ëµ

**ê¸°ë³¸ ì„¤ì •:**
- í† í”½ë‹¹ íŒŒí‹°ì…˜ ìˆ˜: 3ê°œ
- íŒŒí‹°ì…˜ í‚¤: `aggregateId` (ì˜ˆ: userId, reservationId, paymentId)

**íŒŒí‹°ì…˜ ìˆ˜ ê²°ì • ê¸°ì¤€:**
- ì´ˆê¸° ì²˜ë¦¬ëŸ‰: ìµœëŒ€ 100 TPS (Transaction Per Second)
- íŒŒí‹°ì…˜ë‹¹ ì²˜ë¦¬ëŸ‰: ì•½ 30-50 TPS
- ê³„ì‚°: 100 TPS Ã· 30 TPS = 3-4 íŒŒí‹°ì…˜

**íŒŒí‹°ì…˜ í‚¤ ì „ëµ:**
```java
// ê°™ì€ userIdì˜ ì´ë²¤íŠ¸ëŠ” ê°™ì€ íŒŒí‹°ì…˜ìœ¼ë¡œ (ìˆœì„œ ë³´ì¥)
ProducerRecord<String, String> record = new ProducerRecord<>(
    "reservation.events",
    reservation.getUserId().toString(),  // Partition Key
    eventJson
);
```

**í™•ì¥ ê³„íš:**
- íŠ¸ë˜í”½ ì¦ê°€ ì‹œ íŒŒí‹°ì…˜ ì¶”ê°€ (ìµœëŒ€ 10-20ê°œ)
- Consumer Group ë³‘ë ¬ ì²˜ë¦¬ë¡œ ì²˜ë¦¬ëŸ‰ í–¥ìƒ

### 7.2 Topic ì„¤ê³„

#### 7.2.1 Topic ëª©ë¡

| Topic ëª… | Producer | Consumer | íŒŒí‹°ì…˜ ìˆ˜ | Replication | ë³´ê´€ ê¸°ê°„ |
|----------|----------|----------|----------|-------------|----------|
| `reservation.events` | Reservation | Event | 3 | 1 (ì´ˆê¸°) | 3ì¼ |
| `payment.events` | Payment | Reservation, Event | 3 | 1 (ì´ˆê¸°) | 3ì¼ |
| `seat.events` | Event | - (ì„ íƒ) | 3 | 1 (ì´ˆê¸°) | 3ì¼ |
| `compensation.events` | Payment | Reservation | 3 | 1 (ì´ˆê¸°) | 3ì¼ |
| `dlq.reservation` | - | Admin (ìˆ˜ë™) | 1 | 1 | 7ì¼ |
| `dlq.payment` | - | Admin (ìˆ˜ë™) | 1 | 1 | 7ì¼ |

#### 7.2.2 Topic ìƒì„¸ ì„¤ëª…

**1. `reservation.events` - ì˜ˆë§¤ ì´ë²¤íŠ¸**

**Producer:** Reservation Service
**Consumer:** Event Service
**ìš©ë„:** ì˜ˆë§¤ ì·¨ì†Œ ì‹œ ì¢Œì„ ìƒíƒœ ë³µêµ¬

**ì´ë²¤íŠ¸ íƒ€ì…:**
- `ReservationCancelled`: ì˜ˆë§¤ ì·¨ì†Œ (ì‚¬ìš©ì ë˜ëŠ” ë³´ìƒ íŠ¸ëœì­ì…˜)

**ì˜ˆì œ ë©”ì‹œì§€:**
```json
{
  "eventId": "uuid",
  "eventType": "ReservationCancelled",
  "aggregateId": "reservation-uuid",
  "userId": "user-uuid",
  "eventIdRef": "event-uuid",
  "seatIds": ["seat-uuid-1", "seat-uuid-2"],
  "cancelledAt": "2026-01-11T10:00:00Z",
  "reason": "USER_REQUEST"
}
```

**2. `payment.events` - ê²°ì œ ì´ë²¤íŠ¸**

**Producer:** Payment Service
**Consumer:** Reservation Service, Event Service
**ìš©ë„:** ê²°ì œ ì„±ê³µ/ì‹¤íŒ¨ ì‹œ ì˜ˆë§¤ í™•ì •/ì·¨ì†Œ, ì¢Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸

**ì´ë²¤íŠ¸ íƒ€ì…:**
- `PaymentSuccess`: ê²°ì œ ì„±ê³µ
- `PaymentFailed`: ê²°ì œ ì‹¤íŒ¨

**ì˜ˆì œ ë©”ì‹œì§€ (PaymentSuccess):**
```json
{
  "eventId": "uuid",
  "eventType": "PaymentSuccess",
  "aggregateId": "payment-uuid",
  "paymentKey": "payment-key-123",
  "reservationId": "reservation-uuid",
  "userId": "user-uuid",
  "amount": 200000,
  "paidAt": "2026-01-11T10:00:00Z",
  "portoneTransactionId": "imp_123456"
}
```

**ì˜ˆì œ ë©”ì‹œì§€ (PaymentFailed):**
```json
{
  "eventId": "uuid",
  "eventType": "PaymentFailed",
  "aggregateId": "payment-uuid",
  "paymentKey": "payment-key-123",
  "reservationId": "reservation-uuid",
  "userId": "user-uuid",
  "amount": 200000,
  "failureReason": "INSUFFICIENT_BALANCE",
  "failedAt": "2026-01-11T10:00:00Z"
}
```

**3. `seat.events` - ì¢Œì„ ì´ë²¤íŠ¸ (ì„ íƒ)**

**Producer:** Event Service
**Consumer:** ì—†ìŒ (ëª¨ë‹ˆí„°ë§/ê°ì‚¬ìš©)
**ìš©ë„:** ì¢Œì„ ìƒíƒœ ë³€ê²½ ì´ë ¥ ì¶”ì  (ì„ íƒ ì‚¬í•­)

**4. `compensation.events` - ë³´ìƒ íŠ¸ëœì­ì…˜ ì´ë²¤íŠ¸ (ì„ íƒ)**

**Producer:** Payment Service
**Consumer:** Reservation Service
**ìš©ë„:** SAGA íŒ¨í„´ì˜ ë³´ìƒ íŠ¸ëœì­ì…˜ ëª…ì‹œì  ê´€ë¦¬

**ì´ë²¤íŠ¸ íƒ€ì…:**
- `CompensateReservation`: ì˜ˆë§¤ ì·¨ì†Œ ë³´ìƒ

#### 7.2.3 Topic ìƒì„± ìŠ¤í¬ë¦½íŠ¸

```bash
# reservation.events
kafka-topics.sh --create \
  --bootstrap-server localhost:9092 \
  --topic reservation.events \
  --partitions 3 \
  --replication-factor 1 \
  --config retention.ms=259200000  # 3ì¼ (72ì‹œê°„)

# payment.events
kafka-topics.sh --create \
  --bootstrap-server localhost:9092 \
  --topic payment.events \
  --partitions 3 \
  --replication-factor 1 \
  --config retention.ms=259200000

# DLQ
kafka-topics.sh --create \
  --bootstrap-server localhost:9092 \
  --topic dlq.reservation \
  --partitions 1 \
  --replication-factor 1 \
  --config retention.ms=604800000  # 7ì¼
```

### 7.3 Producer/Consumer ë§¤í•‘

#### 7.3.1 ì„œë¹„ìŠ¤ë³„ Producer

| ì„œë¹„ìŠ¤ | ë°œí–‰ Topic | ë°œí–‰ ì‹œì  | ë¹„ê³  |
|--------|-----------|----------|------|
| Reservation | `reservation.events` | ì˜ˆë§¤ ì·¨ì†Œ ì‹œ | Outbox íŒ¨í„´ |
| Payment | `payment.events` | ê²°ì œ ì„±ê³µ/ì‹¤íŒ¨ ì‹œ | Outbox íŒ¨í„´ |

#### 7.3.2 ì„œë¹„ìŠ¤ë³„ Consumer

| ì„œë¹„ìŠ¤ | êµ¬ë… Topic | ì²˜ë¦¬ ë‚´ìš© | Consumer Group |
|--------|-----------|----------|----------------|
| Reservation | `payment.events` | ê²°ì œ ì„±ê³µ â†’ ì˜ˆë§¤ í™•ì •, ê²°ì œ ì‹¤íŒ¨ â†’ ì˜ˆë§¤ ì·¨ì†Œ | `reservation-payment-consumer` |
| Event | `payment.events` | ê²°ì œ ì„±ê³µ â†’ ì¢Œì„ ìƒíƒœ SOLD | `event-payment-consumer` |
| Event | `reservation.events` | ì˜ˆë§¤ ì·¨ì†Œ â†’ ì¢Œì„ ìƒíƒœ AVAILABLE | `event-reservation-consumer` |

#### 7.3.3 ì´ë²¤íŠ¸ í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨

**ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤:**
```mermaid
sequenceDiagram
    participant User
    participant Reservation
    participant Payment
    participant Kafka
    participant Event

    User->>Reservation: ì¢Œì„ ì„ ì  (HOLD)
    Reservation-->>User: ì„ ì  ì™„ë£Œ (PENDING)

    User->>Payment: ê²°ì œ ìš”ì²­
    Payment->>PortOne: ê²°ì œ ìŠ¹ì¸
    PortOne-->>Payment: ì„±ê³µ

    Payment->>Kafka: PaymentSuccess ë°œí–‰

    Kafka->>Reservation: PaymentSuccess ìˆ˜ì‹ 
    Reservation->>Reservation: ì˜ˆë§¤ í™•ì • (CONFIRMED)

    Kafka->>Event: PaymentSuccess ìˆ˜ì‹ 
    Event->>Event: ì¢Œì„ ìƒíƒœ SOLD
```

**ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ (ë³´ìƒ íŠ¸ëœì­ì…˜):**
```mermaid
sequenceDiagram
    participant User
    participant Reservation
    participant Payment
    participant Kafka
    participant Event

    User->>Reservation: ì¢Œì„ ì„ ì  (HOLD)
    Reservation-->>User: ì„ ì  ì™„ë£Œ (PENDING)

    User->>Payment: ê²°ì œ ìš”ì²­
    Payment->>PortOne: ê²°ì œ ìŠ¹ì¸
    PortOne-->>Payment: ì‹¤íŒ¨

    Payment->>Kafka: PaymentFailed ë°œí–‰

    Kafka->>Reservation: PaymentFailed ìˆ˜ì‹ 
    Reservation->>Reservation: ì˜ˆë§¤ ì·¨ì†Œ (CANCELLED)
    Reservation->>Kafka: ReservationCancelled ë°œí–‰

    Kafka->>Event: ReservationCancelled ìˆ˜ì‹ 
    Event->>Event: ì¢Œì„ ì„ ì  í•´ì œ (AVAILABLE)
```

### 7.4 Event Schema ì •ì˜

#### 7.4.1 ê³µí†µ ì´ë²¤íŠ¸ êµ¬ì¡°

ëª¨ë“  ì´ë²¤íŠ¸ëŠ” ë‹¤ìŒ ê³µí†µ í•„ë“œë¥¼ í¬í•¨í•©ë‹ˆë‹¤:

```json
{
  "eventId": "uuid",             // ì´ë²¤íŠ¸ ê³ ìœ  ID (ë©±ë“±ì„± í‚¤)
  "eventType": "string",         // ì´ë²¤íŠ¸ íƒ€ì…
  "aggregateId": "uuid",         // Aggregate ID (Reservation/Payment)
  "aggregateType": "string",     // Aggregate íƒ€ì… ("Reservation", "Payment")
  "version": "string",           // ì´ë²¤íŠ¸ ìŠ¤í‚¤ë§ˆ ë²„ì „ (v1, v2)
  "timestamp": "ISO8601",        // ì´ë²¤íŠ¸ ë°œìƒ ì‹œê°
  "metadata": {
    "correlationId": "uuid",     // ìš”ì²­ ì¶”ì  ID
    "causationId": "uuid",       // ì›ì¸ ì´ë²¤íŠ¸ ID
    "userId": "uuid"             // ì‚¬ìš©ì ID
  },
  "payload": {}                  // ì´ë²¤íŠ¸ë³„ ë°ì´í„°
}
```

#### 7.4.2 ì´ë²¤íŠ¸ ë²„ì „ ê´€ë¦¬

**ì „ëµ:** Semantic Versioning (v1, v2, v3)

**í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€:**
- í•„ë“œ ì¶”ê°€: í˜¸í™˜ ê°€ëŠ¥ (ConsumerëŠ” ë¬´ì‹œ)
- í•„ë“œ ì‚­ì œ: í˜¸í™˜ ë¶ˆê°€ (ìƒˆ ë²„ì „ ë°œí–‰, v1 â†’ v2)
- í•„ë“œ íƒ€ì… ë³€ê²½: í˜¸í™˜ ë¶ˆê°€ (ìƒˆ ë²„ì „ ë°œí–‰)

**Consumer ë²„ì „ ì²˜ë¦¬:**
```java
@KafkaListener(topics = "payment.events")
public void handlePaymentEvent(String message) {
    JsonNode event = objectMapper.readTree(message);
    String version = event.get("version").asText();

    switch (version) {
        case "v1":
            handlePaymentEventV1(event);
            break;
        case "v2":
            handlePaymentEventV2(event);
            break;
        default:
            throw new UnsupportedVersionException(version);
    }
}
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-PAY-013, REQ-RSV-011

### 7.5 Dead Letter Queue (DLQ) ì²˜ë¦¬

#### 7.5.1 DLQ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

**Consumer ì²˜ë¦¬ ì‹¤íŒ¨ ì‹œ DLQë¡œ ì´ë™:**
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜ˆì™¸ (ë°ì´í„° ë¬´ê²°ì„± ì˜¤ë¥˜ ë“±)
- ì¼ì‹œì  ì˜¤ë¥˜ ì•„ë‹˜ (ì¬ì‹œë„í•´ë„ ì‹¤íŒ¨)
- 3íšŒ ì¬ì‹œë„ í›„ì—ë„ ì‹¤íŒ¨

**ì¼ì‹œì  ì˜¤ë¥˜ëŠ” ì¬ì‹œë„:**
- DB ì»¤ë„¥ì…˜ íƒ€ì„ì•„ì›ƒ
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
- ì¬ì‹œë„ ê°€ëŠ¥í•œ ì˜ˆì™¸

#### 7.5.2 DLQ êµ¬í˜„

**Spring Kafka ErrorHandler:**
```java
@Configuration
public class KafkaConsumerConfig {

    @Bean
    public DefaultErrorHandler errorHandler(KafkaTemplate<String, String> kafkaTemplate) {
        // ì¬ì‹œë„ ì •ì±…: ì§€ìˆ˜ ë°±ì˜¤í”„
        BackOff backOff = new ExponentialBackOffWithMaxRetries(3);
        backOff.setInitialInterval(1000);  // 1ì´ˆ
        backOff.setMultiplier(2.0);        // 2ë°°ì”© ì¦ê°€
        backOff.setMaxInterval(10000);     // ìµœëŒ€ 10ì´ˆ

        DefaultErrorHandler errorHandler = new DefaultErrorHandler(
            (record, exception) -> {
                // 3íšŒ ì¬ì‹œë„ í›„ DLQë¡œ ì´ë™
                String dlqTopic = "dlq." + record.topic().split("\\.")[0];
                kafkaTemplate.send(dlqTopic, record.key(), record.value());
                log.error("ë©”ì‹œì§€ë¥¼ DLQë¡œ ì´ë™: {}", dlqTopic, exception);
            },
            backOff
        );

        // ì¬ì‹œë„ ê°€ëŠ¥í•œ ì˜ˆì™¸
        errorHandler.addRetryableExceptions(
            DataAccessException.class,
            TimeoutException.class
        );

        // ì¬ì‹œë„ ë¶ˆê°€ëŠ¥í•œ ì˜ˆì™¸ (ì¦‰ì‹œ DLQ)
        errorHandler.addNotRetryableExceptions(
            ValidationException.class,
            IllegalArgumentException.class
        );

        return errorHandler;
    }
}
```

#### 7.5.3 DLQ ëª¨ë‹ˆí„°ë§ ë° ì¬ì²˜ë¦¬

**DLQ ëª¨ë‹ˆí„°ë§:**
- CloudWatch Metric: DLQ ë©”ì‹œì§€ ìˆ˜
- ì•ŒëŒ: DLQ ë©”ì‹œì§€ 10ê°œ ì´ìƒ ì‹œ ì•Œë¦¼

**ì¬ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤:**
1. DLQ ë©”ì‹œì§€ ì¡°íšŒ (Kafka Consumer ë˜ëŠ” CLI)
2. ì›ì¸ ë¶„ì„ (ë¡œê·¸, ì˜ˆì™¸ ë©”ì‹œì§€)
3. ë°ì´í„° ìˆ˜ì • ë˜ëŠ” ì½”ë“œ ìˆ˜ì •
4. ìˆ˜ë™ ì¬ë°œí–‰ (ì›ë³¸ í† í”½ìœ¼ë¡œ)

**ì¬ë°œí–‰ ìŠ¤í¬ë¦½íŠ¸ ì˜ˆì‹œ:**
```bash
# DLQ ë©”ì‹œì§€ ì½ê¸°
kafka-console-consumer.sh \
  --bootstrap-server localhost:9092 \
  --topic dlq.payment \
  --from-beginning \
  --max-messages 10 > dlq_messages.txt

# ìˆ˜ì • í›„ ì›ë³¸ í† í”½ìœ¼ë¡œ ì¬ë°œí–‰
kafka-console-producer.sh \
  --bootstrap-server localhost:9092 \
  --topic payment.events < fixed_messages.txt
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-EVT-024

### 7.6 ë©±ë“±ì„± ë³´ì¥ ë©”ì»¤ë‹ˆì¦˜

#### 7.6.1 Producer ë©±ë“±ì„±

**Kafka Producer ì„¤ì •:**
```java
@Configuration
public class KafkaProducerConfig {
    @Bean
    public ProducerFactory<String, String> producerFactory() {
        Map<String, Object> config = new HashMap<>();
        config.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, "localhost:9092");
        config.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
        config.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);

        // ë©±ë“±ì„± í™œì„±í™”
        config.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true);
        config.put(ProducerConfig.ACKS_CONFIG, "all");
        config.put(ProducerConfig.RETRIES_CONFIG, Integer.MAX_VALUE);
        config.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, 5);

        return new DefaultKafkaProducerFactory<>(config);
    }
}
```

**íŠ¹ì§•:**
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ë¡œ ì¬ì „ì†¡í•´ë„ ì¤‘ë³µ ë©”ì‹œì§€ ë°©ì§€
- Brokerê°€ ìë™ìœ¼ë¡œ ì¤‘ë³µ ê°ì§€ (Producer ID + Sequence Number)

#### 7.6.2 Consumer ë©±ë“±ì„±

**ë¬¸ì œ:** KafkaëŠ” At-least-once ì „ë‹¬ ë³´ì¥ â†’ Consumerê°€ ë™ì¼ ë©”ì‹œì§€ ì¤‘ë³µ ìˆ˜ì‹  ê°€ëŠ¥

**í•´ê²°ì±…: ì´ë²¤íŠ¸ ID ê¸°ë°˜ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€**

**ë°©ë²• 1: DB Unique Constraint (ê¶Œì¥)**
```java
@Entity
@Table(name = "processed_events")
public class ProcessedEvent {
    @Id
    @Column(name = "event_id")
    private UUID eventId;  // Unique

    @Column(name = "event_type")
    private String eventType;

    @Column(name = "processed_at")
    private Instant processedAt;
}

@KafkaListener(topics = "payment.events")
@Transactional
public void handlePaymentSuccess(PaymentSuccessEvent event) {
    // ë©±ë“±ì„± ì²´í¬: event_idë¡œ ì¤‘ë³µ ë°©ì§€
    if (processedEventRepository.existsById(event.getEventId())) {
        log.info("ì´ë¯¸ ì²˜ë¦¬ëœ ì´ë²¤íŠ¸: {}", event.getEventId());
        return;
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    Reservation reservation = reservationRepository.findById(event.getReservationId())
        .orElseThrow();
    reservation.confirm();
    reservationRepository.save(reservation);

    // ì²˜ë¦¬ ì™„ë£Œ ê¸°ë¡ (ë™ì¼ íŠ¸ëœì­ì…˜)
    processedEventRepository.save(new ProcessedEvent(event.getEventId(), event.getEventType()));
}
```

**ë°©ë²• 2: Redis Set (ë¹ ë¥¸ ì¡°íšŒ)**
```java
@KafkaListener(topics = "payment.events")
public void handlePaymentSuccess(PaymentSuccessEvent event) {
    String key = "processed:event:" + event.getEventId();

    // Redis SETNX (Set if Not Exists)
    Boolean isNew = redisTemplate.opsForValue().setIfAbsent(key, "1", Duration.ofDays(7));

    if (Boolean.FALSE.equals(isNew)) {
        log.info("ì´ë¯¸ ì²˜ë¦¬ëœ ì´ë²¤íŠ¸: {}", event.getEventId());
        return;
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    // ...
}
```

**ë°©ë²• 3: paymentKey/reservationId ê¸°ë°˜ (ë„ë©”ì¸ í‚¤)**
```java
@KafkaListener(topics = "payment.events")
@Transactional
public void handlePaymentSuccess(PaymentSuccessEvent event) {
    // paymentKeyë¡œ ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€
    if (paymentRepository.existsByPaymentKey(event.getPaymentKey())) {
        log.info("ì´ë¯¸ ì²˜ë¦¬ëœ ê²°ì œ: {}", event.getPaymentKey());
        return;
    }

    // ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
    // ...
}
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-PAY-004, REQ-PAY-010

### 7.7 At-least-once vs Exactly-once ì „ë‹¬ ë³´ì¥

#### 7.7.1 Kafka ì „ë‹¬ ë³´ì¥ ìˆ˜ì¤€

| ì „ë‹¬ ë³´ì¥ | ì„¤ëª… | ì¥ì  | ë‹¨ì  | ì ìš© |
|----------|------|------|------|------|
| At-most-once | ë©”ì‹œì§€ ì†ì‹¤ ê°€ëŠ¥, ì¤‘ë³µ ì—†ìŒ | ë¹ ë¦„ | ë°ì´í„° ì†ì‹¤ | ë¹„ì ìš© |
| At-least-once | ì¤‘ë³µ ê°€ëŠ¥, ì†ì‹¤ ì—†ìŒ | ì‹ ë¢°ì„± | ë©±ë“±ì„± ì²˜ë¦¬ í•„ìš” | **ì ìš©** |
| Exactly-once | ì¤‘ë³µ ì—†ìŒ, ì†ì‹¤ ì—†ìŒ | ì™„ë²½í•œ ì‹ ë¢°ì„± | ë³µì¡ë„ ë†’ìŒ, ì„±ëŠ¥ ì €í•˜ | ì„ íƒ |

#### 7.7.2 í˜„ì¬ ì•„í‚¤í…ì²˜: At-least-once + Consumer ë©±ë“±ì„±

**ì„ íƒ ì´ìœ :**
- Exactly-onceëŠ” Kafka Streams ë˜ëŠ” íŠ¸ëœì­ì…˜ API í•„ìš” (ë³µì¡ë„ ì¦ê°€)
- At-least-once + Consumer ë©±ë“±ì„±ìœ¼ë¡œ ì¶©ë¶„í•œ ì‹ ë¢°ì„± í™•ë³´
- ì„±ëŠ¥ê³¼ ë³µì¡ë„ì˜ ê· í˜•

**Consumer ì„¤ì •:**
```yaml
spring:
  kafka:
    consumer:
      enable-auto-commit: false  # ìˆ˜ë™ ì»¤ë°‹
      isolation-level: read_committed
    listener:
      ack-mode: MANUAL_IMMEDIATE
```

**ìˆ˜ë™ ì»¤ë°‹ ì˜ˆì‹œ:**
```java
@KafkaListener(topics = "payment.events")
public void handlePaymentSuccess(ConsumerRecord<String, String> record, Acknowledgment ack) {
    try {
        PaymentSuccessEvent event = objectMapper.readValue(record.value(), PaymentSuccessEvent.class);

        // ë©±ë“±ì„± ì²´í¬ + ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
        handlePaymentSuccessIdempotent(event);

        // ì²˜ë¦¬ ì™„ë£Œ í›„ ì»¤ë°‹
        ack.acknowledge();
    } catch (Exception e) {
        log.error("ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹¤íŒ¨, ì¬ì‹œë„ ì˜ˆì •", e);
        // ì»¤ë°‹í•˜ì§€ ì•ŠìŒ â†’ ì¬ì‹œë„
    }
}
```

#### 7.7.3 Exactly-once ì „í™˜ ê³„íš (í–¥í›„)

**ì „í™˜ ì‹œì :**
- ë°ì´í„° ì •í•©ì„± ì´ìŠˆ ë¹ˆë²ˆ ë°œìƒ
- ë©±ë“±ì„± ì²˜ë¦¬ ë³µì¡ë„ ì¦ê°€
- íŠ¸ëœì­ì…˜ ë³´ì¥ í•„ìˆ˜ ìš”êµ¬ì‚¬í•­ ì¶”ê°€

**Kafka Transactional API ì‚¬ìš©:**
```java
// Producer
@Bean
public ProducerFactory<String, String> transactionalProducerFactory() {
    Map<String, Object> config = new HashMap<>();
    // ... ê¸°ë³¸ ì„¤ì •
    config.put(ProducerConfig.TRANSACTIONAL_ID_CONFIG, "payment-producer");
    return new DefaultKafkaProducerFactory<>(config);
}

// Consumer
@Transactional("kafkaTransactionManager")
@KafkaListener(topics = "payment.events")
public void handlePaymentSuccess(PaymentSuccessEvent event) {
    // DB íŠ¸ëœì­ì…˜ + Kafka ì»¤ë°‹ì´ ì›ìì ìœ¼ë¡œ ì²˜ë¦¬
}
```

**íŠ¸ë ˆì´ë“œì˜¤í”„:**
- ì¥ì : Exactly-once ë³´ì¥
- ë‹¨ì : ì„±ëŠ¥ 10-30% ì €í•˜, ì„¤ì • ë³µì¡ë„ ì¦ê°€

---

## 8. API ì„¤ê³„

### 8.1 API Gateway ë¼ìš°íŒ… ê·œì¹™

**Path ê¸°ë°˜ ë¼ìš°íŒ… ë§¤í•‘:**

| Path Pattern | ëŒ€ìƒ ì„œë¹„ìŠ¤ | Port | ë¹„ê³  |
|-------------|-----------|------|------|
| `/auth/**` | User Service | 8081 | íšŒì›ê°€ì…, ë¡œê·¸ì¸, ë¡œê·¸ì•„ì›ƒ, í† í° ê°±ì‹  |
| `/users/**` | User Service | 8081 | í”„ë¡œí•„ ê´€ë¦¬ |
| `/events/**` | Event Service | 8082 | ê³µì—° ì¡°íšŒ, ì¢Œì„ ì •ë³´ (ê³µê°œ + ì¸ì¦) |
| `/venues/**` | Event Service | 8082 | ê³µì—°ì¥/í™€ ê´€ë¦¬ (ê´€ë¦¬ì) |
| `/queue/**` | Queue Service | 8083 | ëŒ€ê¸°ì—´ ì§„ì…, ìƒíƒœ ì¡°íšŒ |
| `/reservations/**` | Reservation Service | 8084 | ì˜ˆë§¤ ê´€ë¦¬ |
| `/payments/**` | Payment Service | 8085 | ê²°ì œ ì²˜ë¦¬ |

**ê³µê°œ ì—”ë“œí¬ì¸íŠ¸ (ì¸ì¦ ë¶ˆí•„ìš”):**
- `POST /auth/register`
- `POST /auth/login`
- `GET /events`, `GET /events/{id}`
- `GET /venues`

**ì¸ì¦ í•„ìˆ˜ ì—”ë“œí¬ì¸íŠ¸:**
- `/auth/logout`, `/auth/refresh`
- `/users/**`
- `/queue/**`, `/reservations/**`, `/payments/**`

**ê´€ë¦¬ì ì „ìš© ì—”ë“œí¬ì¸íŠ¸:**
- `POST /events`, `PUT /events/{id}`, `DELETE /events/{id}`
- `POST /venues`, `PUT /venues/{id}`
- `GET /queue/admin/stats`

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-GW-001 (ë™ì  ë¼ìš°íŒ…), REQ-GW-003 (ê³µê°œ ì—”ë“œí¬ì¸íŠ¸), REQ-GW-020 (Admin ê¶Œí•œ)

### 8.2 ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡

#### 8.2.1 ì¸ì¦/íšŒì› API (User Service)

| Method | Endpoint | ì„¤ëª… | ì¸ì¦ | Rate Limit |
|--------|----------|------|------|-----------|
| POST | `/auth/register` | íšŒì›ê°€ì… | ë¶ˆí•„ìš” | 10/ë¶„ (IP) |
| POST | `/auth/login` | ë¡œê·¸ì¸ | ë¶ˆí•„ìš” | 10/ë¶„ (IP) |
| POST | `/auth/logout` | ë¡œê·¸ì•„ì›ƒ | í•„ìˆ˜ | 200/ë¶„ (ì‚¬ìš©ì) |
| POST | `/auth/refresh` | í† í° ê°±ì‹  | Refresh Token | 200/ë¶„ (ì‚¬ìš©ì) |
| GET | `/users/me` | í”„ë¡œí•„ ì¡°íšŒ | í•„ìˆ˜ | 200/ë¶„ (ì‚¬ìš©ì) |
| PUT | `/users/me` | í”„ë¡œí•„ ìˆ˜ì • | í•„ìˆ˜ | 100/ë¶„ (ì‚¬ìš©ì) |

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-AUTH-001 ~ REQ-AUTH-021

#### 8.2.2 ê³µì—° ê´€ë¦¬ API (Event Service)

| Method | Endpoint | ì„¤ëª… | ì¸ì¦ | Rate Limit |
|--------|----------|------|------|-----------|
| GET | `/events` | ê³µì—° ëª©ë¡ ì¡°íšŒ | ë¶ˆí•„ìš” | 300/ë¶„ (IP) |
| GET | `/events/{id}` | ê³µì—° ìƒì„¸ ì¡°íšŒ | ë¶ˆí•„ìš” | 300/ë¶„ (IP) |
| GET | `/events/{id}/seats` | ì¢Œì„ ì •ë³´ ì¡°íšŒ | í•„ìˆ˜ | 200/ë¶„ (ì‚¬ìš©ì) |
| POST | `/events` | ê³µì—° ìƒì„± | ê´€ë¦¬ì | - |
| PUT | `/events/{id}` | ê³µì—° ìˆ˜ì • | ê´€ë¦¬ì | - |
| POST | `/venues` | ê³µì—°ì¥ ìƒì„± | ê´€ë¦¬ì | - |
| GET | `/internal/seats/status/{eventId}` | SOLD ì¢Œì„ ID ì¡°íšŒ (ë‚´ë¶€ ì „ìš©) | ë¶ˆí•„ìš” (ë‚´ë¶€) | - |

**ì°¸ê³ :** `/internal/**` ê²½ë¡œëŠ” API Gatewayë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ì„œë¹„ìŠ¤ ê°„ ì§ì ‘ í˜¸ì¶œë©ë‹ˆë‹¤.

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-EVT-001 ~ REQ-EVT-006

#### 8.2.3 ëŒ€ê¸°ì—´ API (Queue Service)

| Method | Endpoint | ì„¤ëª… | ì¸ì¦ | Rate Limit |
|--------|----------|------|------|-----------|
| POST | `/queue/enter` | ëŒ€ê¸°ì—´ ì§„ì… | í•„ìˆ˜ | 100/ë¶„ (ì‚¬ìš©ì) |
| GET | `/queue/status` | ëŒ€ê¸°ì—´ ìƒíƒœ ì¡°íšŒ | í•„ìˆ˜ | 60/ë¶„ (ì‚¬ìš©ì) |
| DELETE | `/queue/leave` | ëŒ€ê¸°ì—´ ì´íƒˆ | í•„ìˆ˜ | 100/ë¶„ (ì‚¬ìš©ì) |

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-QUEUE-001, REQ-QUEUE-002, REQ-QUEUE-014

#### 8.2.4 ì˜ˆë§¤ API (Reservation Service)

| Method | Endpoint | ì„¤ëª… | ì¸ì¦ | Rate Limit |
|--------|----------|------|------|-----------|
| GET | `/reservations/seats/{eventId}` | ì¢Œì„ ìƒíƒœ ì¡°íšŒ | í•„ìˆ˜ | 200/ë¶„ (ì‚¬ìš©ì) |
| POST | `/reservations/hold` | ì¢Œì„ ì„ ì  | í•„ìˆ˜ + Queue Token | 20/ë¶„ (ì‚¬ìš©ì) |
| PUT | `/reservations/hold/{id}` | ì¢Œì„ ë³€ê²½ | í•„ìˆ˜ | 20/ë¶„ (ì‚¬ìš©ì) |
| GET | `/reservations` | ë‚˜ì˜ ì˜ˆë§¤ ë‚´ì—­ | í•„ìˆ˜ | 200/ë¶„ (ì‚¬ìš©ì) |
| DELETE | `/reservations/{id}` | ì˜ˆë§¤ ì·¨ì†Œ | í•„ìˆ˜ | 20/ë¶„ (ì‚¬ìš©ì) |

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-RSV-001 ~ REQ-RSV-009

#### 8.2.5 ê²°ì œ API (Payment Service)

| Method | Endpoint | ì„¤ëª… | ì¸ì¦ | Rate Limit |
|--------|----------|------|------|-----------|
| POST | `/payments` | ê²°ì œ ìš”ì²­ | í•„ìˆ˜ + Queue Token | 20/ë¶„ (ì‚¬ìš©ì) |
| POST | `/payments/confirm` | ê²°ì œ í™•ì¸ | í•„ìˆ˜ | 20/ë¶„ (ì‚¬ìš©ì) |
| GET | `/payments/{id}` | ê²°ì œ ì¡°íšŒ | í•„ìˆ˜ | 200/ë¶„ (ì‚¬ìš©ì) |
| GET | `/payments` | ê²°ì œ ë‚´ì—­ | í•„ìˆ˜ | 200/ë¶„ (ì‚¬ìš©ì) |

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-PAY-001 ~ REQ-PAY-015

### 8.3 API Rate Limiting ì •ì±…

**ì—”ë“œí¬ì¸íŠ¸ë³„ ì œí•œ:**

| ì—”ë“œí¬ì¸íŠ¸ | IP ê¸°ë°˜ | ì‚¬ìš©ì ê¸°ë°˜ | ë¹„ê³  |
|-----------|---------|-----------|------|
| ì½ê¸° (GET ê³µê°œ) | 300/ë¶„ | - | ê³µì—° ëª©ë¡/ìƒì„¸ ì¡°íšŒ |
| ë¡œê·¸ì¸ | 10/ë¶„ | - | ë¬´ì°¨ë³„ ëŒ€ì… ê³µê²© ë°©ì§€ |
| ëŒ€ê¸°ì—´ ìƒíƒœ ì¡°íšŒ | - | 60/ë¶„ | í´ë§ ì œí•œ |
| ì˜ˆë§¤/ê²°ì œ | 50/ë¶„ | 20/ë¶„ | ì–´ë·°ì§• ë°©ì§€ |
| ê¸°íƒ€ | 100/ë¶„ | 200/ë¶„ | ì¼ë°˜ API |

**êµ¬í˜„:** Resilience4j RateLimiter + Redis ê¸°ë°˜ ë¶„ì‚° Rate Limiter

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-GW-005, REQ-GW-006, REQ-QUEUE-014

---

## 9. ë³´ì•ˆ ì•„í‚¤í…ì²˜

### 9.1 JWT ì¸ì¦/ì¸ê°€ í”Œë¡œìš°

**Access Token:**
- ìœ íš¨ê¸°ê°„: 1ì‹œê°„
- í¬í•¨ ì •ë³´: userId, email, role (USER/ADMIN)
- ì„œëª… ì•Œê³ ë¦¬ì¦˜: HS256 (HMAC-SHA256)

**Refresh Token:**
- ìœ íš¨ê¸°ê°„: 7ì¼
- DB ì €ì¥ (auth_tokens í…Œì´ë¸”)
- Rotation (RTR) ì ìš© ê²€í† 

**í† í° ë¸”ë™ë¦¬ìŠ¤íŠ¸:**
- ë¡œê·¸ì•„ì›ƒ ì‹œ Access Tokenì„ Redisì— ë¸”ë™ë¦¬ìŠ¤íŠ¸ ë“±ë¡
- TTL: í† í° ë§Œë£Œ ì‹œê°„ (1ì‹œê°„)

**API Gateway ê²€ì¦ í”Œë¡œìš°:**
```
1. í´ë¼ì´ì–¸íŠ¸ â†’ Gateway: Authorization: Bearer {token}
2. Gateway: JWT ì„œëª… ê²€ì¦, ë§Œë£Œ í™•ì¸
3. Gateway: Redis ë¸”ë™ë¦¬ìŠ¤íŠ¸ í™•ì¸
4. Gateway: ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ (userId, role)
5. Gateway â†’ ë‹¤ìš´ìŠ¤íŠ¸ë¦¼: X-User-Id, X-User-Role í—¤ë” ì¶”ê°€
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-AUTH-006, REQ-AUTH-009, REQ-AUTH-010, REQ-AUTH-011, REQ-GW-002

### 9.2 ë³¸ì¸ì¸ì¦ ë° CAPTCHA

**PortOne ë³¸ì¸ì¸ì¦ (CI/DI):**
- íšŒì›ê°€ì… ì‹œ í•„ìˆ˜
- CI (Connecting Information): 1ì¸ 1ê³„ì • ê°•ì œ
- í…ŒìŠ¤íŠ¸ ëª¨ë“œ ì‚¬ìš©

**reCAPTCHA:**
- íšŒì›ê°€ì…, ë¡œê·¸ì¸ ì‹œ ê²€ì¦
- v2 Checkbox ë°©ì‹

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-AUTH-003, REQ-AUTH-004

### 9.3 ì•”í˜¸í™” ì „ëµ

**ë¹„ë°€ë²ˆí˜¸:** BCrypt (Cost Factor: 10-12)
**ê°œì¸ì •ë³´ (ì„ íƒ):** AES-256-GCM (email, phone, CI)
**í†µì‹ :** HTTPS/TLS 1.3

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-AUTH-014, REQ-AUTH-019

### 9.4 CORS ì •ì±…

**í—ˆìš© Origin:** `https://ticketing.vercel.app` (í”„ë¡ íŠ¸ì—”ë“œ)
**í—ˆìš© ë©”ì„œë“œ:** GET, POST, PUT, DELETE, OPTIONS
**í—ˆìš© í—¤ë”:** Authorization, Content-Type, X-Queue-Token
**ì¸ì¦ì •ë³´ í¬í•¨:** credentials: true

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-GW-004

---

## 10. ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œ ì„¤ê³„

### 10.1 Redis Sorted Set ê¸°ë°˜ ëŒ€ê¸°ì—´

**êµ¬ì¡°:**
- Key: `queue:{eventId}`
- Score: Unix Timestamp (ì§„ì… ì‹œê°)
- Member: userId

**ì§„ì… í”Œë¡œìš°:**
1. ì¤‘ë³µ ëŒ€ê¸° í™•ì¸: `EXISTS queue:active:{userId}`
2. ìš©ëŸ‰ í™•ì¸: `ZCARD queue:{eventId}` < 50,000
3. ëŒ€ê¸°ì—´ ì§„ì…: `ZADD queue:{eventId} NX {timestamp} {userId}`
4. Active í‘œì‹œ: `SET queue:active:{userId} {eventId} EX 600`
5. Queue Token ë°œê¸‰: `qr_xxx` (Reservation Token)

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-QUEUE-001, REQ-QUEUE-010, REQ-QUEUE-021

### 10.2 ë°°ì¹˜ ìŠ¹ì¸ ë¡œì§ (Lua ìŠ¤í¬ë¦½íŠ¸)

**ìŠ¤ì¼€ì¤„ëŸ¬:** 1ì´ˆë§ˆë‹¤ 10ëª… ìŠ¹ì¸ (36,000ëª…/ì‹œê°„)

```lua
local queue_key = KEYS[1]
local count = tonumber(ARGV[1]) or 10

-- ìƒìœ„ Nëª… ì¡°íšŒ
local members = redis.call('ZRANGE', queue_key, 0, count - 1)

if #members == 0 then
  return {}
end

-- ëŒ€ê¸°ì—´ì—ì„œ ì œê±°
redis.call('ZREM', queue_key, unpack(members))

-- Token ë°œê¸‰ (ë³„ë„ ë¡œì§)
return members
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-QUEUE-005

### 10.3 Queue Token ì´ì¤‘ ëª¨ë¸

**Reservation Token (qr_xxx):**
- ì¢Œì„ ì„ ì  ì‹œ ê²€ì¦
- TTL: 10ë¶„

**Payment Token (qp_xxx):**
- ê²°ì œ ì‹œ ê²€ì¦
- TTL: 10ë¶„
- Reservation Token ìŠ¹ì¸ í›„ ë°œê¸‰

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-QUEUE-004, REQ-GW-021

---

## 11. ì¢Œì„ ì˜ˆë§¤ ì‹œìŠ¤í…œ ì„¤ê³„

### 11.1 ì¢Œì„ ì„ ì  ë©”ì»¤ë‹ˆì¦˜ (Redisson ë¶„ì‚° ë½)

**í”„ë¡œì„¸ìŠ¤:**
1. Queue Token ê²€ì¦: `GET queue:token:qr_xxx`
2. ì¢Œì„ ë½ íšë“: `RLock.tryLock("seat:hold:{eventId}:{seatId}", 3ì´ˆ, 300ì´ˆ)`
3. ì˜ˆë§¤ ì •ë³´ ì €ì¥: `reservations` í…Œì´ë¸” (PENDING)
4. Payment Token ë°œê¸‰ ìš”ì²­

**TTL:** 5ë¶„ (300ì´ˆ)

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-RSV-001, REQ-RSV-007

### 11.2 ì¢Œì„ ìƒíƒœ ê´€ë¦¬

| ìƒíƒœ | ì €ì¥ ìœ„ì¹˜ | ì˜ë¯¸ |
|------|----------|------|
| HOLD | Redis (ë¶„ì‚° ë½) | ì„ ì  ì¤‘ (5ë¶„) |
| SOLD | RDB (seats.status) | ê²°ì œ ì™„ë£Œ |
| AVAILABLE | - | HOLDë„ SOLDë„ ì•„ë‹˜ |

**ì¡°íšŒ ë¡œì§:**

1. **Event Serviceì—ì„œ SOLD ì¢Œì„ ì¡°íšŒ (Feign í˜¸ì¶œ)**:
   ```java
   // Feign Client
   List<String> soldSeatIds = eventServiceClient.getSoldSeats(eventId);
   ```

2. **Redisì—ì„œ HOLD ì¢Œì„ ì¡°íšŒ**:
   ```java
   // Redis keys pattern: seat:hold:{eventId}:{seatId}
   Set<String> holdSeatIds = redisTemplate.keys("seat:hold:" + eventId + ":*")
       .stream()
       .map(key -> key.split(":")[3])  // Extract seatId
       .collect(Collectors.toSet());
   ```

3. **Event Serviceì—ì„œ ì „ì²´ ì¢Œì„ ì¡°íšŒ** (ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸ê°€ ì´ë¯¸ ê°€ì§€ê³  ìˆìŒ):
   ```java
   List<Seat> allSeats = eventServiceClient.getEventSeats(eventId);
   ```

4. **ì¢Œì„ ìƒíƒœ ë³‘í•©**:
   ```java
   return allSeats.stream()
       .map(seat -> {
           if (soldSeatIds.contains(seat.getId())) {
               seat.setStatus("SOLD");
           } else if (holdSeatIds.contains(seat.getId())) {
               seat.setStatus("HOLD");
           } else {
               seat.setStatus("AVAILABLE");
           }
           return seat;
       })
       .collect(Collectors.toList());
   ```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-RSV-003, REQ-EVT-008

### 11.3 ì˜ˆë§¤ í™•ì • í”Œë¡œìš° (Kafka Consumer)

**ì´ë²¤íŠ¸ ìˆ˜ì‹ :** `payment.events` (PaymentSuccess)

**ì²˜ë¦¬ ë¡œì§:**
1. ë©±ë“±ì„± ì²´í¬: paymentKey ì¤‘ë³µ í™•ì¸
2. ì˜ˆë§¤ ìƒíƒœ ë³€ê²½: PENDING â†’ CONFIRMED
3. Outbox ì´ë²¤íŠ¸ ë°œí–‰: ReservationConfirmed (Event Serviceë¡œ ì „íŒŒ)

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-RSV-004, REQ-RSV-011

---

## 12. ê²°ì œ ì‹œìŠ¤í…œ ì„¤ê³„

### 12.1 PortOne í†µí•© ì•„í‚¤í…ì²˜

**ê²°ì œ í”„ë¡œì„¸ìŠ¤:**
1. **ê²°ì œ ì •ë³´ ìƒì„±:** Payment ë ˆì½”ë“œ ìƒì„± (PENDING)
2. **PortOne Prepare API:** ê¸ˆì•¡ ì‚¬ì „ ê²€ì¦ ë“±ë¡
3. **í´ë¼ì´ì–¸íŠ¸ ê²°ì œ:** PortOne JS SDKë¡œ ê²°ì œ UI í˜¸ì¶œ
4. **PortOne Confirm API:** ê²°ì œ ìŠ¹ì¸ í™•ì¸ ë° ê¸ˆì•¡ ê²€ì¦
5. **ê²°ì œ ì™„ë£Œ:** Payment ìƒíƒœ SUCCESS, Kafka ì´ë²¤íŠ¸ ë°œí–‰

**Timeout:** 10ì´ˆ (REQ-PAY-008)
**Circuit Breaker:** ì‹¤íŒ¨ìœ¨ 50% ì´ˆê³¼ ì‹œ Open, ëŒ€ê¸° 60ì´ˆ (REQ-PAY-009)

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-PAY-001, REQ-PAY-006, REQ-PAY-007, REQ-PAY-010

### 12.2 SAGA íŒ¨í„´ êµ¬í˜„

**ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤:**
```
Payment (Orchestrator)
â”œâ”€ PortOne ê²°ì œ ì„±ê³µ
â”œâ”€ Kafka: PaymentSuccess ë°œí–‰
â”œâ”€ Reservation Consumer: ì˜ˆë§¤ í™•ì • (CONFIRMED)
â””â”€ Event Consumer: ì¢Œì„ ìƒíƒœ SOLD
```

**ì‹¤íŒ¨ ì‹œë‚˜ë¦¬ì˜¤ (ë³´ìƒ íŠ¸ëœì­ì…˜):**
```
Payment (Orchestrator)
â”œâ”€ PortOne ê²°ì œ ì‹¤íŒ¨
â”œâ”€ Kafka: PaymentFailed ë°œí–‰
â”œâ”€ Reservation Consumer: ì˜ˆë§¤ ì·¨ì†Œ (CANCELLED)
â””â”€ Event Consumer: ì¢Œì„ ì„ ì  í•´ì œ (AVAILABLE)
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-PAY-011, REQ-PAY-012

### 12.3 ë©±ë“±ì„± ë³´ì¥ (paymentKey)

**paymentKey:** í´ë¼ì´ì–¸íŠ¸ê°€ ìƒì„±í•œ UUID (Unique)

**ì¤‘ë³µ ë°©ì§€:**
```java
if (paymentRepository.existsByPaymentKey(paymentKey)) {
    Payment existing = paymentRepository.findByPaymentKey(paymentKey);
    return existing;  // ì¤‘ë³µ ìš”ì²­, ê¸°ì¡´ ê²°ê³¼ ë°˜í™˜
}
```

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-PAY-004, REQ-PAY-010

---

## 13. ë°°í¬ ë° CI/CD

### 13.1 ë°°í¬ ì „ëµ

**ì´ˆê¸°:** Rolling Update (ë¹„ìš© íš¨ìœ¨ì )
**ì„±ì¥ ë‹¨ê³„:** Blue-Green ë°°í¬

### 13.2 CI/CD íŒŒì´í”„ë¼ì¸

**GitHub Actions ì›Œí¬í”Œë¡œìš°:**
1. íŠ¸ë¦¬ê±°: `main` ë¸Œëœì¹˜ push
2. ë¹Œë“œ: Maven/Gradle ë¹Œë“œ, í…ŒìŠ¤íŠ¸ ì‹¤í–‰
3. ë„ì»¤ ì´ë¯¸ì§€: ë©€í‹°ìŠ¤í…Œì´ì§€ ë¹Œë“œë¡œ ìµœì í™”
4. ECR í‘¸ì‹œ: AWS ECRì— ì´ë¯¸ì§€ ì—…ë¡œë“œ
5. ECS ë°°í¬: ECS Task Definition ì—…ë°ì´íŠ¸, ì„œë¹„ìŠ¤ ì¬ë°°í¬

**ë¬´ë£Œí‹°ì–´:** GitHub Actions 2000ë¶„/ì›”

### 13.3 ë¡œì»¬ ê°œë°œ í™˜ê²½

**Docker Compose:** ì „ì²´ ìŠ¤íƒ (PostgreSQL, Redis, Kafka, ì„œë¹„ìŠ¤)
**Hot Reload:** Spring DevTools
**LocalStack:** AWS ì„œë¹„ìŠ¤ ì—ë®¬ë ˆì´ì…˜

### 13.4 Graceful Shutdown

**ì„¤ì •:**
```yaml
spring:
  lifecycle:
    timeout-per-shutdown-phase: 30s
server:
  shutdown: graceful
```

**í”„ë¡œì„¸ìŠ¤:**
1. ALB í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨ ì‘ë‹µ
2. ì‹ ê·œ ìš”ì²­ ê±°ë¶€
3. ì§„í–‰ ì¤‘ ìš”ì²­ ì™„ë£Œ ëŒ€ê¸° (ìµœëŒ€ 30ì´ˆ)
4. ì¢…ë£Œ

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-GW-026

---

## 14. ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…

### 14.1 CloudWatch í†µí•©

**ë¡œê·¸ ìˆ˜ì§‘:** 5GB/ì›” ë¬´ë£Œí‹°ì–´ í™œìš©
**ë¡œê·¸ ë³´ê´€:** 1ì¼ (ì¤‘ìš” ë¡œê·¸ë§Œ 7ì¼)
**JSON êµ¬ì¡°í™”:** íŒŒì‹± ìš©ì´

### 14.2 í•µì‹¬ ë©”íŠ¸ë¦­ (ë¬´ë£Œí‹°ì–´ 10ê°œ ì´ë‚´)

1. API Gateway: ìš”ì²­ ìˆ˜, ì‘ë‹µ ì‹œê°„, ì—ëŸ¬ìœ¨
2. ëŒ€ê¸°ì—´: ëŒ€ê¸° ì¸ì›, ìŠ¹ì¸ë¥ 
3. ì˜ˆë§¤: ì„ ì  ì„±ê³µ/ì‹¤íŒ¨ìœ¨
4. ê²°ì œ: ì„±ê³µ/ì‹¤íŒ¨ìœ¨
5. RDS: CPU, ë©”ëª¨ë¦¬, ì»¤ë„¥ì…˜ ìˆ˜
6. Redis: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰, Hit Rate

### 14.3 ì•ŒëŒ ì„¤ì • (ë¬´ë£Œí‹°ì–´ 10ê°œ)

1. ì„œë¹„ìŠ¤ ë‹¤ìš´ (í—¬ìŠ¤ì²´í¬ ì‹¤íŒ¨)
2. ì—ëŸ¬ìœ¨ 5% ì´ìƒ
3. RDS CPU 80% ì´ìƒ
4. Redis ë©”ëª¨ë¦¬ 80% ì´ìƒ

### 14.4 ë¶„ì‚° ì¶”ì 

**Spring Cloud Sleuth:** Request ID ì „íŒŒ
**CloudWatch Logs Insights:** ë¡œê·¸ ì¡°íšŒ ë° ë¶„ì„

---

## 15. ì„±ëŠ¥ ìµœì í™” ì „ëµ

### 15.1 Redis ìºì‹±

**Cache-Aside íŒ¨í„´:** ì¡°íšŒ ì‹œ ìºì‹œ í™•ì¸ â†’ ì—†ìœ¼ë©´ DB ì¡°íšŒ â†’ ìºì‹œ ì €ì¥
**TTL:** ê³µì—° ëª©ë¡/ìƒì„¸ 5ë¶„, ì˜¤í”ˆ ì‹œ 1ë¶„ìœ¼ë¡œ ë™ì  ì¡°ì •
**Cache Stampede ë°©ì§€:** Lua ìŠ¤í¬ë¦½íŠ¸ ë½

**ê´€ë ¨ ìš”êµ¬ì‚¬í•­:** REQ-EVT-017, REQ-EVT-027, REQ-EVT-031

### 15.2 DB ì¿¼ë¦¬ ìµœì í™”

**ì¸ë±ìŠ¤ ì „ëµ:**
- `seats (event_id, status)`
- `reservations (user_id, status)`
- `outbox_events (published, created_at)`

**N+1 ë¬¸ì œ í•´ê²°:** JPA Fetch Join

### 15.3 API ìµœì í™”

**Response ì••ì¶•:** gzip (1KB ì´ìƒ)
**í˜ì´ì§•:** ê¸°ë³¸ 20ê°œ, ìµœëŒ€ 100ê°œ

---

## 16. í…ŒìŠ¤íŠ¸ ì „ëµ

### 16.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

JUnit 5, Mockito, AssertJ
**ëª©í‘œ ì»¤ë²„ë¦¬ì§€:** 70% ì´ìƒ

### 16.2 í†µí•© í…ŒìŠ¤íŠ¸

Testcontainers (PostgreSQL, Redis, Kafka)
Spring Boot Test

### 16.3 E2E í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

**ì£¼ìš” í”Œë¡œìš°:**
1. íšŒì›ê°€ì… â†’ ë¡œê·¸ì¸ â†’ ëŒ€ê¸°ì—´ ì§„ì… â†’ ì¢Œì„ ì„ íƒ â†’ ê²°ì œ â†’ ì˜ˆë§¤ í™•ì •

### 16.4 ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

**ë„êµ¬:** JMeter, Gatling
**ì‹œë‚˜ë¦¬ì˜¤:**
- ëŒ€ê¸°ì—´ ë™ì‹œì„± í…ŒìŠ¤íŠ¸ (50,000ëª…)
- ì¢Œì„ ì„ ì  ê²½ìŸ í…ŒìŠ¤íŠ¸
- ê²°ì œ ì²˜ë¦¬ëŸ‰ í…ŒìŠ¤íŠ¸

---

## 16. í…ŒìŠ¤íŠ¸ ì „ëµ

_(ì´ ì„¹ì…˜ì€ ë‹¤ìŒ ì‘ì—… ë‹¨ê³„ì—ì„œ ìƒì„¸ ì‘ì„± ì˜ˆì •)_

---

## 17. ìš´ì˜ ê³„íš

### 17.1 SLA/SLO ì •ì˜

| í•­ëª© | ëª©í‘œ | ì¸¡ì • ë°©ë²• |
|------|------|----------|
| ê°€ìš©ì„± | 99.5% (ì´ˆê¸°), 99.9% (Multi-AZ ì „í™˜ í›„) | CloudWatch Uptime |
| ì‘ë‹µ ì‹œê°„ (P95) | ëŒ€ê¸°ì—´ ì§„ì… < 100ms, ì¡°íšŒ < 50ms | CloudWatch Metrics |
| ì²˜ë¦¬ëŸ‰ | 36,000ëª…/ì‹œê°„ (ëŒ€ê¸°ì—´ ìŠ¹ì¸) | Kafka Consumer Lag |
| Redis ê°€ìš©ì„± | 99.9% | ElastiCache Metrics |

### 17.2 ì¥ì•  ëŒ€ì‘ í”„ë¡œì„¸ìŠ¤

**ì¥ì•  ë“±ê¸‰:**
- **P0 (Critical)**: ì„œë¹„ìŠ¤ ì „ì²´ ë‹¤ìš´, ì¦‰ì‹œ ëŒ€ì‘
- **P1 (High)**: ì£¼ìš” ê¸°ëŠ¥ ë¶ˆê°€ (ê²°ì œ, ì˜ˆë§¤), 1ì‹œê°„ ë‚´ ëŒ€ì‘
- **P2 (Medium)**: ì¼ë¶€ ê¸°ëŠ¥ ë¶ˆê°€, 4ì‹œê°„ ë‚´ ëŒ€ì‘
- **P3 (Low)**: ê²½ë¯¸í•œ ì˜¤ë¥˜, 24ì‹œê°„ ë‚´ ëŒ€ì‘

**On-call ì²´ê³„:** ì£¼/ì•¼ê°„ êµëŒ€ (ê°œë°œì 2ëª… ìˆœí™˜)

### 17.3 ë°±ì—… ë° ë³µêµ¬

**RDS ë°±ì—…:**
- ìë™ ë°±ì—…: 1ì¼ ë³´ê´€ (ë¬´ë£Œ)
- ìˆ˜ë™ ìŠ¤ëƒ…ìƒ·: ì£¼ìš” ë°°í¬ ì „ ìƒì„±, 7ì¼ ë³´ê´€

**ë³µêµ¬ ì ˆì°¨:**
1. ìµœì‹  ìŠ¤ëƒ…ìƒ· í™•ì¸
2. ìƒˆ RDS ì¸ìŠ¤í„´ìŠ¤ë¡œ ë³µêµ¬
3. ì—”ë“œí¬ì¸íŠ¸ ë³€ê²½ (ë˜ëŠ” DNS ì—…ë°ì´íŠ¸)
4. ì„œë¹„ìŠ¤ ì¬ì‹œì‘

**RTO/RPO:**
- RTO (ë³µêµ¬ ì‹œê°„): 30-60ë¶„ (Single-AZ), 1-2ë¶„ (Multi-AZ)
- RPO (ë°ì´í„° ì†ì‹¤): ìµœëŒ€ 5ë¶„

### 17.4 ìš©ëŸ‰ ê³„íš

**íŠ¸ë˜í”½ ì˜ˆì¸¡:**
- í‰ìƒì‹œ: 100 TPS
- í‹°ì¼“ ì˜¤í”ˆ: 1,000 TPS (ìˆœê°„ 5,000 TPS)

**ë¦¬ì†ŒìŠ¤ ì¦ì„¤ ê¸°ì¤€:**
- RDS CPU 70% ì§€ì† â†’ Read Replica ì¶”ê°€ ë˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ ì—…ê·¸ë ˆì´ë“œ
- Redis ë©”ëª¨ë¦¬ 70% â†’ ì¸ìŠ¤í„´ìŠ¤ ì—…ê·¸ë ˆì´ë“œ
- EC2 CPU 70% â†’ Auto Scaling ë˜ëŠ” ìˆ˜ë™ ìŠ¤ì¼€ì¼ ì•„ì›ƒ

**ë¹„ìš© ëª¨ë‹ˆí„°ë§:**
- AWS Cost Explorerë¡œ ì›”ë³„ ë¹„ìš© ì¶”ì 
- ì•ŒëŒ: ì˜ˆìƒ ë¹„ìš© ì´ˆê³¼ ì‹œ ì•Œë¦¼

---

## 18. ê¸°ìˆ  ë¶€ì±„ ë° ê°œì„  ì‚¬í•­

### 18.1 ì•Œë ¤ì§„ ì œì•½ì‚¬í•­

1. **ë‹¨ì¼ RDS ì¸ìŠ¤í„´ìŠ¤:**
   - ì„œë¹„ìŠ¤ë³„ ë¬¼ë¦¬ì  DB ë¶„ë¦¬ ë¯¸êµ¬í˜„
   - í–¥í›„ íŠ¸ë˜í”½ ì¦ê°€ ì‹œ ë³‘ëª© ê°€ëŠ¥

2. **Single-AZ ë°°í¬:**
   - AZ ì¥ì•  ì‹œ ì„œë¹„ìŠ¤ ì¤‘ë‹¨
   - ì´ˆê¸° ë¹„ìš© ì ˆê°ì„ ìœ„í•œ ì„ íƒ

3. **Kafka ë‹¨ì¼ ë¸Œë¡œì»¤:**
   - ë¸Œë¡œì»¤ ë‹¤ìš´ ì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì¤‘ë‹¨
   - í–¥í›„ 3 ë¸Œë¡œì»¤ í´ëŸ¬ìŠ¤í„°ë¡œ í™•ì¥ í•„ìš”

4. **ìˆ˜ë™ ìŠ¤ì¼€ì¼ë§:**
   - Auto Scaling ë¯¸ì ìš© (ë¹„ìš© ì ˆê°)
   - íŠ¸ë˜í”½ ì˜ˆì¸¡ í•„ìš”

### 18.2 í–¥í›„ ê°œì„  ê³„íš

**Phase 1 (6ê°œì›”):**
- Multi-AZ ì „í™˜ (RDS, Redis, Kafka)
- Auto Scaling ì ìš©
- Read Replica ì¶”ê°€

**Phase 2 (1ë…„):**
- ì„œë¹„ìŠ¤ë³„ ë¬¼ë¦¬ì  DB ë¶„ë¦¬
- ElasticSearch ë„ì… (ì˜ˆë§¤ ë‚´ì—­ ê²€ìƒ‰)
- CDN ìµœì í™” (ì •ì  ë¦¬ì†ŒìŠ¤)

**Phase 3 (2ë…„):**
- Multi-Region ë°°í¬
- Serverless ì „í™˜ ê²€í†  (Lambda, Aurora Serverless)
- AI ê¸°ë°˜ ë¶€ì • ì˜ˆë§¤ íƒì§€

### 18.3 ê¸°ìˆ  ê²€í†  í•­ëª©

| í•­ëª© | í˜„ì¬ | ê²€í†  ì‚¬í•­ | ìš°ì„ ìˆœìœ„ |
|------|------|----------|---------|
| CQRS íŒ¨í„´ | ë¶€ë¶„ ì ìš© (Redis ìºì‹±) | ì „ë©´ ì ìš© ê²€í†  | Medium |
| Event Sourcing | ë¯¸ì ìš© | ì´ë²¤íŠ¸ íˆìŠ¤í† ë¦¬ ì¶”ì  | Low |
| GraphQL | ë¯¸ì ìš© | REST API ëŒ€ì²´ ê²€í†  | Low |
| gRPC | ë¯¸ì ìš© | ì„œë¹„ìŠ¤ ê°„ í†µì‹  ì„±ëŠ¥ í–¥ìƒ | Medium |
| Kubernetes | ECS/EC2 | ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ê°œì„  | Low |
| Service Mesh | ë¯¸ì ìš© | Istio, Linkerd ê²€í†  | Low |

---

## 19. ë¶€ë¡

### 19.1 ìš©ì–´ ì •ì˜ (Glossary)

| ìš©ì–´ | ì •ì˜ |
|------|------|
| MSA | Microservices Architecture, ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜ |
| SAGA | ë¶„ì‚° íŠ¸ëœì­ì…˜ íŒ¨í„´, ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ë˜ëŠ” ì½”ë ˆì˜¤ê·¸ë˜í”¼ ë°©ì‹ |
| Outbox Pattern | ì´ë²¤íŠ¸ ë°œí–‰ ì‹ ë¢°ì„±ì„ ë³´ì¥í•˜ëŠ” íŒ¨í„´, DB íŠ¸ëœì­ì…˜ê³¼ ë©”ì‹œì§€ ë°œí–‰ì„ ì›ìì ìœ¼ë¡œ ì²˜ë¦¬ |
| CI/DI | ë³¸ì¸ì¸ì¦ ì •ë³´, Connecting Information / Duplication Information |
| Queue Token | ëŒ€ê¸°ì—´ í†µê³¼ ì¸ì¦ í† í°, Reservation Token (qr_xxx), Payment Token (qp_xxx) |
| Sorted Set | Redis ìë£Œêµ¬ì¡°, Score ê¸°ë°˜ ì •ë ¬ëœ ì§‘í•© |
| Redisson | Redis ê¸°ë°˜ Java í´ë¼ì´ì–¸íŠ¸, ë¶„ì‚° ë½, ë¶„ì‚° ìë£Œêµ¬ì¡° ì§€ì› |
| PortOne | ê²°ì œ PG (Payment Gateway), êµ¬ ì•„ì„í¬íŠ¸ |
| reCAPTCHA | Googleì˜ ë´‡ ì°¨ë‹¨ ì„œë¹„ìŠ¤ |
| LocalStack | AWS ì„œë¹„ìŠ¤ ë¡œì»¬ ì—ë®¬ë ˆì´í„° |
| CloudWatch | AWS ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹… ì„œë¹„ìŠ¤ |
| ElastiCache | AWS ê´€ë¦¬í˜• Redis/Memcached ì„œë¹„ìŠ¤ |
| RDS | AWS ê´€ë¦¬í˜• ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ì„œë¹„ìŠ¤ |
| P95 | 95th Percentile, ì „ì²´ ìš”ì²­ ì¤‘ 95%ê°€ í•´ë‹¹ ì‹œê°„ ì´ë‚´ ì‘ë‹µ |
| TPS | Transactions Per Second, ì´ˆë‹¹ íŠ¸ëœì­ì…˜ ìˆ˜ |
| SLA | Service Level Agreement, ì„œë¹„ìŠ¤ ìˆ˜ì¤€ í˜‘ì•½ |
| SLO | Service Level Objective, ì„œë¹„ìŠ¤ ìˆ˜ì¤€ ëª©í‘œ |
| RTO | Recovery Time Objective, ëª©í‘œ ë³µêµ¬ ì‹œê°„ |
| RPO | Recovery Point Objective, ëª©í‘œ ë³µêµ¬ ì‹œì  (ë°ì´í„° ì†ì‹¤ í—ˆìš© ë²”ìœ„) |

### 19.2 ì°¸ê³  ë¬¸ì„œ ë° ë§í¬

**ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ:**
- [REQUIREMENTS.md](./REQUIREMENTS.md) - 111ê°œ ìš”êµ¬ì‚¬í•­ ì •ì˜

**ê¸°ìˆ  ë¬¸ì„œ:**
- Spring Cloud Gateway: https://spring.io/projects/spring-cloud-gateway
- Spring Boot 3.x: https://spring.io/projects/spring-boot
- PostgreSQL 18: https://www.postgresql.org/docs/18/
- Redis 7.x: https://redis.io/docs/
- Apache Kafka 3.x: https://kafka.apache.org/documentation/
- Redisson: https://redisson.org/
- Resilience4j: https://resilience4j.readme.io/

**ì™¸ë¶€ ì„œë¹„ìŠ¤:**
- PortOne: https://portone.io/
- Google reCAPTCHA: https://www.google.com/recaptcha/
- Vercel: https://vercel.com/docs

**AWS ë¬¸ì„œ:**
- RDS PostgreSQL: https://docs.aws.amazon.com/rds/
- ElastiCache Redis: https://docs.aws.amazon.com/elasticache/
- ECS: https://docs.aws.amazon.com/ecs/
- CloudWatch: https://docs.aws.amazon.com/cloudwatch/
- LocalStack: https://docs.localstack.cloud/

**íŒ¨í„´ ë° ì•„í‚¤í…ì²˜:**
- SAGA íŒ¨í„´: https://microservices.io/patterns/data/saga.html
- Transactional Outbox: https://microservices.io/patterns/data/transactional-outbox.html
- Event-Driven Architecture: https://martinfowler.com/articles/201701-event-driven.html

### 19.3 ì•„í‚¤í…ì²˜ ê²°ì • ê¸°ë¡ (ADR)

**ADR-001: PostgreSQL ë‹¨ì¼ ì¸ìŠ¤í„´ìŠ¤ + ìŠ¤í‚¤ë§ˆ ë¶„ë¦¬ ì„ íƒ**
- **ë‚ ì§œ:** 2026-01-11
- **ìƒíƒœ:** ìŠ¹ì¸ë¨
- **ì»¨í…ìŠ¤íŠ¸:** ë¹„ìš© ìµœì†Œí™”í•˜ë©´ì„œ MSA ì›ì¹™ ì¤€ìˆ˜
- **ê²°ì •:** ë…¼ë¦¬ì  DB per Service + ë¬¼ë¦¬ì  í†µí•©
- **ê²°ê³¼:** ë¬´ë£Œí‹°ì–´ í™œìš©, í–¥í›„ ë¬¼ë¦¬ì  ë¶„ë¦¬ ê°€ëŠ¥
- **ëŒ€ì•ˆ:** ì„œë¹„ìŠ¤ë³„ ë…ë¦½ RDS (ë¹„ìš© $170+/ì›”)

**ADR-002: EC2 ê¸°ë°˜ Kafka ì„ íƒ**
- **ë‚ ì§œ:** 2026-01-11
- **ìƒíƒœ:** ìŠ¹ì¸ë¨
- **ì»¨í…ìŠ¤íŠ¸:** MSKëŠ” ìµœì†Œ ì›” $200+ë¡œ ê³ ë¹„ìš©
- **ê²°ì •:** EC2 ìì²´ Kafka í´ëŸ¬ìŠ¤í„° êµ¬ì¶•
- **ê²°ê³¼:** ì›” $15-60, ìš´ì˜ ë¶€ë‹´ ì¦ê°€
- **ëŒ€ì•ˆ:** Amazon SNS/SQS (ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë° ê¸°ëŠ¥ ë¶€ì¡±), MSK (ê³ ë¹„ìš©)

**ADR-003: At-least-once + Consumer ë©±ë“±ì„± ì„ íƒ**
- **ë‚ ì§œ:** 2026-01-11
- **ìƒíƒœ:** ìŠ¹ì¸ë¨
- **ì»¨í…ìŠ¤íŠ¸:** Exactly-onceëŠ” ë³µì¡ë„ ì¦ê°€
- **ê²°ì •:** At-least-once ì „ë‹¬ ë³´ì¥ + Consumer ë©±ë“±ì„± ì²˜ë¦¬
- **ê²°ê³¼:** ì‹ ë¢°ì„± í™•ë³´, êµ¬í˜„ ë‹¨ìˆœ
- **ëŒ€ì•ˆ:** Kafka Transactional API (ì„±ëŠ¥ 10-30% ì €í•˜)

**ADR-004: Redisson ë¶„ì‚° ë½ ì„ íƒ**
- **ë‚ ì§œ:** 2026-01-11
- **ìƒíƒœ:** ìŠ¹ì¸ë¨
- **ì»¨í…ìŠ¤íŠ¸:** ì¢Œì„ ì„ ì  ë™ì‹œì„± ì œì–´ í•„ìš”
- **ê²°ì •:** Redisson RLock ì‚¬ìš©
- **ê²°ê³¼:** ì•ˆì •ì ì¸ ë¶„ì‚° ë½, Pub/Subë¡œ ëŒ€ê¸° ìµœì í™”
- **ëŒ€ì•ˆ:** Redis SET NX (ìˆ˜ë™ êµ¬í˜„, Watch Dog ì—†ìŒ), ZooKeeper (ê³¼ë„í•œ ì˜ì¡´ì„±)

### 19.4 ë‹¤ì´ì–´ê·¸ë¨ ë²”ë¡€ ë° í‘œê¸°ë²•

**Mermaid ë‹¤ì´ì–´ê·¸ë¨ ë²”ë¡€:**

```mermaid
graph LR
    A[ì‚¬ê°í˜•: ì»´í¬ë„ŒíŠ¸/ì„œë¹„ìŠ¤]
    B[(ì›í†µí˜•: ë°ì´í„°ë² ì´ìŠ¤)]
    C{{ë‹¤ì´ì•„ëª¬ë“œ: ì˜ì‚¬ê²°ì •}}
    D([ë¼ìš´ë“œ ì‚¬ê°í˜•: ì™¸ë¶€ ì‹œìŠ¤í…œ])

    A -->|ì‹¤ì„  í™”ì‚´í‘œ: ë™ê¸° í˜¸ì¶œ| B
    A -.->|ì ì„  í™”ì‚´í‘œ: ë¹„ë™ê¸° í˜¸ì¶œ/ì´ë²¤íŠ¸| C
    A ==>|êµµì€ í™”ì‚´í‘œ: ì£¼ìš” í”Œë¡œìš°| D
```

**ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨ í‘œê¸°:**
- `â†’`: ë™ê¸° í˜¸ì¶œ (Request-Response)
- `-->>`: ë¹„ë™ê¸° ì‘ë‹µ
- `-->|ë©”ì‹œì§€|`: í˜¸ì¶œ ì‹œ ë©”ì‹œì§€

**ERD í‘œê¸°:**
- `PK`: Primary Key
- `FK`: Foreign Key
- `UK`: Unique Key
- `||--o{`: One-to-Many ê´€ê³„
- `||--||`: One-to-One ê´€ê³„

**ìƒíƒœ ë‹¤ì´ì–´ê·¸ë¨ í‘œê¸°:**
- ì›: ìƒíƒœ
- í™”ì‚´í‘œ: ì „ì´ (ì´ë²¤íŠ¸/ì¡°ê±´)

---

## ë¬¸ì„œ ì¢…ë£Œ

ì´ ì•„í‚¤í…ì²˜ ì„¤ê³„ì„œëŠ” ìš”êµ¬ì‚¬í•­ ëª…ì„¸ì„œ(REQUIREMENTS.md)ì˜ 111ê°œ ìš”êµ¬ì‚¬í•­ì„ ê¸°ë°˜ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì‹¤ì œ êµ¬í˜„ ì‹œ ì´ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì—¬ ì¼ê´€ëœ ì•„í‚¤í…ì²˜ë¥¼ ìœ ì§€í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.

**ë¬¸ì„œ ë²„ì „:** 1.0.0
**ìµœì¢… ìˆ˜ì •ì¼:** 2026-01-11
**ì‘ì„±ì:** ê°œë°œíŒ€ (Aê°œë°œì, Bê°œë°œì)
**ë¬¸ì˜:** GitHub Issues
