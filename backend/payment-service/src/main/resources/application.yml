server:
  port: 8085

outbox:
  poller:
    enabled: true

spring:
  application:
    name: payment-service

  datasource:
    url: jdbc:postgresql://localhost:5432/ticketing
    username: payment_svc_user
    password: ${DB_PASSWORD:password}
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        default_schema: payment_service
        format_sql: true
    show-sql: true
    open-in-view: false

  kafka:
    bootstrap-servers: localhost:9092
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      acks: all
      properties:
        enable.idempotence: true
    consumer:
      group-id: payment-service
      auto-offset-reset: earliest
      enable-auto-commit: false
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: com.ticketqueue.*
    listener:
      ack-mode: MANUAL_IMMEDIATE

portone:
  api-secret: ${PORTONE_API_SECRET:test-api-secret}
  base-url: https://api.portone.io
  timeout: 10000  # 10 seconds

feign:
  client:
    config:
      default:
        connect-timeout: 5000
        read-timeout: 5000
      reservation-service:
        url: http://localhost:8084

resilience4j:
  circuitbreaker:
    configs:
      default:
        slidingWindowSize: 10
        minimumNumberOfCalls: 5
        failureRateThreshold: 50
        waitDurationInOpenState: 60s
        permittedNumberOfCallsInHalfOpenState: 3
    instances:
      portone:
        baseConfig: default
  retry:
    configs:
      default:
        maxAttempts: 3
        waitDuration: 1s
        exponentialBackoffMultiplier: 2
    instances:
      portone:
        baseConfig: default

internal:
  api:
    key: ${INTERNAL_API_KEY:internal-api-key-for-dev}

management:
  endpoints:
    web:
      exposure:
        include: health, info, circuitbreakers
  endpoint:
    health:
      show-details: always

logging:
  level:
    com.ticketqueue.payment: DEBUG
    org.hibernate.SQL: DEBUG
    io.github.resilience4j: DEBUG
